{"version":3,"sources":["libs/api-utils.ts","api/defs/prop-types.ts","api/defs/doc-generation.ts","api/actions/errors.ts","api/actions/users.ts","api/actions/utils.ts","api/actions/sessions.ts","api/mockAPI/utils.js","libs/import-export/data-to-file.ts","libs/import-export/undefinedToNull.ts","libs/import-export/prepare-minimal.ts","libs/import-export/prepare-spreadsheet.ts","libs/import-export/prepare-data.ts","libs/import-export/spreadsheet-row-mapper.ts","libs/import-export/match-by-utorid-or-name.ts","libs/import-export/validate.ts","libs/import-export/normalize-import.ts","libs/import-export/prepare-full.ts","libs/import-export/normalize-ddah-import.ts","api/actions/assignments.ts","api/actions/positions.ts","api/actions/ddahs.ts","api/actions/init.ts","api/actions/applicants.ts","api/actions/postings.ts","api/actions/instructors.ts","api/actions/contract_templates.ts","libs/urls.ts","api/actions/status.ts","api/actions/applications.ts","api/actions/wage_chunks.ts","api/actions/globals.ts","libs/schema.ts","api/selectors/utils.ts","api/selectors/raw-selectors.ts","api/selectors/application-smash.ts","api/actions/instructor_preferences.ts","api/mockAPI/data.js","api/mockAPI/sessions.ts","api/mockAPI/contract_templates.js","api/mockAPI/active_user.js","api/mockAPI/instructors.js","api/mockAPI/positions.js","api/mockAPI/wage_chunks.js","api/mockAPI/applications.js","api/mockAPI/applicants.js","api/mockAPI/assignments.js","api/mockAPI/debug.js","api/mockAPI/ddahs.js","api/mockAPI/reportingTags.ts","api/mockAPI/postings.ts","api/mockAPI/public-routes.js","api/mockAPI/index.js","views/dev_frame/mockAPI.js","views/dev_frame/active-user-switch.js","mock_data/index.ts","views/dev_frame/load-mock-data.tsx","views/dev_frame/index.js","api/actions/offers.ts","libs/thunk-dispatch.ts","libs/utils.ts"],"names":["API_URL","FETCH_INIT","credentials","headers","ApiError","resp","errorMessage","message","response","status","Error","captureStackTrace","ApiFetchError","path","statusText","_ensurePath","startsWith","_processFetchResponse","a","json","payload","apiGET","omitPrefix","fetch","method","apiPOST","body","JSON","stringify","generatePropTypes","PropTypes","id","oneOfType","number","string","apiResponse","shape","oneOf","isRequired","any","apiResponseSuccess","apiResponseError","idOnly","session","start_date","end_date","name","contractTemplateMinimal","template_file","contractTemplate","template_name","position","position_code","position_title","hours_per_assignment","contract_template_id","duties","qualifications","desired_num_assignments","current_enrollment","current_waitlisted","instructor_ids","arrayOf","instructor_preference","preference_level","applicant_id","instructor_id","instructor","first_name","last_name","email","utorid","assignment","note","contract_override_pdf","position_id","active_offer_status","active_offer_url_token","active_offer_recent_activity_date","active_offer_nag_count","applicant","student_number","phone","wageChunk","hours","rate","reportingTag","offer","position_start_date","position_end_date","first_time_ta","bool","instructor_contact_desc","pay_period_desc","installments","ta_coordinator_name","ta_coordinator_email","emailed_date","accepted_date","rejected_date","withdrawn_date","url_token","nag_count","application","posting_id","comments","program","department","previous_department_ta","previous_university_ta","previous_experience_summary","yip","annotation","submission_date","position_preference","user","roles","ddah","assignment_id","signature","approved_date","revised_date","description","order","posting","intro_text","open_date","close_date","availability","custom_questions","application_ids","posting_position","num_positions","comment","survey","title","pages","elements","type","OrigPropTypes","CallAtom","prop","args","this","join","createCallChain","chain","concat","wrappedPropTypes","propTypesProxy","innerObj","callChain","handler","get","obj","receiver","ret","Reflect","Object","apply","thisArg","lastProp","pop","ownKeys","Proxy","docApiPropTypes","PROPTYPES_TO_SWAGGER_TYPES","object","array","wrappedPropTypesToSwagger","pt","requiredList","entries","key","swaggerVal","push","length","map","console","warn","wrapInStandardApiResponseForSwagger","properties","enum","required","urlTemplateToSwagger","url","parsed","RouteParser","templateVars","keys","match","spec","subs","templateVar","decodeURI","reverse","documentedCallbackToSwagger","docs","responses","default","prefixRoles","summary","x","parameters","in","returns","content","schema","posts","requestBody","mockApiRoutesAsSwaggerPaths","mockAPI","getRoutes","postRoutes","val","templatePath","exclude","assign","post","tags","Array","from","Set","split","filter","info","applicableTags","includes","sortedRet","sort","documentCallback","func","attrs","defaultNotifProps","autoDismiss","fetchError","error","upsertError","deleteError","apiError","fetchActiveUserSuccess","actionFactory","FETCH_ACTIVE_USER_SUCCESS","fetchUsersSuccess","FETCH_USERS_SUCCESS","upsertUserSuccess","UPSERT_USERS_SUCCESS","setActiveUserRoleSuccess","SET_ACTIVE_USER_ROLE_SUCCESS","fetchActiveUser","validatedApiDispatcher","onErrorDispatch","e","toString","dispatcher","dispatch","getState","data","currentRole","activeRoleSelector","globalsSelector","role","setActiveUserRole","fetchUsers","options","setGlobals","skipInit","initFromStage","startAfterStage","debugOnlyFetchUsers","debugOnlyUpsertUser","debugOnlySetActiveUser","localStoreSelector","usersReducer","_localStoreSelector","usersSelector","state","users","activeUserSelector","active_user","active_role","arrayToHash","l","isArray","d","splitObjByProps","props","preserved","removed","hasOwnProperty","call","hasSubIdField","flattenIdFactory","inPropName","outPropName","hasSubField","filtered","hasSubIdFieldArray","statusId","uuid","apiInteractionStart","Function","apiInteractionEnd","isSameSession","desiredSessionId","activeSessionSelector","fetchSessionsSuccess","FETCH_SESSIONS_SUCCESS","fetchOneSessionSuccess","FETCH_ONE_SESSION_SUCCESS","upsertOneSessionSuccess","UPSERT_ONE_SESSION_SUCCESS","deleteOneSessionSuccess","DELETE_ONE_SESSION_SUCCESS","setActiveSessionAction","SET_ACTIVE_SESSION","fetchSessions","upsertSession","deleteSession","setActiveSession","currentActiveSession","clearSessionDependentData","sessionsReducer","sessionsSelector","createSelector","_modelData","activeSession","splitDateRangeAtNewYear","Date","december","getFullYear","january","toISOString","getUnusedId","ids","max","Math","isNaN","round","random","find","s","findAllById","deleteInArray","splice","indexOf","getAttributesCheckMessage","unique","requirements","MockAPIController","ownData","query","rawFind","newId","newItem","value","item","validateProp","updateIfFound","validateNew","create","wageChunkArrayToStartAndEndDates","wageChunks","startDates","endDates","joinWithConjunction","items","formatInstructorsContact","instructors","wageChunkArrayToPayPeriodDescription","rateData","min","values","toLocaleDateString","month","day","year","filterNullProps","errorUnlessRole","targetRule","base64abc","base64codes","Uint8Array","i","getBase64Code","charCode","code","bytesToBase64","bytes","result","base64ToBytes","str","index","buffer","missingOctets","endsWith","n","j","charCodeAt","subarray","base64decode","decoder","TextDecoder","decode","forEach","char","dataToFile","formatters","dataFormat","filePrefix","fileName","workbook","XLSX","utils","book_new","sheet","aoa_to_sheet","toSpreadsheet","book_append_sheet","bookType","file","File","write","toJson","spreadsheetUndefinedToNull","prepareMinimal","rate1","rate2","contract_template","posting_positions","postingPosition","wage_chunks","assignmentHours","chunk","chunk1","chunk2","tmp","slice","wageChunksMatchPositionAndSession","gpa","documents","custom_question_answers","position_preferences","instructor_preferences","pref","b","duty","formatDateForSpreadsheet","date","toJSON","createPayPeriodHeaders","assignments","maxNumPeriods","prepareSpreadsheet","applicants","applications","minApps","baseUrl","document","location","origin","URL","href","positions","firstItems","lastItems","emptyFirstItems","emptyLastItems","_","first","last","ddahs","maxDuties","dutyHeaders","flattenDuties","assignmentsForSpreadsheet","formatWageChunksToList","prepareApplicationData","preparePostingData","postings","prepareApplicantData","prepareAssignmentDataFactory","assignmentFilter","prepareDdahDataFactory","ddahFilter","prepareInstructorData","preparePositionData","deleteReferences","keyMap","findMatchingKey","targetKey","fuzzySet","FuzzySet","matches","matchedKey","SpreadsheetRowMapper","unmatchedKeys","empiricalKeyMap","unknownKeys","row","log","matchByUtoridOrName","people","nameHash","person","fuzzyMatch","validate","requiredKeys","undefined","parseDate","sec","replace","chrono","normalizeImport","dataWrapper","dateColumns","primaryKey","baseName","fileType","rowMapper","formatRow","newRow","col","prepareFull","minSession","context","minContractTemplate","minInstructor","minApplicant","minPosition","contractTemplates","template","instructorList","minWageChunk","minAssignment","minDdah","matchingAssignment","total_hours","minPosting","postingPositions","minPostingPosition","normalizeDdahImports","positionCodeOverride","unwrapped","Position","First","Surname","Last","normalized","fetchAssignmentsSuccess","FETCH_ASSIGNMENTS_SUCCESS","fetchOneAssignmentSuccess","FETCH_ONE_ASSIGNMENT_SUCCESS","upsertOneAssignmentSuccess","UPSERT_ONE_ASSIGNMENT_SUCCESS","deleteOneAssignmentSuccess","DELETE_ONE_ASSIGNMENT_SUCCESS","MissingActiveSessionError","fetchAssignments","activeSessionId","fetchAssignment","applicantToApplicantId","positionToPositionId","prepForApi","upsertAssignment","upsertWageChunksForAssignment","exportAssignments","formatter","format","assignmentsSelector","wageChunkPromises","fetchWageChunksForAssignment","Promise","all","wageChunksByAssignmentSelector","upsertAssignments","dispatchers","wageChunksMatchAssignment","totalHours","assignmentsReducer","_assignmentsSelector","_offersByAssignmentIdSelector","_offersByAssignmentId","applicantsSelector","positionsSelector","getWageChunksForAssignment","offersByAssignmentIdHash","applicantsById","positionsById","rest","offers","fetchPositionsSuccess","FETCH_POSITIONS_SUCCESS","fetchOnePositionSuccess","FETCH_ONE_POSITION_SUCCESS","upsertOnePositionSuccess","UPSERT_ONE_POSITION_SUCCESS","deleteOnePositionSuccess","DELETE_ONE_POSITION_SUCCESS","fetchPositions","instructorsToInstructorIds","contractTemplateToContractTemplateId","upsertPosition","deletePosition","exportPositions","upsertPositions","positionsReducer","_positionsSelector","instructorsSelector","contractTemplatesSelector","instructorsById","contractTemplatesById","fetchDdahsSuccess","FETCH_DDAHS_SUCCESS","fetchOneDdahSuccess","FETCH_ONE_DDAH_SUCCESS","upsertOneDdahSuccess","UPSERT_ONE_DDAH_SUCCESS","deleteOneDdahSuccess","DELETE_ONE_DDAH_SUCCESS","approveOneDdahSuccess","DDAH_APPROVE_SUCCESS","emailOneDdahSuccess","DDAH_EMAIL_SUCCESS","fetchDdahs","assignmentToAssignmentId","approveDdah","emailDdah","upsertDdah","deleteDdah","exportDdahs","ddahsSelector","upsertDdahs","downloadDdahAcceptedList","_dispatch","atob","file_name","mime_type","computeDdahHours","ddahsReducer","_ddahsSelector","assignmentsHash","toggleMockApi","enableMockAPI","require","replaceGlobalFetch","restoreGlobalFetch","prepareGlobals","globals","stage","shouldRunStage","queryStage","initOrder","stageDependent","sessions","parsedGlobals","asyncActions","window","parseURLSearchString","search","fetchInstructorsSuccess","activeRole","fetchInstructors","matchingSession","fetchActions","fetchContractTemplates","fetchApplicants","fetchApplications","fetchInstructorPreferences","action","fetchInstructorPreferencesSuccess","fetchApplicantsSuccess","fetchContractTemplatesSuccess","fetchApplicationsSuccess","fetchPostingsSuccess","fetchPostingPositionsSuccess","FETCH_APPLICANTS_SUCCESS","fetchOneApplicantSuccess","FETCH_ONE_APPLICANT_SUCCESS","upsertOneApplicantSuccess","UPSERT_ONE_APPLICANT_SUCCESS","deleteOneApplicantSuccess","DELETE_ONE_APPLICANT_SUCCESS","upsertApplicant","bySession","deleteApplicant","exportApplicants","upsertApplicants","applicantsReducer","FETCH_POSTINGS_SUCCESS","fetchOnePostingSuccess","FETCH_ONE_POSTING_SUCCESS","upsertOnePostingSuccess","UPSERT_ONE_POSTING_SUCCESS","deleteOnePostingSuccess","DELETE_ONE_POSTING_SUCCESS","FETCH_POSTING_POSITIONS_SUCCESS","fetchOnePostingPositionSuccess","FETCH_ONE_POSTING_POSITION_SUCCESS","upsertOnePostingPositionSuccess","UPSERT_ONE_POSTING_POSITION_SUCCESS","deleteOnePostingPositionSuccess","DELETE_ONE_POSTING_POSITION_SUCCESS","fetchPostings","model","prepPostingForApi","upsertPosting","upsertPostingPosition","fetchSurvey","fetchPostingPositionsForPosting","rawPostingPosition","prepPostingPositionForApi","deletePostingPosition","exportPosting","postingId","postingsSelector","isRawPostingPosition","core","combinePostingAndPostingPosition","rawPosting","rawPostingPositions","positionsMap","Map","partialPosting","has","partialPostingPosition","postingsReducer","localStoreSelector2","postingPositionsReducer","postingsState","postingPositionsState","processed","flat","FETCH_INSTRUCTORS_SUCCESS","fetchOneInstructorSuccess","FETCH_ONE_INSTRUCTOR_SUCCESS","upsertOneInstructorSuccess","UPSERT_ONE_INSTRUCTOR_SUCCESS","deleteOneInstructorSuccess","DELETE_ONE_INSTRUCTOR_SUCCESS","upsertInstructor","deleteInstructor","exportInstructors","upsertInstructors","instructorsReducer","FETCH_CONTRACT_TEMPLATES_SUCCESS","fetchAllContractTemplatesSuccess","FETCH_ALL_CONTRACT_TEMPLATES_SUCCESS","upsertOneContractTemplateSuccess","UPSERT_ONE_CONTRACT_TEMPLATE_SUCCESS","deleteOneContractTemplateSuccess","DELETE_ONE_CONTRACT_TEMPLATE_SUCCESS","upsertContractTemplate","fetchAllContractTemplates","previewContractTemplate","template_id","downloadContractTemplate","uploadContractTemplate","arrayBuffer","rawContent","contractTemplatesReducer","allContractTemplatesSelector","stringToNativeType","Number","parse","searchParams","URLSearchParams","API_INTERACTION_START","API_INTERACTION_END","FETCH_APPLICATIONS_SUCCESS","fetchOneApplicationSuccess","FETCH_ONE_APPLICATION_SUCCESS","upsertOneApplicationSuccess","UPSERT_ONE_APPLICATION_SUCCESS","deleteOneApplicationSuccess","DELETE_ONE_APPLICATION_SUCCESS","prepApplicationForApi","upsertApplication","exportApplications","applicationsSelector","fetchWageChunksForAssignmentSuccess","FETCH_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS","upsertWageChunksForAssignmentSuccess","UPSERT_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS","upsertOneWageChunkSuccess","UPSERT_ONE_WAGE_CHUNK_SUCCESS","deleteOneWageChunkSuccess","DELETE_ONE_WAGE_CHUNK_SUCCESS","assignmentId","_wageChunksByAssignmentId","setGlobalsInUrl","append","history","pushState","newUrl","setMockAPIState","ui","otherGlobals","storedActiveSession","instructorSchema","applicantSchema","postingSchema","Name","positionSchema","Start","End","assignmentSchema","Hours","filterNull","attr","arrayToMapByAttr","set","makeModelDataSelector","selector","rawSelector","applicationsReducer","instructorPreferences","instructorPreferencesReducer","applicationsAndInstructorPreferencesSelector","rawApplications","rawInstructorPreferences","baseApplications","applicationsById","application_id","every","smashApplicationsAndInstructorPreferences","postingsById","rawPositionPreferences","linkApplicationsWithData","applicationsAndInstructorPreferences","FETCH_INSTRUCTOR_PREFERENCES_SUCCESS","fetchOneInstructorPreferenceSuccess","FETCH_ONE_INSTRUCTOR_PREFERENCE_SUCCESS","upsertOneInstructorPreferenceSuccess","UPSERT_ONE_INSTRUCTOR_PREFERENCE_SUCCESS","deleteOneInstructorPreferenceSuccess","DELETE_ONE_INSTRUCTOR_PREFERENCE_SUCCESS","applicationToApplicationId","prepInstructorPreferenceForApi","upsertInstructorPreference","contract_templates_by_filename","mockData","available_contract_templates","contract_templates","contract_templates_by_session","1","2","positions_by_session","assignments_by_session","session_id","Session","newSession","filteredData","findAll","sessionsRoutes","params","upsert","ContractTemplate","findAllBySession","file_contents","newTemplate","templatesRoutes","getTemplateHtml","templateContent","encodedContent","TextEncoder","encode","upsertBySession","upload","User","matchingUser","activeUserRoutes","getActiveUser","Instructor","matchingInstructor","activeUser","instructorsRoutes","activeInstructor","getFromActiveUser","instructorPositions","getForInstructor","instructorIdsSet","add","rawPosition","_session_id","matchingPosition","bySessionsList","newPosition","positionsRoutes","WageChunk","Assignment","rawWageChunk","getSession","session_start_date","getPosition","existingWageChunks","findAllByAssignment","upsertByAssignment","wageChunkRoutes","Application","applicationsRoutes","Applicant","applicantIds","applicantsRoutes","findAllBySessionAndInstructor","existingApplicant","sum","ActiveOffer","findByAssignment","getWageChunkInfo","activeOffer","getActiveOffer","upsertedAssignment","findAssociatedSession","dateRanges","range","perChunkDelta","positionIds","_ensureAssignment","_noActiveOffer","baseOffer","getAssignment","getApplicant","getInstructors","getContractTemplate","assignmentsRoutes","getHistoryByAssignment","existingAssignment","setAllByAssignment","withdrawByAssignment","rejectByAssignment","acceptByAssignment","createByAssignment","emailByAssignment","nagByAssignment","storage","Debug","getAllData","makeSnapshot","constructor","snapshot","clearData","debugRoutes","found_user","setActiveUser","restoreSnapshot","Ddah","assignmentIds","ddahsRoutes","ddah_id","existingDdah","overwriteFields","sortByOrder","reportingTagRoutes","postingRoutes","publicRoutes","MockAPI","seedData","routePrefix","_getRoutesParsers","route","authenticateActiveUserBasedOnRole","_postRoutesParsers","active","routeStr","r","Route","delay","_origFetch","init","parsedURL","pathname","mockResponse","responseObj","Response","Blob","resolve","setTimeout","ToggleMockApi","ButtonGroup","Button","variant","onClick","connect","ident","SwaggerUI","React","lazy","BootstrapNavLink","Nav","Link","as","NavLink","activeClassName","to","children","swaggerData","openapi","servers","paths","ConnectedActiveUserButton","useState","dropdownVisible","setDropdownVisible","useEffect","className","Dropdown","onSelect","onToggle","desiredVisibility","show","alignRight","Toggle","Menu","flip","Item","eventKey","ConnectedToggleMockApi","ConnectedLoadMockButton","count","total","confirmDialogVisible","setConfirmDialogVisible","seedAction","_setSeedAction","inProgress","setInProgress","setStage","progress","setProgress","useThunkDispatch","useSelector","targetSession","seedActions","seedUsers","seedSession","seedContractTemplate","instructors10","seedInstructors","position10","seedPositions","applicant10","seedApplicants","assignment10","seedAssignments","seedApplications","instructorPref","seedInstructorPreferences","matching","mockSessionData","toLocaleString","limit","some","inst","newInstructor","initialUser","currUser","newApp","program_start","previous_other_university_ta","answers","targetApplication","currApplication","targetPosition","currPosition","applications_visible_to_instructors","open_status","newPosting","sessionPositions","floor","Header","Modal","onHide","size","closeButton","Title","Body","Fragment","Footer","style","display","justifyContent","alignItems","ProgressBar","now","label","minWidth","DevFrame","Navbar","expand","Brand","Collapse","Suspense","fallback","docExpansion","FallbackComponent","onError","fetchOfferSuccess","FETCH_ONE_OFFER_SUCCESS","setOfferAcceptedSuccess","SET_OFFER_ACCEPTED_SUCCESS","setOfferRejectedSuccess","SET_OFFER_REJECTED_SUCCESS","offerCreateSuccess","OFFER_CREATE_SUCCESS","offerEmailSuccess","OFFER_EMAIL_SUCCESS","offerNagSuccess","OFFER_NAG_SUCCESS","offerWithdrawSuccess","OFFER_WITHDRAW_SUCCESS","fetchOffersForAssignmentSuccess","FETCH_OFFERS_FOR_ASSIGNMENT_SUCCESS","fetchOfferHistoryForAssignment","setOfferForAssignmentAccepted","setOfferForAssignmentRejected","offerForAssignmentWithdraw","offerForAssignmentCreate","offerForAssignmentEmail","offerForAssignmentNag","useDispatch","numbers","num","compareString","str1","str2","capitalize","word","charAt","toUpperCase","strip","trim","formatDate","dateString","normalizedDateString","formatDateTime","formatDownloadUrl","arrayDiff","guessActiveSession","oneMonth","diff","sessionStart","formatMoney","moneyString","isFinite","parseFloat","toFixed","places","pow"],"mappings":"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U,2BACVd,GAAI,KAER,CACI0C,KAAM,GACNE,YAAa,GACbV,aAAc,KACdrB,WAAY,2BACZC,SAAU,2BACVd,GAAI,KAER,CACI0C,KAAM,GACNE,YAAa,GACbV,aAAc,KACdrB,WAAY,2BACZC,SAAU,2BACVd,GAAI,KAER,CACI0C,KAAM,GACNE,YAAa,GACbV,aAAc,KACdrB,WAAY,2BACZC,SAAU,2BACVd,GAAI,KAER,CACI0C,KAAM,GACNE,YAAa,GACbV,aAAc,KACdrB,WAAY,2BACZC,SAAU,2BACVd,GAAI,KAER,CACI0C,KAAM,GACNE,YAAa,GACbV,aAAc,IACdrB,WAAY,2BACZC,SAAU,2BACVd,GAAI,KAER,CACI0C,KAAM,GACNE,YAAa,GACbV,aAAc,KACdrB,WAAY,2BACZC,SAAU,2BACVd,GAAI,KAER,CACI0C,KAAM,GACNE,YAAa,GACbV,aAAc,KACdrB,WAAY,2BACZC,SAAU,2BACVd,GAAI,MAGZgZ,YAAa,CACT,CACIhZ,GAAI,IACJuF,cAAe,IACflC,MAAO,GACPxC,WAAY,2BACZC,SAAU,2BACVwC,KAAM,OAEV,CACItD,GAAI,KACJuF,cAAe,IACflC,MAAO,GACPxC,WAAY,2BACZC,SAAU,2BACVwC,KAAM,OAEV,CACItD,GAAI,KACJuF,cAAe,IACflC,MAAO,GACPxC,WAAY,2BACZC,SAAU,2BACVwC,KAAM,MAEV,CACItD,GAAI,KACJuF,cAAe,IACflC,MAAO,IACPxC,WAAY,2BACZC,SAAU,4BAEd,CACId,GAAI,KACJuF,cAAe,IACflC,MAAO,IACPxC,WAAY,2BACZC,SAAU,4BAEd,CACId,GAAI,KACJuF,cAAe,IACflC,MAAO,IACPxC,WAAY,2BACZC,SAAU,4BAEd,CACId,GAAI,KACJuF,cAAe,IACflC,MAAO,IACPxC,WAAY,2BACZC,SAAU,4BAEd,CACId,GAAI,KACJuF,cAAe,IACflC,MAAO,IACPxC,WAAY,2BACZC,SAAU,4BAEd,CACId,GAAI,KACJuF,cAAe,IACflC,MAAO,IACPxC,WAAY,2BACZC,SAAU,4BAEd,CACId,GAAI,KACJuF,c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","file":"static/js/9.5452e899.chunk.js","sourcesContent":["/*\n * A collection of utility functions for interfacing with the API\n */\n\nimport { RawPosting, RawSession } from \"../api/defs/types\";\n\nconst API_URL = \"/api/v1\";\nconst FETCH_INIT: RequestInit = {\n    credentials: \"same-origin\",\n    headers: {\n        \"Content-Type\": \"application/json\",\n    },\n};\n\n/**\n * Error thrown whenever an api call returns with `status===\"error\"`\n *\n * @class ApiError\n * @extends {Error}\n */\nclass ApiError extends Error {\n    response: Partial<Response>;\n    status: Response[\"status\"];\n\n    constructor(resp: Pick<Response, \"status\"> & { message: string }) {\n        const errorMessage = resp.message;\n        super(errorMessage);\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, ApiFetchError);\n        }\n        this.response = resp;\n        this.status = resp.status;\n    }\n}\n\n/**\n * Error thrown whenever an api fetch request\n * returns with a status other than 200\n *\n * @class ApiFetchError\n * @extends {ApiError}\n */\nclass ApiFetchError extends ApiError {\n    constructor(resp: Response, path: string) {\n        const errorMessage = `Got status ${resp.status} ${\n            resp.statusText\n        } when fetching ${API_URL + path}`;\n        super({ ...resp, message: errorMessage });\n    }\n}\n\n// Ensure that `path` starts with a `/`\nfunction _ensurePath(path: string) {\n    return path.startsWith(\"/\") ? path : \"/\" + path;\n}\n\n// Process a `fetch` response from the API.\n// Successful responses from the API should be of\n// the form `{status: (\"success\"|\"error\"), message: \"...\", payload: ...}.\n// Throw an error on a failed HTTP request or a `status !== \"success\"`\n// response from the API.\nasync function _processFetchResponse(resp: Response, path: string) {\n    if (resp.status === 200) {\n        const json = await resp.json();\n        if (json.status !== \"success\") {\n            // If we got random JSON instead of {status: ..., message: ..., payload: ...}\n            // There will be no `json.message`. Provide a default message that will get\n            // overridden in this case\n            throw new ApiError({\n                message: \"Server response did not have `status === 'success`\",\n                ...json,\n            });\n        }\n        return json.payload;\n    }\n    // if we made it this far, there was a bad status\n    // returned during fetch\n    throw new ApiFetchError(resp, path);\n}\n\n/**\n * Do a GET request on the specified api route. This function has sophisticated automatic\n * type inference when using Typescript that works on constant string types (e.g., `apiGET(\"/sessions\")`). If you\n * want type inference when using template literals, you must declare the template literal `as const`\n * (e.g. ``apiGET(`/sessions` as const)``).\n *\n * If `omitPrefix == true`, then `/api/v1` will not be prepended to the start of\n * the request.\n *\n * @param path\n * @returns Promise containing the processed JSON response\n * @throws {(ApiError|ApiFetchError|Error)} Throws an error if the fetch fails or returns with `status===\"error\"`\n */\nasync function apiGET<Path extends string, Ret = ApiGetReturnType<Path>>(\n    path: Path,\n    omitPrefix = false\n): Promise<Ret> {\n    // remove a leading \"/\" if there is one in `path`\n    path = _ensurePath(path) as Path;\n    const resp = await fetch((omitPrefix ? \"\" : API_URL) + path, {\n        ...FETCH_INIT,\n        method: \"GET\",\n    });\n    return await _processFetchResponse(resp, path);\n}\n\n/**\n * Do a POST request on the specified api route. If `omitPrefix == true`, `/api/v1` will\n * not be inserted at the front of the URL\n *\n * @param path\n * @param  [body={}]\n * @returns Promise containing the processed JSON response\n * @throws {(ApiError|ApiFetchError|Error)} Throws an error if the fetch fails or returns with `status===\"error\"`\n */\nasync function apiPOST(path: string, body: any = {}, omitPrefix = false) {\n    // remove a leading \"/\" if there is one in `path`\n    path = _ensurePath(path);\n    const resp = await fetch((omitPrefix ? \"\" : API_URL) + path, {\n        ...FETCH_INIT,\n        method: \"POST\",\n        body: JSON.stringify(body),\n    });\n    return await _processFetchResponse(resp, path);\n}\n\nexport { API_URL, ApiError, ApiFetchError, apiGET, apiPOST };\n\n// XXX TODO: this is the start of a type system for typing API\n// requests. However, it appears not to be usable in TypeScript 4.2 with template literals,\n// which we use all over the code. See https://stackoverflow.com/questions/66739139/typescript-infer-temlate-lieral-from-const-template-literal/66739356#66739356\ntype PathVariable = string;\ntype ExtractPathVariable<T extends string> = T extends `:${string}`\n    ? PathVariable\n    : T;\n/**\n * A type that breaks `Path` up by `/` characters and leaves any part of\n * the path starting with `:` as a general string. For example,\n * `PathParts<\"/sessions/43/posts\"> == typeof [\"sessions\", \"43\", \"posts\"]` and\n * `PathParts<\"/sessions/:session_id/posts\"> == typeof [\"sessions\", string, \"posts\"]`.\n *\n * As such, `PathParts<\"/sessions/43/posts\"> extends PathParts<\"/sessions/:session_id/posts\">`,\n * and so `PathParts` can be used for Url route matching.\n */\ntype PathParts<Path extends string> = Path extends `/${infer Rest}`\n    ? PathParts<Rest>\n    : Path extends `${infer Start}/${infer Rest}`\n    ? [ExtractPathVariable<Start>, ...PathParts<`${Rest}`>]\n    : Path extends `${infer Item}`\n    ? [ExtractPathVariable<Item>]\n    : never;\n\ntype ApiGetReturnType<\n    Url extends string,\n    UrlPath = PathParts<Url>\n> = UrlPath extends PathParts<\"/:role/sessions\">\n    ? RawSession[]\n    : UrlPath extends PathParts<\"/:role/sessions/:/postings\">\n    ? RawPosting[]\n    : unknown;\n","import * as OrigPropTypes from \"prop-types\";\n\n/**\n * Generate proptypes for API responses using the passed-in proptypes function.\n * This is encapsulated so that `PropTypes` can be replaced (for example, with a proxy\n * used for documentation generation).\n *\n * @param {*} PropTypes - a PropTypes function (coming from the `\"prop-types\"` module or elsewhere)\n * @returns an object of PropTypes\n */\nfunction generatePropTypes(PropTypes: typeof OrigPropTypes) {\n    const id = PropTypes.oneOfType([PropTypes.number, PropTypes.string]);\n\n    return {\n        apiResponse: PropTypes.shape({\n            status: PropTypes.oneOf([\"success\", \"error\"]).isRequired,\n            message: PropTypes.string,\n            payload: PropTypes.any,\n        }),\n        apiResponseSuccess: PropTypes.shape({\n            status: PropTypes.oneOf([\"success\"]).isRequired,\n            message: PropTypes.string,\n            payload: PropTypes.any,\n        }),\n        apiResponseError: PropTypes.shape({\n            status: PropTypes.oneOf([\"error\"]).isRequired,\n            message: PropTypes.string.isRequired,\n            payload: PropTypes.any,\n        }),\n        idOnly: PropTypes.shape({\n            id,\n        }),\n        session: PropTypes.shape({\n            id,\n            start_date: PropTypes.string,\n            end_date: PropTypes.string,\n            name: PropTypes.string.isRequired,\n        }),\n        contractTemplateMinimal: PropTypes.shape({\n            template_file: PropTypes.string,\n        }),\n        contractTemplate: PropTypes.shape({\n            template_file: PropTypes.string,\n            template_name: PropTypes.string,\n        }),\n        position: PropTypes.shape({\n            position_code: PropTypes.string.isRequired,\n            position_title: PropTypes.string,\n            hours_per_assignment: PropTypes.number,\n            start_date: PropTypes.string,\n            end_date: PropTypes.string,\n            contract_template_id: id,\n            duties: PropTypes.string,\n            qualifications: PropTypes.string,\n            desired_num_assignments: PropTypes.number,\n            current_enrollment: PropTypes.number,\n            current_waitlisted: PropTypes.number,\n            instructor_ids: PropTypes.arrayOf(id),\n            instructor_preference: PropTypes.arrayOf(\n                PropTypes.shape({\n                    preference_level: PropTypes.number,\n                    applicant_id: id,\n                    instructor_id: id,\n                })\n            ),\n        }),\n        instructor: PropTypes.shape({\n            first_name: PropTypes.string.isRequired,\n            last_name: PropTypes.string.isRequired,\n            email: PropTypes.string,\n            utorid: PropTypes.string.isRequired,\n        }),\n        assignment: PropTypes.shape({\n            start_date: PropTypes.string,\n            end_date: PropTypes.string,\n            note: PropTypes.string,\n            contract_override_pdf: PropTypes.string,\n            applicant_id: id.isRequired,\n            position_id: id.isRequired,\n            active_offer_status: PropTypes.oneOf([\n                \"accepted\",\n                \"rejected\",\n                \"withdrawn\",\n                \"provisional\",\n                \"pending\",\n                \"no_offer\",\n                null,\n            ]),\n            active_offer_url_token: PropTypes.string,\n            active_offer_recent_activity_date: PropTypes.string,\n            active_offer_nag_count: PropTypes.number,\n        }),\n        applicant: PropTypes.shape({\n            utorid: PropTypes.string.isRequired,\n            student_number: PropTypes.string,\n            first_name: PropTypes.string.isRequired,\n            last_name: PropTypes.string.isRequired,\n            email: PropTypes.string,\n            phone: PropTypes.string,\n        }),\n        wageChunk: PropTypes.shape({\n            start_date: PropTypes.string,\n            end_date: PropTypes.string,\n            hours: PropTypes.number,\n            rate: PropTypes.number,\n        }),\n        reportingTag: PropTypes.shape({\n            name: PropTypes.string,\n        }),\n        offer: PropTypes.shape({\n            first_name: PropTypes.string,\n            last_name: PropTypes.string,\n            email: PropTypes.string,\n            position_code: PropTypes.string,\n            position_title: PropTypes.string,\n            position_start_date: PropTypes.string,\n            position_end_date: PropTypes.string,\n            first_time_ta: PropTypes.bool,\n            instructor_contact_desc: PropTypes.string,\n            pay_period_desc: PropTypes.string,\n            installments: PropTypes.number,\n            ta_coordinator_name: PropTypes.string,\n            ta_coordinator_email: PropTypes.string,\n            emailed_date: PropTypes.string,\n            status: PropTypes.string,\n            accepted_date: PropTypes.string,\n            rejected_date: PropTypes.string,\n            withdrawn_date: PropTypes.string,\n            url_token: PropTypes.string,\n            nag_count: PropTypes.number,\n        }),\n        application: PropTypes.shape({\n            posting_id: id,\n            applicant_id: id,\n            comments: PropTypes.string,\n            program: PropTypes.string,\n            department: PropTypes.string,\n            previous_department_ta: PropTypes.bool,\n            previous_university_ta: PropTypes.bool,\n            previous_experience_summary: PropTypes.string,\n            yip: PropTypes.number,\n            annotation: PropTypes.string,\n            submission_date: PropTypes.string,\n            position_preference: PropTypes.arrayOf(\n                PropTypes.shape({\n                    preference_level: PropTypes.number,\n                    position_id: id,\n                })\n            ),\n        }),\n        user: PropTypes.shape({\n            utorid: PropTypes.string,\n            roles: PropTypes.arrayOf(PropTypes.string),\n        }),\n        ddah: PropTypes.shape({\n            assignment_id: id,\n            signature: PropTypes.string,\n            approved_date: PropTypes.string,\n            accepted_date: PropTypes.string,\n            revised_date: PropTypes.string,\n            emailed_date: PropTypes.string,\n            url_token: PropTypes.string,\n            duties: PropTypes.arrayOf(\n                PropTypes.shape({\n                    description: PropTypes.string,\n                    hours: PropTypes.number,\n                    order: PropTypes.number,\n                })\n            ),\n        }),\n        posting: PropTypes.shape({\n            name: PropTypes.string,\n            intro_text: PropTypes.string,\n            open_date: PropTypes.string,\n            close_date: PropTypes.string,\n            availability: PropTypes.oneOf([\"auto\", \"open\", \"closed\"]),\n            custom_questions: PropTypes.any,\n            application_ids: PropTypes.arrayOf(id),\n        }),\n        posting_position: PropTypes.shape({\n            hours: PropTypes.number,\n            num_positions: PropTypes.number,\n            position_id: id,\n            posting_id: id,\n        }),\n        instructor_preference: PropTypes.shape({\n            preference_level: PropTypes.number,\n            comment: PropTypes.string,\n            position_id: id,\n            posting_id: id,\n        }),\n        survey: PropTypes.shape({\n            title: PropTypes.string,\n            pages: PropTypes.arrayOf(\n                PropTypes.shape({\n                    name: PropTypes.string,\n                    elements: PropTypes.arrayOf(\n                        PropTypes.shape({\n                            type: PropTypes.string,\n                            name: PropTypes.string,\n                            title: PropTypes.string,\n                        })\n                    ),\n                })\n            ),\n        }),\n    };\n}\n\nconst apiPropTypes = generatePropTypes(OrigPropTypes);\n\nexport { apiPropTypes, generatePropTypes };\n","/**\n * Tools for generating documentation\n */\n\nimport PropTypes from \"prop-types\";\nimport RouteParser from \"route-parser\";\nimport { generatePropTypes } from \"./prop-types\";\nimport { UserRole } from \"./types\";\n\nclass CallAtom {\n    name: string;\n    args?: any[];\n\n    constructor(prop: string, args?: any[]) {\n        this.name = prop;\n        this.args = args;\n    }\n    toString() {\n        if (this.args == null) {\n            return \"\" + this.name;\n        }\n        return \"\" + this.name + \"(\" + this.args.join(\", \") + \")\";\n    }\n}\nfunction createCallChain(chain: CallAtom[] = [], prop: string, args?: any[]) {\n    return chain.concat([new CallAtom(prop, args)]);\n}\n/**\n * A proxy to wrap `PropTypes` so that the call chain can be recorded.\n * For example, `PropTypes.bool.isRequired` would have the added method `.callChain`\n * which would return an array of `CallAtom` objects consisting of `bool` and `isRequired`.\n * This can be used to generate documentation from existing proptype definitions.\n *\n * @param {*} innerObj\n * @param {*} [callChain=[]]\n * @returns\n */\nfunction propTypesProxy<T extends object | Function>(\n    innerObj: T,\n    callChain: CallAtom[] = []\n) {\n    const handler: ProxyHandler<T> = {\n        get(obj, prop: string, receiver) {\n            if (prop === \"callChain\") {\n                return callChain;\n            } else if (prop === \"toJSON\") {\n                return () => callChain;\n            }\n            const ret = Reflect.get(obj, prop, receiver);\n            if (ret instanceof Object) {\n                return propTypesProxy(ret, createCallChain(callChain, prop));\n            }\n            return ret;\n        },\n        apply(obj, thisArg, args) {\n            const lastProp = callChain.pop() || { name: \"<root>\" };\n            const ret = Reflect.apply(obj as any, thisArg, args);\n            if (ret instanceof Object) {\n                return propTypesProxy(\n                    ret,\n                    createCallChain(callChain, lastProp.name, args)\n                );\n            }\n            return ret;\n        },\n        ownKeys(obj) {\n            return [...Reflect.ownKeys(obj), \"callChain\", \"toJSON\"];\n        },\n    };\n\n    return new Proxy(innerObj, handler);\n}\nconst wrappedPropTypes = propTypesProxy(PropTypes);\n/**\n * PropType definitions for the API that have been wrapped in\n * a proxy so they can be converted into documentation.\n */\nconst docApiPropTypes = generatePropTypes(wrappedPropTypes);\n\nconst PROPTYPES_TO_SWAGGER_TYPES = {\n    string: \"string\",\n    number: \"number\",\n    bool: \"boolean\",\n    object: \"object\",\n    array: \"array\",\n    any: {},\n};\n\nfunction wrappedPropTypesToSwagger(pt: any) {\n    const ret: Record<string, any> = {};\n    if (!pt.callChain) {\n        // eslint-disable-next-line\n        console.warn(\n            \"Attempting to compute swagger values for non-wrapped object\",\n            pt\n        );\n    } else {\n        // We are a proxied PropTypes object\n        //\n        // PropTypes calls can be at most two long with the second argument\n        // being `.isRequired`\n        const [type, isRequired] = pt.callChain;\n        const requiredList = [];\n        if (isRequired) {\n            ret[\"required\"] = true;\n        }\n        if (type.args) {\n            // in this case, we were a PropTypes function called with some arguments\n            switch (type.name) {\n                case \"shape\":\n                    // in this case we're passing in an object with properties to be validated\n                    ret[\"type\"] = \"object\";\n                    ret[\"properties\"] = {};\n                    for (const [key, val] of Object.entries(type.args[0])) {\n                        const swaggerVal = wrappedPropTypesToSwagger(val);\n                        if (swaggerVal[\"required\"]) {\n                            // Required properties in swagger must be listed up-front (i.e., as a list\n                            // of property names, not as an attribute of an individual property),\n                            // so hoist them.\n                            requiredList.push(key);\n                            delete swaggerVal[\"required\"];\n                        }\n                        ret[\"properties\"][key] = swaggerVal;\n                    }\n                    if (requiredList.length > 0) {\n                        ret[\"required\"] = requiredList;\n                    }\n                    break;\n                case \"arrayOf\":\n                    ret[\"type\"] = \"array\";\n                    ret[\"items\"] = wrappedPropTypesToSwagger(type.args[0]);\n                    break;\n                case \"oneOf\":\n                    // XXX assuming `oneOf` is only used for strings\n                    ret[\"type\"] = \"string\";\n                    ret[\"enum\"] = type.args[0];\n                    break;\n                case \"oneOfType\":\n                    ret[\"oneOf\"] = type.args[0].map(wrappedPropTypesToSwagger);\n                    break;\n                default:\n                    break;\n            }\n        } else {\n            if (type.name in PROPTYPES_TO_SWAGGER_TYPES) {\n                // in this case, we're a basic swagger type\n                ret[\"type\"] =\n                    PROPTYPES_TO_SWAGGER_TYPES[\n                        type.name as keyof typeof PROPTYPES_TO_SWAGGER_TYPES\n                    ];\n            }\n        }\n    }\n\n    return ret;\n}\n\n/**\n * Wrap `payload` in a standard API response formatted\n * for openapi\n *\n * @param {object} payload\n * @returns {object}\n */\nfunction wrapInStandardApiResponseForSwagger(payload = { type: \"object\" }) {\n    return {\n        type: \"object\",\n        properties: {\n            status: {\n                type: \"string\",\n                enum: [\"success\", \"error\"],\n            },\n            message: { type: \"string\" },\n            payload,\n        },\n        required: [\"status\"],\n    };\n}\n\n/**\n * Take a path template in `\"route-parser\"`\n * form, e.g. `/sessions/:session_id`, and encode it for\n * consumption by swagger, e.g., `/sessions/{session_id}`.\n *\n * @param url\n * @returns\n */\nfunction urlTemplateToSwagger(url: string) {\n    // get the template variables\n    // using a trick: have the RouteParsers\n    // parse it's own template, giving us\n    // a list of variables in the process\n    const parsed = new RouteParser(url);\n    const templateVars = Object.keys(parsed.match((parsed as any).spec));\n    const subs: Record<string, string> = {};\n    for (const templateVar of templateVars) {\n        subs[templateVar] = \"{\" + templateVar + \"}\";\n    }\n    return { url: decodeURI(parsed.reverse(subs) || \"\"), templateVars };\n}\n\ninterface SwaggerDoc {\n    summary: string;\n    parameters: {\n        name: string;\n        in: string;\n        description: string;\n        required: boolean;\n    }[];\n    responses: {\n        default: {\n            content: { \"application/json\": { schema: any } };\n        };\n    };\n    requestBody: { content: { \"application/json\": { schema: any } } };\n    tags: string[];\n}\n\n/**\n * Convert the `docs` attribute from a callback that\n * has been documented with `documentCallback` into an openapi\n * object.\n *\n * @param docs\n * @param [templateVars=[]] - list of template variables in the route\n * @returns openapi object\n */\nfunction documentedCallbackToSwagger(\n    docs: DocumentCallbackArgs,\n    templateVars: string[] = []\n) {\n    const ret: SwaggerDoc = { responses: { default: {} } } as SwaggerDoc;\n    if (!docs) {\n        return ret;\n    }\n    // Routes are all prefixed. `admin` can access all routes.\n    // other routes are restricted depending on the list specified in `roles`.\n    const prefixRoles = [\"admin\", ...(docs.roles || [])];\n    ret.summary =\n        `(prefixes: ${prefixRoles.map((x) => \"/\" + x).join(\", \")}) ` +\n        docs.summary;\n    // If there are templateVars, they should become `parameters`\n    if (templateVars.length > 0) {\n        ret.parameters = templateVars.map((x) => ({\n            name: x,\n            in: \"path\",\n            description: x,\n            required: true,\n        }));\n    }\n    // `docs.returns` holds information about what the route will return\n    if (docs.returns) {\n        ret.responses.default = {\n            content: {\n                \"application/json\": {\n                    schema: wrapInStandardApiResponseForSwagger(\n                        wrappedPropTypesToSwagger(docs.returns) as any\n                    ),\n                },\n            },\n        };\n    }\n    // `docs.posts` holds information about what you can put in the\n    // requestBody\n    if (docs.posts) {\n        ret.requestBody = {\n            content: {\n                \"application/json\": {\n                    schema: wrappedPropTypesToSwagger(docs.posts),\n                },\n            },\n        };\n    }\n\n    return ret;\n}\n\n/**\n * Turn mockAPI routes into swagger-ui JSON object\n *\n * @param [mockAPI={}]\n * @returns openapi configuration\n */\nfunction mockApiRoutesAsSwaggerPaths(\n    mockAPI: {\n        getRoutes?: Record<string, ReturnType<typeof documentCallback>>;\n        postRoutes?: Record<string, ReturnType<typeof documentCallback>>;\n    } = {}\n) {\n    const { getRoutes = {}, postRoutes = {} } = mockAPI;\n    const ret: Record<string, Record<\"get\" | \"post\", SwaggerDoc>> = {} as any;\n    for (const [path, val] of Object.entries(getRoutes)) {\n        const { url: templatePath, templateVars } = urlTemplateToSwagger(path);\n        if (val.docs && val.docs.exclude) {\n            continue;\n        }\n        ret[templatePath] = Object.assign(ret[templatePath] || {}, {\n            get: documentedCallbackToSwagger(\n                val.docs as DocumentCallbackArgs,\n                templateVars\n            ),\n        });\n    }\n    for (const [path, val] of Object.entries(postRoutes)) {\n        const { url: templatePath, templateVars } = urlTemplateToSwagger(path);\n        if (val.docs && val.docs.exclude) {\n            continue;\n        }\n        ret[templatePath] = Object.assign(ret[templatePath] || {}, {\n            post: documentedCallbackToSwagger(\n                val.docs as DocumentCallbackArgs,\n                templateVars\n            ),\n        });\n    }\n\n    // The initial segment of each route is a \"tag\"; get a unique\n    // list of each of these tags and then for annotating the routes\n    const tags = Array.from(\n        new Set(\n            Object.keys(ret)\n                .map((x) => x.split(\"/\")[1])\n                .filter((x) => x)\n        )\n    );\n    // If a route contains one of the \"tags\", then it should be annotated\n    // accordingly (with each relevant tag)\n    for (const [path, info] of Object.entries(ret)) {\n        const applicableTags = tags.filter((x) => path.includes(x));\n        if (info.get && applicableTags.length > 0) {\n            info.get.tags = applicableTags;\n        }\n        if (info.post && applicableTags.length > 0) {\n            info.post.tags = applicableTags;\n        }\n    }\n\n    // Alphabetize the routes so they display in a sensible order.\n    const sortedRet: Record<string, any> = {};\n    for (const path of Object.keys(ret).sort()) {\n        sortedRet[path] = ret[path];\n    }\n\n    return sortedRet;\n}\n\nexport interface RouteParams {\n    role: \"admin\" | \"instructor\" | \"ta\";\n    [key: string]: string;\n}\n\ninterface DocumentCallbackArgs {\n    func: Function;\n    summary: string;\n    posts?: any;\n    returns?: any;\n    roles?: UserRole[];\n    exclude?: boolean;\n}\n\n/**\n * Document a function with attributes for auto-generating openapi\n * specifications from.\n *\n * @param {*} { func, exclude = false, ...attrs }\n * @returns\n */\nfunction documentCallback({\n    func,\n    exclude = false,\n    ...attrs\n}: DocumentCallbackArgs) {\n    // create a wrapped function that we can stuff attributes onto\n    const ret = <T>(...args: [T, ...any]) => func(...args);\n    ret.docs = {\n        exclude,\n        ...attrs,\n    };\n    return ret;\n}\n\nexport {\n    wrappedPropTypes,\n    wrappedPropTypesToSwagger,\n    urlTemplateToSwagger,\n    mockApiRoutesAsSwaggerPaths,\n    documentCallback,\n    docApiPropTypes,\n};\n","import { error } from \"react-notification-system-redux\";\n\n// these properties are for `react-notification-system-redux`\nconst defaultNotifProps = {\n    position: \"tr\",\n    autoDismiss: 10,\n    title: \"Error\",\n} as const;\n\nexport const fetchError = (payload: string) =>\n    error({\n        ...defaultNotifProps,\n        title: \"Error fetching data\",\n        message: payload,\n    });\n\nexport const upsertError = (payload: string) =>\n    error({\n        ...defaultNotifProps,\n        title: \"Error updating/inserting data\",\n        message: payload,\n    });\n\nexport const deleteError = (payload: string) =>\n    error({\n        ...defaultNotifProps,\n        title: \"Error deleting data\",\n        message: payload,\n    });\n\n// General error for when a more specific error\n// type is not known\nexport const apiError = (payload: string) =>\n    error({\n        ...defaultNotifProps,\n        title: \"API Error\",\n        message: payload,\n    });\n","import {\n    FETCH_ACTIVE_USER_SUCCESS,\n    FETCH_USERS_SUCCESS,\n    UPSERT_USERS_SUCCESS,\n    SET_ACTIVE_USER_ROLE_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport { actionFactory, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { usersReducer } from \"../reducers/users\";\nimport { initFromStage } from \"./init\";\nimport type { ActiveUser, User, UserRole } from \"../defs/types\";\nimport { RootState } from \"../../rootReducer\";\nimport { globalsSelector, setGlobals } from \".\";\n\n// actions\nconst fetchActiveUserSuccess = actionFactory<ActiveUser>(\n    FETCH_ACTIVE_USER_SUCCESS\n);\nconst fetchUsersSuccess = actionFactory<User[]>(FETCH_USERS_SUCCESS);\nconst upsertUserSuccess = actionFactory<User>(UPSERT_USERS_SUCCESS);\nconst setActiveUserRoleSuccess = actionFactory<UserRole | null>(\n    SET_ACTIVE_USER_ROLE_SUCCESS\n);\n\n/**\n * Determines whether `role` is a valid UserRole.\n */\nfunction isValidRole(role: any): role is UserRole {\n    if (typeof role !== \"string\") {\n        return false;\n    }\n    if ([\"admin\", \"instructor\", \"ta\"].includes(role)) {\n        return true;\n    }\n    return false;\n}\n\n// dispatchers\nexport const fetchActiveUser = validatedApiDispatcher({\n    name: \"fetchActiveUser\",\n    description: \"Fetch the active user\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const data = (await apiGET(`/active_user`)) as ActiveUser;\n        dispatch(fetchActiveUserSuccess(data));\n        // If our currently-set role is one that we don't have,\n        // set our role to one we do have.\n        const currentRole =\n            activeRoleSelector(getState()) || globalsSelector(getState()).role;\n        if (isValidRole(currentRole)) {\n            await dispatch(setActiveUserRole(currentRole));\n        } else if (data.roles?.length > 0) {\n            // If there is no currentRole that could be retrieved from\n            // the state, set the role to the \"highest\" available.\n            await dispatch(setActiveUserRole(data.roles[0]));\n        }\n        return data;\n    },\n});\n\nexport const upsertUser = validatedApiDispatcher({\n    name: \"upsertUsers\",\n    description: \"Upserts a user (setting their role(s))\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (user) => async (dispatch) => {\n        const data = await apiPOST(`/admin/users`, user);\n        dispatch(upsertUserSuccess(data));\n        await dispatch(fetchUsers());\n    },\n});\n\nexport const fetchUsers = validatedApiDispatcher({\n    name: \"fetchUsers\",\n    description: \"Fetch all users\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(`/${role}/users`)) as User[];\n        dispatch(fetchUsersSuccess(data));\n        return data;\n    },\n});\n\nexport const setActiveUserRole = validatedApiDispatcher({\n    name: \"setActiveUserRole\",\n    description: \"Sets the role of the active user\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher:\n        (payload: UserRole | null, options: { skipInit?: boolean } = {}) =>\n        async (dispatch) => {\n            if (payload) {\n                dispatch(setGlobals({ role: payload }));\n            }\n            dispatch(setActiveUserRoleSuccess(payload));\n            if (!options.skipInit) {\n                await dispatch(\n                    initFromStage(\"setActiveUserRole\", {\n                        startAfterStage: true,\n                    })\n                );\n            }\n        },\n});\n\nexport const debugOnlyFetchUsers = validatedApiDispatcher({\n    name: \"debugOnlyFetchUsers\",\n    description:\n        \"Fetch all users; this is available only in debug mode and bypasses any user permissions\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: () => async (dispatch) => {\n        const data = (await apiGET(`/debug/users`)) as User[];\n        dispatch(fetchUsersSuccess(data));\n    },\n});\n\nexport const debugOnlyUpsertUser = validatedApiDispatcher({\n    name: \"debugOnlyUpsertUser\",\n    description: \"Upsert a user\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (user: User | Omit<User, \"id\">) => async (dispatch) => {\n        const data = (await apiPOST(`/debug/users`, user)) as User;\n        return dispatch(upsertUserSuccess(data));\n    },\n});\n\nexport const debugOnlySetActiveUser = validatedApiDispatcher({\n    name: \"debugOnlySetActiveUser\",\n    description:\n        \"Sets the active user (i.e. fakes the 'logged on' user); available only in debug mode\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher:\n        (user, options: { skipInit?: boolean } = {}) =>\n        async (dispatch) => {\n            const data = (await apiPOST(\n                `/debug/active_user`,\n                user\n            )) as ActiveUser;\n            dispatch(fetchActiveUserSuccess(data));\n            // The new user we switch to might not have the same roles as the previous user.\n            // Default to the highest-authority role available, which is the first in the list.\n            dispatch(setActiveUserRoleSuccess(data.roles[0]));\n\n            // After the active user has been set, we need to re-download (almost) all data\n            // with the permissions of the new active user.\n            if (!options.skipInit) {\n                await dispatch(initFromStage(\"setActiveUser\"));\n            }\n        },\n});\n\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nconst localStoreSelector = usersReducer._localStoreSelector;\nexport const usersSelector = (state: RootState) =>\n    localStoreSelector(state).users;\nexport const activeUserSelector = (state: RootState) =>\n    localStoreSelector(state).active_user;\nexport const activeRoleSelector = (state: RootState) =>\n    localStoreSelector(state).active_role;\n","import uuid from \"uuid-random\";\nimport { apiError } from \"./errors\";\nimport { apiInteractionStart, apiInteractionEnd } from \"./status\";\nimport { ThunkAction, ThunkDispatch } from \"redux-thunk\";\nimport { Action } from \"redux\";\nimport { HasPayload } from \"../reducers/utils\";\nimport { RootState } from \"../../rootReducer\";\nimport { activeSessionSelector } from \"./sessions\";\n\n/**\n * Turn an array of items into a hash of items indexed\n * by the value of `indexBy`\n *\n */\nexport function arrayToHash<T extends { id: number }>(\n    l: T[],\n    key: keyof T = \"id\"\n): Record<number, T> {\n    if (!Array.isArray(l)) {\n        return l;\n    }\n    const ret: { [key: number]: T } = {};\n    for (const d of l) {\n        ret[d[key] as unknown as number] = d;\n    }\n    return ret;\n}\n\n/**\n * Creates an action function that returns an object of the form\n * ```\n *    {\n *        type: TYPE,\n *        payload: payload\n *    }\n * ```\n * This factory function can be used if your action is of this standard form.\n */\nexport function actionFactory<T>(type: string) {\n    return (payload: T): HasPayload<T> => ({\n        type,\n        payload,\n    });\n}\n\n/**\n * Split an object into two objects. One with only properties listed in\n * `props` and the other with all remaining properties.\n *\n * @param {*} obj - object to be split\n * @param {*} [props=[]] - list of properties to split out\n * @returns list of two objects. The first contains all properties not listed in `props`. The second contains all properties listed in `props`\n */\nexport function splitObjByProps<\n    T extends object,\n    Props extends [...(keyof T)[]]\n>(obj: T, props: Props): [Omit<T, Props[number]>, Pick<T, Props[number]>] {\n    const preserved: Partial<T> = {},\n        removed: Partial<T> = {};\n    for (const prop of props) {\n        if (Object.hasOwnProperty.call(obj, prop)) {\n            removed[prop] = obj[prop];\n        }\n    }\n    for (const prop in obj) {\n        if (!Object.hasOwnProperty.call(removed, prop)) {\n            preserved[prop] = obj[prop];\n        }\n    }\n    return [preserved, removed] as any;\n}\n\nexport type HasId = { id: number };\nexport type HasSubIdField<M extends string> = { [key in M]: HasId };\nexport type HasSubIdFieldArray<M extends string> = { [key in M]: HasId[] };\nexport type HasSubField<M extends string> = { [key in M]: unknown };\n\n/**\n * Test whether `obj` has `key` as an attribute.\n *\n * @template T\n * @template M\n * @param {T} obj\n * @param {M} key\n * @returns {(obj is T & HasSubField<M>)}\n */\nfunction hasSubField<T, M extends string>(\n    obj: T,\n    key: M\n): obj is T & HasSubField<M> {\n    return typeof obj === \"object\" && key in obj;\n}\n\n/**\n * Test whether `obj[key].id` exists.\n *\n * @template M\n * @param {*} obj\n * @param {M} key\n * @returns {obj is HasSubIdField<M>}\n */\nexport function hasSubIdField<M extends string>(\n    obj: any,\n    key: M\n): obj is HasSubIdField<M> {\n    if (typeof obj[key] === \"object\" && \"id\" in obj[key]) {\n        return true;\n    }\n    return false;\n}\n\n/**\n * Test whether `obj[key]` is an array of objects with `id` fields.\n *\n * @template M\n * @param {*} obj\n * @param {M} key\n * @returns {obj is HasSubIdFieldArray<M>}\n */\nfunction hasSubIdFieldArray<M extends string>(\n    obj: any,\n    key: M\n): obj is HasSubIdFieldArray<M> {\n    if (\n        Array.isArray(obj[key]) &&\n        (obj[key].length === 0 ||\n            (typeof obj[key][0] === \"object\" && \"id\" in obj[key][0]))\n    ) {\n        return true;\n    }\n    return false;\n}\n\n/**\n * Create a function that takes an `obj` object. It effectively does\n * `obj[outPropName] = obj[inPropName].id; delete obj[inPropName]` but\n * is non-destructive.\n *\n * ```typescript\n * let orig = { foo: { id: 4 } }\n * let renamed = flattenIdFactory<{ foo: { id: number } }, \"foo\", \"foo_id\">(\n *    \"foo\",\n *    \"foo_id\"\n * )({ foo: { id: 4 } });\n * // `renamed` now has a `foo_id` property.\n * renamed.foo_id === 4\n * ```\n *\n * @returns\n */\nexport function flattenIdFactory<InProp extends string, OutProp extends string>(\n    inPropName: InProp,\n    outPropName: OutProp\n) {\n    return function <T>(\n        obj: T\n    ): T extends HasSubIdField<InProp>\n        ? Omit<T, InProp> & { [key in OutProp]: number }\n        : T extends HasSubIdFieldArray<InProp>\n        ? Omit<T, InProp> & { [key in OutProp]: number[] }\n        : T {\n        // if the `inPropName` field doesn't exist, don't change anything\n        // and don't error!\n        if (!hasSubField(obj, inPropName) || obj[inPropName] == null) {\n            return obj as any;\n        }\n        const [ret, filtered]: [any, any] = splitObjByProps(obj, [inPropName]);\n\n        if (hasSubIdField(filtered, inPropName)) {\n            ret[outPropName] = filtered[inPropName].id;\n        } else if (hasSubIdFieldArray(filtered, inPropName)) {\n            ret[outPropName] = filtered[inPropName].map((x) => x.id);\n        }\n\n        return ret;\n    };\n}\n\ninterface DispatcherParams<RetType, ArgType extends unknown[]> {\n    name: string;\n    description: string;\n    onErrorDispatch: (e: Error) => Action;\n    dispatcher: (\n        ...args: ArgType\n    ) => ThunkAction<RetType | Promise<RetType>, RootState, void, Action>;\n}\n\n/**\n * Create a dispatcher that validates `payload` according to the specified\n * `propTypes`. If validation fails, a warning will be printed to the console\n * and execution of the dispatcher will stop. This function also wraps the\n * dispatch in `apiInteractionStart` and `apiInteractionEnd` actions.\n *\n * If the action only accepts one argument, then `propTypes` should be a single\n * `PropTypes` object (e.g., `{id: PropTypes.any.isRequired}`). If the action\n * accepts multiple arguments, `propTypes` should be an array (of length the number\n * of accepted arguments) of `PropTypes` objects.\n *\n * @export\n * @param obj An object with information to create an action\n * @param obj.dispatcher The action that will be dispatched after validation passes\n * @param obj.name The name of the action\n * @param obj.description A description of what the action does\n * @param obj.onErrorDispatch Function that returns an action to be executed on error, or boolean `true` to auto-generate an error action\n * @returns A redux-thunk action\n */\nexport function validatedApiDispatcher<RetType, ArgType extends unknown[]>({\n    dispatcher,\n    name,\n    description,\n    onErrorDispatch,\n}: DispatcherParams<RetType, ArgType>) {\n    return (...args: ArgType) => {\n        // we return a new dispatcher that performs some validation\n        // and then dispatches as usual\n        return async (\n            dispatch: ThunkDispatch<RootState, void, Action>\n        ): Promise<RetType> => {\n            // Declare the start of an API interaction. Generate a `statusId`\n            // so that we can specify which API interaction is ending (since multiple\n            // ones may be going at the same time).\n            const statusId = uuid();\n            dispatch(apiInteractionStart(statusId, description));\n            try {\n                // We need to await so that promise errors get thrown\n                // as real errors\n                const ret = await dispatch(dispatcher(...args));\n                return ret;\n            } catch (e: any) {\n                console.warn(\"API Error\", e);\n                if (onErrorDispatch) {\n                    if (onErrorDispatch instanceof Function) {\n                        dispatch(onErrorDispatch(e));\n                    } else {\n                        dispatch(\n                            apiError(\n                                `Error encountered during \"${description}\"`\n                            )\n                        );\n                    }\n                }\n                throw e;\n            } finally {\n                // Always declare the API interaction done, even\n                // if there was an error somewhere along the way.\n                dispatch(apiInteractionEnd(statusId));\n            }\n        };\n    };\n}\n\n/**\n * Is the current session's id equal to `desiredSessionId`?\n */\nexport function isSameSession(\n    desiredSessionId: number,\n    getState: () => RootState\n): boolean {\n    const newSessionId = activeSessionSelector(getState())?.id;\n    return desiredSessionId === newSessionId;\n}\n","import { createSelector } from \"reselect\";\nimport {\n    FETCH_SESSIONS_SUCCESS,\n    FETCH_ONE_SESSION_SUCCESS,\n    UPSERT_ONE_SESSION_SUCCESS,\n    DELETE_ONE_SESSION_SUCCESS,\n    SET_ACTIVE_SESSION,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError, apiError } from \"./errors\";\nimport { actionFactory, HasId, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { sessionsReducer } from \"../reducers/sessions\";\nimport { activeRoleSelector } from \"./users\";\nimport { clearSessionDependentData, initFromStage } from \"./init\";\nimport type { RawSession, Session } from \"../defs/types\";\n\n// actions\nexport const fetchSessionsSuccess = actionFactory<RawSession[]>(\n    FETCH_SESSIONS_SUCCESS\n);\nconst fetchOneSessionSuccess = actionFactory<RawSession>(\n    FETCH_ONE_SESSION_SUCCESS\n);\nconst upsertOneSessionSuccess = actionFactory<RawSession>(\n    UPSERT_ONE_SESSION_SUCCESS\n);\nconst deleteOneSessionSuccess = actionFactory<RawSession>(\n    DELETE_ONE_SESSION_SUCCESS\n);\nconst setActiveSessionAction = actionFactory<RawSession | null>(\n    SET_ACTIVE_SESSION\n);\n\n// dispatchers\nexport const fetchSessions = validatedApiDispatcher({\n    name: \"fetchSessions\",\n    description: \"Fetch sessions\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        try {\n            const role = activeRoleSelector(getState());\n            const data = (await apiGET(`/${role}/sessions`)) as RawSession[];\n            dispatch(fetchSessionsSuccess(data));\n            return data;\n        } catch (e: any) {\n            dispatch(fetchSessionsSuccess([]));\n            return [];\n        }\n    },\n});\n\nexport const fetchSession = validatedApiDispatcher({\n    name: \"fetchSession\",\n    description: \"Fetch session\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/sessions/${payload.id}`\n        )) as RawSession;\n        dispatch(fetchOneSessionSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertSession = validatedApiDispatcher({\n    name: \"upsertSession\",\n    description: \"Add/insert session\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload: Partial<Session>) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiPOST(\n            `/${role}/sessions`,\n            payload\n        )) as RawSession;\n        dispatch(upsertOneSessionSuccess(data));\n        return data;\n    },\n});\n\nexport const deleteSession = validatedApiDispatcher({\n    name: \"deleteSession\",\n    description: \"Delete session\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload: Partial<Session>) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiPOST(\n            `/${role}/sessions/delete`,\n            payload\n        )) as RawSession;\n        dispatch(deleteOneSessionSuccess(data));\n    },\n});\n\n/**\n * Sets the `activeSession`. `activeSession` is used\n * in other API calls, so changing the active session may\n * trigger changes in other data (for example, `instructors` or `positions`)\n *\n * @param {object} payload - The session to set active\n */\nexport const setActiveSession = validatedApiDispatcher({\n    name: \"setActiveSession\",\n    description: \"Set the active session\",\n    onErrorDispatch: (e) => apiError(e.toString()),\n    dispatcher:\n        (payload: Session | null, options: { skipInit?: boolean } = {}) =>\n        async (dispatch, getState) => {\n            const { skipInit } = options;\n            const state = getState();\n            const currentActiveSession = activeSessionSelector(state);\n            if (currentActiveSession === payload) {\n                return;\n            }\n            // passing in null will unset the active session\n            if (payload == null) {\n                dispatch(setActiveSessionAction(null));\n                dispatch(clearSessionDependentData());\n                return;\n            }\n            if ((currentActiveSession || { id: null }).id === payload.id) {\n                return;\n            }\n            // If we made it here, the activeSession is changing.\n            dispatch(setActiveSessionAction(payload));\n            // Make sure all tasks we depend on get run\n            if (!skipInit) {\n                await dispatch(\n                    initFromStage(\"setActiveSession\", { startAfterStage: true })\n                );\n            }\n        },\n});\n\n// selectors\nconst localStoreSelector = sessionsReducer._localStoreSelector;\nexport const sessionsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData as Session[]\n);\nexport const activeSessionSelector = createSelector(\n    localStoreSelector,\n    (state) => state.activeSession as Session | null\n);\n","/**\n * A collection of utility functions to help with the mock API\n */\n\n/**\n * Given a date range, returns an array of one or two ranges depending\n * on whether the date range includes a new-years.\n *\n * @export\n * @param {(string|Date)} start_date\n * @param {(string|Date)} end_date\n * @returns {{start_date: string, end_date:string}[]}\n */\nexport function splitDateRangeAtNewYear(start_date, end_date) {\n    start_date = new Date(start_date);\n    end_date = new Date(end_date);\n    // For `Date`, 11 is december\n    const december = new Date(start_date.getFullYear(), 11, 31);\n    // For `Date`, 12 will be the first month of the subsequent year\n    const january = new Date(start_date.getFullYear(), 12, 1);\n    if (start_date <= december && end_date > december) {\n        return [\n            {\n                start_date: start_date.toISOString(),\n                end_date: december.toISOString(),\n            },\n            {\n                start_date: january.toISOString(),\n                end_date: end_date.toISOString(),\n            },\n        ];\n    }\n    return [\n        {\n            start_date: start_date.toISOString(),\n            end_date: end_date.toISOString(),\n        },\n    ];\n}\n\n/**\n * Generates an unused Id based on the `prop` attribute.\n *\n * @export\n * @param {object[]} data - array of data with `prop` attributes\n * @param {string} [prop=\"id\"] - attribute to key on\n * @returns {number|string}\n */\nexport function getUnusedId(data, prop = \"id\") {\n    const ids = data.map((x) => +x[prop]).filter((x) => x != null);\n    const max = Math.max(0, ...ids);\n    if (isNaN(max)) {\n        // Somehow there was some other type mixed in with the ids. In this case,\n        // generate a random string\n        return \"id-\" + Math.round(Math.random() * 10000);\n    }\n    return max + 1;\n}\n\n/**\n * Find `obj` in `data` based on a matching attribute of `prop`.\n * Returns matching object or `undefined` if no match was found.\n *\n * @export\n * @param {*} obj\n * @param {*} [data=[]]\n * @param {string} [prop=\"id\"]\n * @returns {undefined|object}\n */\nexport function find(obj, data = [], prop = \"id\") {\n    // We really do want to use `==` and not `===` here.\n    // Sometimes ids are given as ints and sometimes as strings;\n    // we should work interchangibly with both.\n    // eslint-disable-next-line\n    return data.find((s) => s[prop] == obj[prop]);\n}\n\n/**\n * Filter `data` to be a list which only includes items\n * with ids listed in `ids`.\n *\n * @export\n * @param {string[]} [ids=[]]\n * @param {object[]} [data=[]]\n * @param {string} [prop=\"id\"]\n * @returns {object[]}\n */\nexport function findAllById(ids = [], data = [], prop = \"id\") {\n    // ids can be numbers or strings; make sure we get a match in either case.\n    ids = ids.map((x) => \"\" + x);\n    return data.filter((x) => ids.includes(\"\" + x[prop]));\n}\n\n/**\n * Delete the first occurance of `obj` in `data`\n *\n * @export\n * @param {*} obj\n * @param {*} [data=[]]\n */\nexport function deleteInArray(obj, data = []) {\n    data.splice(data.indexOf(obj), 1);\n}\n\n/**\n * Verify whether attributes are nonempty/unique. If they fail these\n * checks, return an appropriate error message. If they pass, return `false`.\n *\n * @export\n * @param {object} obj\n * @param {object[]} [data=[]]\n * @param {boolean} [props={ name: { required: true, unique: true } }]\n * @returns {string|false} - `false` if all checks succeed. Otherwise an appropriate error message.\n */\nexport function getAttributesCheckMessage(\n    obj,\n    data = [],\n    props = { id: { required: true, unique: true } }\n) {\n    for (const [prop, requirements] of Object.entries(props)) {\n        // Required attributes cannot be null or the empty string\n        // Note: `== null` check null and undefined\n        if (requirements.required && (obj[prop] == null || obj[prop] === \"\")) {\n            return `Property ${prop} cannot be empty`;\n        }\n        // Search the data for something with a matching prop. If we find\n        // anything, we are not unique\n        if (requirements.unique && find(obj, data, prop)) {\n            return `Duplicate entry exists for property ${prop} with value ${obj[prop]}`;\n        }\n    }\n    return false;\n}\n\n/**\n * Base class for mockAPI controllers. These handle\n * the mockAPI data and queries thereof.\n *\n * @export\n * @class MockAPIController\n */\nexport class MockAPIController {\n    constructor(data, ownData) {\n        this.data = data;\n        this.ownData = ownData;\n    }\n    /**\n     * Finds all instances of the given item; returns an array copy.\n     *\n     * @returns {object[]}\n     * @memberof MockAPIController\n     */\n    // eslint-disable-next-line\n    findAll(...args) {\n        return [...this.ownData];\n    }\n    /**\n     * Finds a single instance of an item\n     *\n     * @param {({id: number}|number)} query\n     * @returns {object}\n     * @memberof MockAPIController\n     */\n    find(query) {\n        return this.rawFind(query);\n    }\n    /**\n     * Not to be overridden. The return value of this object\n     * must be an unmangled version of the actual data stored (so that it can be\n     * mutated, for example.)\n     *\n     * @param {*} query\n     * @returns\n     * @memberof MockAPIController\n     */\n    rawFind(query) {\n        if (query == null) {\n            return null;\n        }\n        if (query.id != null) {\n            return find(query, this.ownData);\n        }\n        if (query.utorid != null) {\n            return find({ utorid: query }, this.ownData);\n        }\n        return find({ id: query }, this.ownData);\n    }\n    /**\n     * Delete the given object (by id).\n     *\n     * @param {{id: number}} obj\n     * @memberof MockAPIController\n     */\n    delete(obj) {\n        obj = this.rawFind(obj);\n        if (!obj) {\n            throw new Error(`Cannot delete object ${JSON.stringify(obj)}`);\n        }\n        deleteInArray(obj, this.ownData);\n        return obj;\n    }\n    /**\n     * Get an unused ID\n     *\n     * @returns {number}\n     * @memberof MockAPIController\n     */\n    unusedId() {\n        if (!this.ownData) {\n            throw new Error(\n                \"Cannot get unused ID when `ownData` hasn't been set\"\n            );\n        }\n        return getUnusedId(this.ownData);\n    }\n    /**\n     * Creates a new item instance; no validation is performed.\n     *\n     * @param {object} obj - the new instance data\n     * @memberof MockAPIController\n     */\n    create(obj) {\n        const newId = getUnusedId(this.ownData);\n        const newItem = { ...obj, id: newId };\n        this.ownData.push(newItem);\n        return newItem;\n    }\n    /**\n     * Validates the properties of a new item instance. Throws an error\n     * if the properties are invalid/incompatable.\n     *\n     * @param {object} obj\n     * @memberof MockAPIController\n     */\n    // eslint-disable-next-line\n    validateNew(obj) {\n        throw new Error(\"Subclasses must implement `validateNew()`\");\n    }\n\n    /**\n     * Validates a property of an item instance. Throws an error\n     * if this property are invalid/incompatable.\n     *\n     * @param {object} obj\n     * @param {string} prop\n     * @memberof MockAPIController\n     */\n    // eslint-disable-next-line no-unused-vars\n    validateProp(prop, value, id) {\n        return true;\n    }\n    /**\n     * Update an item if it can be found. Otherwise, return null.\n     *\n     * @param {*} obj\n     * @returns {(object|null)}\n     * @memberof MockAPIController\n     */\n    updateIfFound(obj) {\n        const item = this.rawFind(obj);\n        if (!item) {\n            return null;\n        }\n        // We've found a matching item. Update all non-null\n        // properties\n        for (const prop in obj) {\n            if (prop != null) {\n                this.validateProp(prop, obj[prop], obj.id);\n                item[prop] = obj[prop];\n            }\n        }\n        return item;\n    }\n    /**\n     * Upsert an item. `validateNew` will be run on the item before it is created.\n     * Null/undefined parameters will not be updated.\n     *\n     * @param {object} obj\n     * @returns {object}\n     * @memberof MockAPIController\n     */\n    upsert(obj) {\n        if (this.rawFind(obj)) {\n            return this.updateIfFound(obj);\n        }\n        this.validateNew(obj);\n        return this.create(obj);\n    }\n}\n\n/**\n * Extract the earliest start date and latest end date from\n * an array of wage chunks.\n *\n * @export\n * @param {[object]} wageChunks\n * @returns {{start_date: date, end_date: date}}\n */\nexport function wageChunkArrayToStartAndEndDates(wageChunks) {\n    const startDates = wageChunks.map((x) => x.start_date);\n    const endDates = wageChunks.map((x) => x.end_date);\n    startDates.sort();\n    endDates.sort();\n    return {\n        start_date: startDates[0],\n        end_date: endDates[endDates.length - 1],\n    };\n}\n\n/**\n * Join an array of strings with the conjunction \"and\", if suitable.\n *\n * @param {[string]} items\n * @returns {string}\n */\nfunction joinWithConjunction(items) {\n    if (items == null || items.length === 0) {\n        return \"\";\n    }\n    if (items.length === 1) {\n        return items[0];\n    }\n    if (items.length === 2) {\n        return `${items[0]} and ${items[1]}`;\n    }\n    items = [...items];\n    items[items.length - 1] = \"and \" + items[items.length - 1];\n    return items.join(\", \");\n}\n\n/**\n * Format a list of instructors to appear in a contract.\n *\n * @export\n * @param {[object]} instructors\n * @returns {string}\n */\nexport function formatInstructorsContact(instructors) {\n    if (!instructors) {\n        return [];\n    }\n    const contacts = instructors.map(\n        (x) => `${x.first_name} ${x.last_name} <${x.email}>`\n    );\n    return joinWithConjunction(contacts);\n}\n\n/**\n * Take an array of wage chunks and create a formatted string describing every separate\n * pay period. If there are multiple wage chunks with the same rate, their hours are combined\n * and the pay window is made large enough to contain those chunks.\n *\n * @export\n * @param {[object]} wageChunks\n * @returns {string}\n */\nexport function wageChunkArrayToPayPeriodDescription(wageChunks) {\n    // Every different pay rate needs to be explained separately\n    // So first make a hash based on pay rates\n    const rateData = {};\n    for (const wageChunk of wageChunks) {\n        let { rate, start_date, end_date, hours } = wageChunk;\n        start_date = new Date(start_date);\n        end_date = new Date(end_date);\n        rateData[rate] = rateData[rate] || { hours: 0, rate };\n        const data = rateData[rate];\n        data.hours += hours;\n        data.start_date = data.start_date || start_date;\n        data.start_date = Math.min(data.start_date, start_date);\n        data.end_date = data.end_date || end_date;\n        data.end_date = Math.max(data.end_date, end_date);\n    }\n    const descriptions = Object.values(rateData).map(\n        ({ hours, rate, start_date, end_date }) => {\n            start_date = new Date(start_date);\n            end_date = new Date(end_date);\n\n            return `${hours} hours at $${rate}/hour from ${start_date.toLocaleDateString(\n                \"EN-ca\",\n                { month: \"long\", day: \"numeric\", year: \"numeric\" }\n            )} to ${end_date.toLocaleDateString(\"EN-ca\", {\n                month: \"long\",\n                day: \"numeric\",\n                year: \"numeric\",\n            })}`;\n        }\n    );\n\n    return joinWithConjunction(descriptions);\n}\n\n/**\n * Return a copy of `obj` but filter out any properties whose value\n * is `null` or `undefined`.\n *\n * @export\n * @param {*} obj\n * @returns\n */\nexport function filterNullProps(obj) {\n    const ret = {};\n    for (const key in obj) {\n        if (obj[key] != null) {\n            ret[key] = obj[key];\n        }\n    }\n    return ret;\n}\n\nexport function errorUnlessRole({ role }, targetRule = \"admin\") {\n    if (role !== targetRule) {\n        throw new Error(`Invalid route for user with role '${role}'`);\n    }\n}\n\n/**\n * Recursively traverse the object `obj` and delete any property with key `prop`.\n *\n * @export\n * @param {*} obj\n * @param {string} [prop=\"id\"]\n * @returns\n */\nexport function recursiveDeleteProp(obj, prop = \"id\") {\n    if (typeof obj != \"object\" || obj == null) {\n        return;\n    }\n    if (Array.isArray(obj)) {\n        for (const elm of obj) {\n            recursiveDeleteProp(elm, prop);\n        }\n        return;\n    }\n    delete obj[prop];\n    for (const elm of Object.values(obj)) {\n        recursiveDeleteProp(elm, prop);\n    }\n}\n\n//\n// Base64 Encoding functions from\n// https://gist.github.com/enepomnyaschih/72c423f727d395eeaa09697058238727\n//\n\n/*\nMIT License\nCopyright (c) 2020 Egor Nepomnyaschih\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n/*\n// This constant can also be computed with the following algorithm:\nconst base64abc = [],\n\tA = \"A\".charCodeAt(0),\n\ta = \"a\".charCodeAt(0),\n\tn = \"0\".charCodeAt(0);\nfor (let i = 0; i < 26; ++i) {\n\tbase64abc.push(String.fromCharCode(A + i));\n}\nfor (let i = 0; i < 26; ++i) {\n\tbase64abc.push(String.fromCharCode(a + i));\n}\nfor (let i = 0; i < 10; ++i) {\n\tbase64abc.push(String.fromCharCode(n + i));\n}\nbase64abc.push(\"+\");\nbase64abc.push(\"/\");\n*/\nconst base64abc =\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\".split(\n        \"\"\n    );\n\n// This constant can also be computed with the following algorithm:\nconst l = 256,\n    base64codes = new Uint8Array(l);\nfor (let i = 0; i < l; ++i) {\n    base64codes[i] = 255; // invalid character\n}\nbase64abc.forEach((char, index) => {\n    base64codes[char.charCodeAt(0)] = index;\n});\nbase64codes[\"=\".charCodeAt(0)] = 0; // ignored anyway, so we just need to prevent an error\n//const base64codes = [\n//\t255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n//\t255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n//\t255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 62, 255, 255, 255, 63,\n//\t52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 255, 255, 255, 0, 255, 255,\n//\t255, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,\n//\t15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 255, 255, 255, 255, 255,\n//\t255, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,\n//\t41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51\n//];\n\nfunction getBase64Code(charCode) {\n    if (charCode >= base64codes.length) {\n        throw new Error(\"Unable to parse base64 string.\");\n    }\n    const code = base64codes[charCode];\n    if (code === 255) {\n        throw new Error(\"Unable to parse base64 string.\");\n    }\n    return code;\n}\n\nexport function bytesToBase64(bytes) {\n    let result = \"\",\n        i,\n        l = bytes.length;\n    for (i = 2; i < l; i += 3) {\n        result += base64abc[bytes[i - 2] >> 2];\n        result += base64abc[((bytes[i - 2] & 0x03) << 4) | (bytes[i - 1] >> 4)];\n        result += base64abc[((bytes[i - 1] & 0x0f) << 2) | (bytes[i] >> 6)];\n        result += base64abc[bytes[i] & 0x3f];\n    }\n    if (i === l + 1) {\n        // 1 octet yet to write\n        result += base64abc[bytes[i - 2] >> 2];\n        result += base64abc[(bytes[i - 2] & 0x03) << 4];\n        result += \"==\";\n    }\n    if (i === l) {\n        // 2 octets yet to write\n        result += base64abc[bytes[i - 2] >> 2];\n        result += base64abc[((bytes[i - 2] & 0x03) << 4) | (bytes[i - 1] >> 4)];\n        result += base64abc[(bytes[i - 1] & 0x0f) << 2];\n        result += \"=\";\n    }\n    return result;\n}\n\nexport function base64ToBytes(str) {\n    if (str.length % 4 !== 0) {\n        throw new Error(\"Unable to parse base64 string.\");\n    }\n    const index = str.indexOf(\"=\");\n    if (index !== -1 && index < str.length - 2) {\n        throw new Error(\"Unable to parse base64 string.\");\n    }\n    let missingOctets = str.endsWith(\"==\") ? 2 : str.endsWith(\"=\") ? 1 : 0,\n        n = str.length,\n        result = new Uint8Array(3 * (n / 4)),\n        buffer;\n    for (let i = 0, j = 0; i < n; i += 4, j += 3) {\n        buffer =\n            (getBase64Code(str.charCodeAt(i)) << 18) |\n            (getBase64Code(str.charCodeAt(i + 1)) << 12) |\n            (getBase64Code(str.charCodeAt(i + 2)) << 6) |\n            getBase64Code(str.charCodeAt(i + 3));\n        result[j] = buffer >> 16;\n        result[j + 1] = (buffer >> 8) & 0xff;\n        result[j + 2] = buffer & 0xff;\n    }\n    return result.subarray(0, result.length - missingOctets);\n}\n\nexport function base64encode(str, encoder = new TextEncoder()) {\n    return bytesToBase64(encoder.encode(str));\n}\n\nexport function base64decode(str, decoder = new TextDecoder()) {\n    return decoder.decode(base64ToBytes(str));\n}\n","import XLSX from \"xlsx\";\n\nexport type ExportFormat = \"csv\" | \"json\" | \"spreadsheet\";\nexport type ExportFormatters = {\n    toJson: () => any;\n    toSpreadsheet: () => (string | number | null | undefined)[][];\n};\n\n/**\n *  Create a `File` object containing of the specified format.\n *\n * @param formatters - Formatters return an array of objects (usable as spreadsheet rows) or a javascript object to be passed to JSON.stringify\n * @param dataFormat\n * @param filePrefix\n * @returns\n */\nexport function dataToFile(\n    formatters: ExportFormatters,\n    dataFormat: ExportFormat,\n    filePrefix = \"\"\n) {\n    const fileName = `${filePrefix}${\n        filePrefix ? \"_\" : \"\"\n    }export_${new Date().toLocaleDateString(\"en-CA\", {\n        year: \"numeric\",\n        month: \"numeric\",\n        day: \"numeric\",\n    })}`;\n\n    if (dataFormat === \"spreadsheet\" || dataFormat === \"csv\") {\n        const workbook = XLSX.utils.book_new();\n        const sheet = XLSX.utils.aoa_to_sheet(formatters.toSpreadsheet());\n        XLSX.utils.book_append_sheet(workbook, sheet, \"Instructors\");\n\n        const bookType = dataFormat === \"csv\" ? \"csv\" : \"xlsx\";\n\n        // We convert the data into a blob and return it so that it can be downloaded\n        // by the user's browser\n        const file = new File(\n            [XLSX.write(workbook, { type: \"array\", bookType })],\n            `${fileName}.${bookType}`,\n            {\n                type: \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n            }\n        );\n        return file;\n    }\n\n    if (dataFormat === \"json\") {\n        const file = new File(\n            [JSON.stringify(formatters.toJson(), null, 4)],\n            `${fileName}.json`,\n            {\n                type: \"application/json\",\n            }\n        );\n        return file;\n    }\n\n    throw new Error(\n        `Cannot process data to format \"${dataFormat}\"; try \"spreadsheet\" or \"json\".`\n    );\n}\n","// for json containing object data, we do not need another helper function\n// to convert undefined to null since in dataToFile function in \"./data-to-file\"\n// we use JSON.stringify() which will do the conversion\n\n/**\n * Util functions to turn undefined to null for spreadsheets\n *\n * @exports\n * @param {(number | string | null | undefined) [][] item\n * @returns{(number | string | null) [][]}\n */\nexport function spreadsheetUndefinedToNull(\n    items: (number | string | null | undefined)[][]\n) {\n    return items.map((item) => item.map((val) => val ?? null));\n}\n","/*\n * A collection of utility functions for use when exporting data.\n */\n\nimport {\n    WageChunk,\n    Session,\n    Position,\n    Instructor,\n    Assignment,\n    ContractTemplate,\n    Applicant,\n    MinimalWageChunk,\n    MinimalSession,\n    MinimalPosition,\n    MinimalInstructor,\n    MinimalAssignment,\n    MinimalContractTemplate,\n    MinimalApplicant,\n    MinimalDdah,\n    Ddah,\n    MinimalApplication,\n    Application,\n    PostingPosition,\n    MinimalPostingPosition,\n    MinimalPosting,\n    Posting,\n} from \"../../api/defs/types\";\n\n/**\n * Determine whether `wageChunks` can be derived from `session`. E.g.,\n * the rates match the session rates.\n *\n * @param {*} wageChunks\n * @param {*} position\n * @param {*} session\n * @param {Number} assignmentHours\n * @returns {boolean}\n */\nfunction wageChunksMatchPositionAndSession(\n    wageChunks: WageChunk[],\n    position: Position,\n    session: Session,\n    assignmentHours: Number\n): boolean {\n    if (!session || !Array.isArray(wageChunks)) {\n        return true;\n    }\n    // A single wage chunk matching the session rate is derivable\n    if (wageChunks.length === 1) {\n        const chunk: WageChunk = wageChunks[0];\n        if (\n            chunk.start_date === position.start_date &&\n            chunk.end_date === position.end_date &&\n            (chunk.rate === session.rate1 || chunk.rate === session.rate2) &&\n            chunk.hours === assignmentHours\n        ) {\n            return true;\n        }\n    }\n    // Two wage chunks split at January matching the session rates are derivable\n    if (wageChunks.length === 2) {\n        let [chunk1, chunk2] = wageChunks;\n        // If for some reason the wage chunks don't have dates, they aren't derivable.\n        if (\n            !chunk1.end_date ||\n            !chunk1.end_date ||\n            !chunk2.start_date ||\n            !chunk2.end_date\n        ) {\n            return false;\n        }\n        // Make sure the wage chunks are ordered by date\n        if (chunk1.end_date > chunk2.start_date) {\n            const tmp = chunk1;\n            chunk1 = chunk2;\n            chunk2 = tmp;\n        }\n\n        // If the wage chunk dates don't match the position's dates,\n        // we're not derivable.\n        if (\n            chunk1.start_date !== position.start_date ||\n            chunk2.end_date !== position.end_date\n        ) {\n            return false;\n        }\n\n        // If the sum of hours of wage chunks doesn't match the hours of assignment\n        // we're not derivable.\n        if (chunk1.hours + chunk2.hours !== assignmentHours) {\n            return false;\n        }\n\n        // If the wage chunks are split exactly at a year boundary and the rates\n        // match the session rates, then we *are* derivable.\n        if (\n            (chunk1.end_date || \"\").slice(5, 10) === \"12-31\" &&\n            (chunk2.start_date || \"\").slice(5, 10) === \"01-01\" &&\n            chunk1.rate === session.rate1 &&\n            chunk2.rate === session.rate2\n        ) {\n            return true;\n        }\n    }\n    return false;\n}\n\n/**\n * Prepare a minimal representation of the specified object suitable for\n * export. The returned object will contain exactly the fields needed to\n * perfectly reconstruct the object on import an no others. E.g., instructors\n * referenced by a position will only be referenced by UTORid (and won't have information\n * about their names, etc.).\n *\n * These function also strips all `id` fields, since these are database specific and\n * not used when importing.\n */\nexport const prepareMinimal = {\n    session: function (session: Session): MinimalSession {\n        return {\n            name: session.name,\n            start_date: session.start_date,\n            end_date: session.end_date,\n            rate1: session.rate1,\n            rate2: session.rate2,\n        };\n    },\n    contractTemplate: function (\n        contractTemplate: ContractTemplate\n    ): MinimalContractTemplate {\n        return {\n            template_name: contractTemplate.template_name,\n            template_file: contractTemplate.template_file,\n        };\n    },\n    instructor: function (instructor: Instructor): MinimalInstructor {\n        return {\n            first_name: instructor.first_name,\n            last_name: instructor.last_name,\n            utorid: instructor.utorid,\n            email: instructor.email,\n        };\n    },\n    position: function (position: Position): MinimalPosition {\n        return {\n            position_code: position.position_code,\n            position_title: position.position_title,\n            hours_per_assignment: position.hours_per_assignment,\n            start_date: position.start_date,\n            end_date: position.end_date,\n            duties: position.duties,\n            qualifications: position.qualifications,\n            desired_num_assignments: position.desired_num_assignments,\n            current_enrollment: position.current_enrollment,\n            current_waitlisted: position.current_waitlisted,\n            instructors: position.instructors.map(\n                (instructor) => instructor.utorid\n            ),\n            contract_template: position.contract_template.template_name,\n        };\n    },\n    posting: function (posting: Posting): MinimalPosting {\n        return {\n            name: posting.name,\n            open_date: posting.open_date,\n            close_date: posting.close_date,\n            intro_text: posting.intro_text,\n            custom_questions: posting.custom_questions,\n            posting_positions: posting.posting_positions.map(\n                prepareMinimal.postingPosition\n            ),\n        };\n    },\n    postingPosition: function (\n        postingPosition: PostingPosition\n    ): MinimalPostingPosition {\n        return {\n            position_code: postingPosition.position.position_code,\n            num_positions: postingPosition.num_positions,\n            hours: postingPosition.hours,\n        };\n    },\n    wageChunk: function (wageChunk: WageChunk): MinimalWageChunk {\n        return {\n            start_date: wageChunk.start_date,\n            end_date: wageChunk.end_date,\n            rate: wageChunk.rate,\n            hours: wageChunk.hours,\n        };\n    },\n    assignment: function (\n        assignment: Assignment,\n        session: Session\n    ): MinimalAssignment {\n        const ret: MinimalAssignment = {\n            utorid: assignment.applicant.utorid,\n            position_code: assignment.position.position_code,\n        } as MinimalAssignment;\n        // If there is an contract_override_pdf, we store it, otherwise\n        // the contract comes from the `position` so we don't need to store it.\n        if (assignment.contract_override_pdf) {\n            ret.contract_override_pdf = assignment.contract_override_pdf;\n        }\n\n        // If the start and end dates match the position, there is no need to\n        // store them.\n        const position = assignment.position;\n        if (\n            (assignment.start_date &&\n                assignment.start_date !== position.start_date) ||\n            (assignment.end_date && assignment.end_date !== position.end_date)\n        ) {\n            ret.start_date = assignment.start_date || position.start_date;\n            ret.end_date = assignment.end_date || position.end_date;\n        }\n        // If there is a single wage chunk and the rate matches the session rate,\n        // then just store the number of hours. Otherwise, store the wage chunk(s)\n        if (\n            !Array.isArray(assignment.wage_chunks) ||\n            assignment.wage_chunks.length === 0\n        ) {\n            ret.hours = assignment.hours;\n        } else if (\n            session &&\n            wageChunksMatchPositionAndSession(\n                assignment.wage_chunks,\n                position,\n                session,\n                assignment.hours\n            )\n        ) {\n            // The rate is the same as the session rate, so we don't need to store the\n            // wage chunk details\n            ret.hours = assignment.hours;\n        } else {\n            ret.wage_chunks = assignment.wage_chunks.map((chunk) =>\n                prepareMinimal.wageChunk(chunk)\n            );\n        }\n\n        return ret;\n    },\n    applicant: function (applicant: Applicant): MinimalApplicant {\n        return {\n            first_name: applicant.first_name,\n            last_name: applicant.last_name,\n            utorid: applicant.utorid,\n            email: applicant.email,\n            student_number: applicant.student_number,\n            phone: applicant.phone,\n        };\n    },\n    application: function (application: Application): MinimalApplication {\n        return Object.assign(prepareMinimal.applicant(application.applicant), {\n            annotation: application.annotation,\n            comments: application.comments,\n            department: application.department,\n            gpa: application.gpa,\n            program: application.program,\n            yip: application.yip,\n            previous_experience_summary:\n                application.previous_experience_summary,\n            previous_department_ta: application.previous_department_ta,\n            previous_university_ta: application.previous_university_ta,\n            documents: application.documents,\n            custom_question_answers: application.custom_question_answers,\n            posting: application.posting?.name || null,\n            position_preferences: application.position_preferences.map(\n                (position_preference) => ({\n                    position_code: position_preference.position.position_code,\n                    preference_level: position_preference.preference_level,\n                })\n            ),\n            instructor_preferences: application.instructor_preferences.map(\n                (pref) => ({\n                    position_code: pref.position.position_code,\n                    preference_level: pref.preference_level,\n                    comment: pref.comment,\n                })\n            ),\n            submission_date: application.submission_date,\n        });\n    },\n    ddah: function (ddah: Ddah): MinimalDdah {\n        const duties = [...ddah.duties];\n        duties.sort((a, b) => a.order - b.order);\n\n        return {\n            position_code: ddah.assignment.position.position_code,\n            applicant: ddah.assignment.applicant.utorid,\n            duties: duties.map((duty) => ({\n                hours: duty.hours,\n                description: duty.description,\n            })),\n        };\n    },\n};\n","import {\n    Applicant,\n    Application,\n    Assignment,\n    Ddah,\n    Instructor,\n    Position,\n    Posting,\n    WageChunk,\n} from \"../../api/defs/types\";\nimport { spreadsheetUndefinedToNull } from \"../import-export/undefinedToNull\";\nimport { prepareMinimal } from \"./prepare-minimal\";\n\n/**\n * Type of a spreadsheet cell\n */\ntype CellType = number | string | null | undefined;\n\n/**\n * Return an array of [hours, duty, hours duty, ...] for the specified `ddah`\n *\n * @param ddah\n * @returns\n */\nfunction flattenDuties(ddah: Ddah) {\n    const ret = [];\n    const duties = [...ddah.duties];\n    duties.sort((a, b) => a.order - b.order);\n\n    for (const duty of duties) {\n        ret.push(duty.hours);\n        ret.push(duty.description);\n    }\n\n    return ret;\n}\n\n/**\n * Format a date as YYYY-MM-DD for inserting into a spreadsheet\n *\n * @param {*} date\n * @returns\n */\nfunction formatDateForSpreadsheet(date: string | number | null | undefined) {\n    try {\n        return date && new Date(date).toJSON().slice(0, 10);\n    } catch (e) {\n        return \"\";\n    }\n}\n\ntype BasicWageChunk = ({ hours: number } & Record<string, any>)[];\ninterface HasWageChunk extends Record<string, any> {\n    wage_chunks: BasicWageChunk | undefined;\n}\n\n/**\n * Create header columns for a spreadsheet containing information about every pay period.\n *\n * @param {*} assignments\n * @returns\n */\nfunction createPayPeriodHeaders(assignments: HasWageChunk[]) {\n    const ret: string[] = [];\n    if (!assignments) {\n        return ret;\n    }\n    const maxNumPeriods = Math.max(\n        ...assignments.map((assignment) => assignment.wage_chunks?.length || 0),\n        0\n    );\n\n    for (let i = 0; i < maxNumPeriods; i++) {\n        ret.push(\n            `Period ${i + 1} Rate`,\n            `Period ${i + 1} Hours`,\n            `Period ${i + 1} Start Date`,\n            `Period ${i + 1} End Date`\n        );\n    }\n    return ret;\n}\n\n/**\n * Create formatted rows providing information about each wage chunk.\n *\n * @param {*} wageChunks\n * @returns\n */\nfunction formatWageChunksToList(\n    wageChunks: Omit<WageChunk, \"id\">[] | null | undefined\n) {\n    const ret: (string | number | undefined | null)[] = [];\n    if (!wageChunks) {\n        return ret;\n    }\n\n    ret.push(wageChunks.length);\n    for (const chunk of wageChunks) {\n        ret.push(\n            chunk.rate,\n            chunk.hours,\n            formatDateForSpreadsheet(chunk.start_date),\n            formatDateForSpreadsheet(chunk.end_date)\n        );\n    }\n    return ret;\n}\n\n/**\n * Functions which turns an array of objects into an Array of Arrays suitable\n * for converting into a spreadsheet.\n */\nexport const prepareSpreadsheet = {\n    instructor: function (instructors: Instructor[]) {\n        return spreadsheetUndefinedToNull(\n            (\n                [[\"Last Name\", \"First Name\", \"UTORid\", \"email\"]] as CellType[][]\n            ).concat(\n                instructors.map((instructor) => [\n                    instructor.last_name,\n                    instructor.first_name,\n                    instructor.utorid,\n                    instructor.email,\n                ])\n            )\n        );\n    },\n    applicant: function (applicants: Applicant[]) {\n        return spreadsheetUndefinedToNull(\n            (\n                [\n                    [\n                        \"Last Name\",\n                        \"First Name\",\n                        \"UTORid\",\n                        \"Student Number\",\n                        \"email\",\n                        \"Phone\",\n                    ],\n                ] as CellType[][]\n            ).concat(\n                applicants.map((applicant) => [\n                    applicant.last_name,\n                    applicant.first_name,\n                    applicant.utorid,\n                    applicant.student_number,\n                    applicant.email,\n                    applicant.phone,\n                ])\n            )\n        );\n    },\n    application: function (applications: Application[]) {\n        const minApps = applications.map(prepareMinimal.application);\n        const baseUrl = document.location.origin;\n        return spreadsheetUndefinedToNull(\n            (\n                [\n                    [\n                        \"Last Name\",\n                        \"First Name\",\n                        \"UTORid\",\n                        \"Student Number\",\n                        \"email\",\n                        \"Phone\",\n                        \"Annotation\",\n                        \"Department\",\n                        \"Program\",\n                        \"YIP\",\n                        \"GPA\",\n                        \"Posting\",\n                        \"Position Preferences\",\n                        \"Previous Experience Summary\",\n                        \"Comments\",\n                        \"Documents\",\n                        \"Instructor Preferences\",\n                        \"Instructor Comments\",\n                        \"Custom Question Answers\",\n                        \"Submission Date\",\n                    ],\n                ] as CellType[][]\n            ).concat(\n                minApps.map((application) => [\n                    application.last_name,\n                    application.first_name,\n                    application.utorid,\n                    application.student_number,\n                    application.email,\n                    application.phone,\n                    application.annotation,\n                    application.department,\n                    application.program,\n                    application.yip,\n                    application.gpa,\n                    application.posting,\n                    application.position_preferences\n                        .map(\n                            (pref) =>\n                                `${pref.position_code}:${pref.preference_level}`\n                        )\n                        .join(\"; \"),\n                    application.previous_experience_summary,\n                    application.comments,\n                    application.documents\n                        .map(\n                            (document) =>\n                                new URL(\n                                    `${baseUrl}/public/files/${document.url_token}`\n                                ).href\n                        )\n                        .join(\" \"),\n                    application.instructor_preferences\n                        .map(\n                            (pref) =>\n                                `${pref.position_code}:${pref.preference_level}`\n                        )\n                        .join(\"; \"),\n                    application.instructor_preferences\n                        .filter((pref) => pref.comment != null)\n                        .map(\n                            (pref) => `${pref.position_code}:\"${pref.comment}\"`\n                        )\n                        .join(\"; \"),\n                    application.custom_question_answers\n                        ? JSON.stringify(application.custom_question_answers)\n                        : null,\n                    application.submission_date,\n                ])\n            )\n        );\n    },\n    position: function (positions: Position[]) {\n        return spreadsheetUndefinedToNull(\n            (\n                [\n                    [\n                        \"Position Code\",\n                        \"Position Title\",\n                        \"Start Date\",\n                        \"End Date\",\n                        \"Hours Per Assignment\",\n                        \"Number of Assignments\",\n                        \"Contract Template\",\n                        \"Instructors\",\n                        \"Duties\",\n                        \"Qualifications\",\n                        \"Current Enrollment\",\n                        \"Current Waitlist\",\n                    ],\n                ] as CellType[][]\n            ).concat(\n                positions.map((position) => [\n                    position.position_code,\n                    position.position_title,\n                    position.start_date &&\n                        new Date(position.start_date).toJSON().slice(0, 10),\n                    position.end_date &&\n                        new Date(position.end_date).toJSON().slice(0, 10),\n                    position.hours_per_assignment,\n                    position.desired_num_assignments,\n                    position.contract_template.template_name,\n                    position.instructors\n                        .map(\n                            (instructor) =>\n                                `${instructor.last_name}, ${instructor.first_name}`\n                        )\n                        .join(\"; \"),\n                    position.duties || \"\",\n                    position.qualifications || \"\",\n                    position.current_enrollment,\n                    position.current_waitlisted,\n                ])\n            )\n        );\n    },\n    posting: function (posting: Posting) {\n        // Most of the information about the posting is exported in the first row of the spreadsheet.\n        // However, the PostingPositions take many rows. In the additional rows we fill cells with\n        // `null` so that they show up empty in the spreadsheet.\n        const firstItems = [\n            posting.name,\n            posting.open_date,\n            posting.close_date,\n        ];\n        const lastItems = [\n            posting.intro_text,\n            JSON.stringify(posting.custom_questions),\n        ];\n        const emptyFirstItems = [null, null, null];\n        const emptyLastItems = [null, null];\n        return spreadsheetUndefinedToNull(\n            (\n                [\n                    [\n                        \"Name\",\n                        \"Open Date\",\n                        \"Close Date\",\n                        \"Position Code\",\n                        \"Num Positions\",\n                        \"Hours per Assignment\",\n                        \"Intro Text\",\n                        \"Custom Questions\",\n                    ],\n                ] as CellType[][]\n            ).concat(\n                Array.from(\n                    { length: Math.max(posting.posting_positions.length, 1) },\n                    (_, i) => {\n                        const first = i === 0 ? firstItems : emptyFirstItems;\n                        const last = i === 0 ? lastItems : emptyLastItems;\n                        const postingPosition = posting.posting_positions[i];\n\n                        return [\n                            ...first,\n                            postingPosition?.position?.position_code,\n                            postingPosition?.num_positions,\n                            postingPosition?.hours,\n                            ...last,\n                        ];\n                    }\n                )\n            )\n        );\n    },\n    ddah: function prepareDdahsSpreadsheet(ddahs: Ddah[]) {\n        // Compute the maximum number of duties, because each duty gets a column.\n        const maxDuties = Math.max(\n            ...ddahs.map((ddah) => ddah.duties.length || 0),\n            0\n        );\n        // Create headers for the duty columns\n        const dutyHeaders = Array.from({ length: maxDuties * 2 }, (_, i) => {\n            if (i % 2 === 0) {\n                return `Hours ${i / 2 + 1}`;\n            }\n            return `Duty ${(i - 1) / 2 + 1}`;\n        });\n\n        return spreadsheetUndefinedToNull(\n            (\n                [\n                    [\n                        \"Position\",\n                        \"Last Name\",\n                        \"First Name\",\n                        \"email\",\n                        \"Assignment Hours\",\n                        \"Offer Status\",\n                        \"\",\n                    ].concat(dutyHeaders),\n                ] as CellType[][]\n            ).concat(\n                ddahs.map((ddah) =>\n                    [\n                        ddah.assignment.position.position_code,\n                        ddah.assignment.applicant.last_name,\n                        ddah.assignment.applicant.first_name,\n                        ddah.assignment.applicant.email,\n                        ddah.assignment.hours,\n                        ddah.assignment.active_offer_status,\n                        \"\",\n                    ].concat(flattenDuties(ddah))\n                )\n            )\n        );\n    },\n    assignment: function (assignments: Assignment[]) {\n        // We want to flatten a lot of the data in `assignments` and only include the information\n        // we need.\n        const assignmentsForSpreadsheet = assignments.map((assignment) => ({\n            first_name: assignment.applicant.first_name,\n            last_name: assignment.applicant.last_name,\n            utorid: assignment.applicant.utorid,\n            email: assignment.applicant.email,\n            position_code: assignment.position.position_code,\n            start_date: assignment.start_date,\n            end_date: assignment.end_date,\n            contract_template: assignment.contract_override_pdf\n                ? null\n                : assignment.position.contract_template.template_name,\n            contract_override_pdf: assignment.contract_override_pdf,\n            hours: assignment.hours,\n            active_offer_status: assignment.active_offer_status,\n            active_offer_recent_activity_date:\n                assignment.active_offer_recent_activity_date,\n            wage_chunks: assignment.wage_chunks?.map((chunk) => ({\n                hours: chunk.hours,\n                rate: chunk.rate,\n                start_date: chunk.start_date,\n                end_date: chunk.end_date,\n            })),\n        }));\n        return spreadsheetUndefinedToNull(\n            (\n                [\n                    [\n                        \"Last Name\",\n                        \"First Name\",\n                        \"UTORid\",\n                        \"Email\",\n                        \"Position Code\",\n                        \"Start Date\",\n                        \"End Date\",\n                        \"Hours\",\n                        \"Contract Template\",\n                        \"Contract Override PDF\",\n                        \"Offer Status\",\n                        \"Recent Activity Date\",\n                        \"\",\n                        \"Number of Pay Periods\",\n                        ...createPayPeriodHeaders(assignmentsForSpreadsheet),\n                    ],\n                ] as CellType[][]\n            ).concat(\n                assignmentsForSpreadsheet.map((assignment) => [\n                    assignment.last_name,\n                    assignment.first_name,\n                    assignment.utorid,\n                    assignment.email,\n                    assignment.position_code,\n                    formatDateForSpreadsheet(assignment.start_date),\n                    formatDateForSpreadsheet(assignment.end_date),\n                    assignment.hours,\n                    assignment.contract_template,\n                    assignment.contract_override_pdf,\n                    assignment.active_offer_status,\n                    assignment.active_offer_recent_activity_date,\n                    null,\n                    ...formatWageChunksToList(assignment.wage_chunks),\n                ])\n            )\n        );\n    },\n};\n","import { dataToFile } from \"./data-to-file\";\nimport { prepareSpreadsheet } from \"./prepare-spreadsheet\";\nimport { prepareMinimal } from \"./prepare-minimal\";\nimport type {\n    Applicant,\n    Application,\n    Assignment,\n    Ddah,\n    Instructor,\n    Position,\n    Posting,\n    Session,\n} from \"../../api/defs/types\";\nimport type { ExportFormat } from \"./data-to-file\";\n\nexport type PrepareDataFunc<T> = (data: T[], dataFormat: ExportFormat) => File;\ntype FilterFunc<T> = ((array: T[]) => T[]) | null;\n\n/**\n * Make a function that converts a list of applications into a `File` object.\n *\n * @export\n * @param {Applicant[]} applications\n * @param {\"csv\" | \"json\" | \"xlsx\"} dataFormat\n * @returns\n */\nexport function prepareApplicationData(\n    applications: Application[],\n    dataFormat: ExportFormat\n) {\n    return dataToFile(\n        {\n            toSpreadsheet: () => prepareSpreadsheet.application(applications),\n            toJson: () => ({\n                applications: applications.map((application) =>\n                    prepareMinimal.application(application)\n                ),\n            }),\n        },\n        dataFormat,\n        \"applications\"\n    );\n}\n\n/**\n * Make a function that converts a posting into a `File` object.\n *\n * @export\n * @param {Posting} posting\n * @param {\"csv\" | \"json\" | \"xlsx\"} dataFormat\n * @returns\n */\nexport function preparePostingData(posting: Posting, dataFormat: ExportFormat) {\n    return dataToFile(\n        {\n            toSpreadsheet: () => prepareSpreadsheet.posting(posting),\n            toJson: () => ({\n                postings: [prepareMinimal.posting(posting)],\n            }),\n        },\n        dataFormat,\n        \"postings\"\n    );\n}\n\n/**\n * Make a function that converts a list of applicants into a `File` object.\n *\n * @export\n * @param {Applicant[]} applicants\n * @param {\"csv\" | \"json\" | \"xlsx\"} dataFormat\n * @returns\n */\nexport function prepareApplicantData(\n    applicants: Applicant[],\n    dataFormat: ExportFormat\n) {\n    return dataToFile(\n        {\n            toSpreadsheet: () => prepareSpreadsheet.applicant(applicants),\n            toJson: () => ({\n                applicants: applicants.map((applicant) =>\n                    prepareMinimal.applicant(applicant)\n                ),\n            }),\n        },\n        dataFormat,\n        \"applicants\"\n    );\n}\n\n/**\n * A factory function which produces assignment prepareData function,\n *\n * @export\n * @param session\n * @param assignmentFilter\n * @returns\n */\nexport function prepareAssignmentDataFactory(\n    session: Session,\n    assignmentFilter: FilterFunc<Assignment> = null\n) {\n    // Make a function that converts a list of assignments into a `File` object.\n    return function prepareData(\n        assignments: Assignment[],\n        dataFormat: ExportFormat\n    ) {\n        if (assignmentFilter instanceof Function) {\n            assignments = assignmentFilter(assignments);\n        }\n        return dataToFile(\n            {\n                toSpreadsheet: () => prepareSpreadsheet.assignment(assignments),\n                toJson: () => ({\n                    assignments: assignments.map((assignment) =>\n                        prepareMinimal.assignment(assignment, session)\n                    ),\n                }),\n            },\n            dataFormat,\n            \"assignments\"\n        );\n    };\n}\n\n/**\n * A factory function which produces ddah prepareData function,\n *\n * @export\n * @param ddahFilter\n * @returns\n */\nexport function prepareDdahDataFactory(ddahFilter: FilterFunc<Ddah>) {\n    // Make a function that converts a list of ddahs into a `File` object.\n    return function prepareData(ddahs: Ddah[], dataFormat: ExportFormat) {\n        if (ddahFilter instanceof Function) {\n            ddahs = ddahFilter(ddahs);\n        }\n        return dataToFile(\n            {\n                toSpreadsheet: () => prepareSpreadsheet.ddah(ddahs),\n                toJson: () => ({\n                    ddahs: ddahs.map((ddah) => prepareMinimal.ddah(ddah)),\n                }),\n            },\n            dataFormat,\n            \"ddahs\"\n        );\n    };\n}\n\n/**\n * Make a function that converts a list of instructors into a `File` object.\n *\n * @export\n * @param {Instructor[]} instructors\n * @param {\"csv\" | \"json\" | \"xlsx\"} dataFormat\n * @returns\n */\nexport function prepareInstructorData(\n    instructors: Instructor[],\n    dataFormat: ExportFormat\n) {\n    return dataToFile(\n        {\n            toSpreadsheet: () => prepareSpreadsheet.instructor(instructors),\n            toJson: () => ({\n                instructors: instructors.map((instructor) =>\n                    prepareMinimal.instructor(instructor)\n                ),\n            }),\n        },\n        dataFormat,\n        \"instructors\"\n    );\n}\n\n/**\n * Make a function that converts a list of positions into a `File` object.\n *\n * @export\n * @param {Position[]} positions\n * @param {\"csv\" | \"json\" | \"xlsx\"} dataFormat\n * @returns\n */\nexport function preparePositionData(\n    positions: Position[],\n    dataFormat: ExportFormat\n) {\n    return dataToFile(\n        {\n            toSpreadsheet: () => prepareSpreadsheet.position(positions),\n            toJson: () => ({\n                positions: positions.map((position) =>\n                    prepareMinimal.position(position)\n                ),\n            }),\n        },\n        dataFormat,\n        \"positions\"\n    );\n}\n","import FuzzySet from \"fuzzyset\";\nimport { NormalizationSchema } from \"../schema\";\n\n/**\n * Delete all properties from `keyMap` that have `value` as\n * their value. This function mutates `keyMap`.\n *\n * @param {*} value\n * @param {*} keyMap\n * @returns\n */\nfunction deleteReferences(value: any, keyMap: Record<any, any>) {\n    for (const key in keyMap) {\n        if (keyMap[key] === value) {\n            delete keyMap[key];\n        }\n    }\n    return keyMap;\n}\n\n/**\n * Do fuzzy matching looking for the best approximation of\n * `keyMap[targetKey]`. E.g., if `keyMap = { foo: \"bar\" }`,\n * then `findMatchingKey(\"Foo\", keyMap)` would return `\"bar\"`.\n *\n * If no fuzzy match is found, `null` is returned.\n *\n * @param targetKey\n * @param [keyMap={}]\n * @returns\n */\nfunction findMatchingKey(\n    targetKey: string,\n    keyMap: Record<string, string | number> = {}\n) {\n    if (targetKey in keyMap) {\n        return keyMap[targetKey];\n    }\n    const fuzzySet = FuzzySet(Object.keys(keyMap));\n    // We set a 70% match threshold to prevent mismatches.\n    const matches = (fuzzySet.get as any)(targetKey, null, 0.7);\n    if (matches) {\n        // Since we already checked for 100% matches, `matches` will\n        // always be an array of results of the form [[<%match>, <value matched>]]\n        const matchedKey = matches[0][1];\n        return keyMap[matchedKey];\n    }\n\n    return null;\n}\n\n/**\n * Given a `schema`, use fuzzy matching to match column names to\n * schema values.\n *\n * @class SpreadsheetRowMapper\n */\nexport class SpreadsheetRowMapper<\n    T extends Pick<NormalizationSchema<string[]>, \"keys\" | \"keyMap\">\n> {\n    keys: T[\"keys\"];\n    keyMap: Record<string, string | number>;\n    unmatchedKeys: Record<string, string | number>;\n    empiricalKeyMap: Record<string, string | number>;\n    unknownKeys: Record<string, boolean>;\n\n    constructor(schema: T) {\n        this.keys = schema.keys;\n        this.keyMap = { ...schema.keyMap };\n        // `keys` are always valid, so make sure they are in the keymap.\n        for (const key of this.keys) {\n            this.keyMap[key] = key;\n        }\n        // Maintain a copy of `this.keyMap`. Items are deleted\n        // from this copy when they are matched (and cached). That\n        // way we don't accidentally double-match an item.\n        this.unmatchedKeys = { ...this.keyMap };\n\n        // This stores associations that we've found in\n        // the spreadsheet already.\n        this.empiricalKeyMap = {};\n        this.unknownKeys = {};\n    }\n    /**\n     * Inputs an object, e.g. `{\"First Name\": \"Joe\", \"Last Name\": \"Smith\"}`\n     * and returns a formatted object where the keys have been replaced by\n     * keys from the schema. E.g., this function might return `{first_name: \"Joe\", last_name: \"Smith\"}`.\n     *\n     * The search for appropriate keys is done with a fuzzy matching algorithm, so\n     * the processed spreadsheet headers don't need to exactly match what's given.\n     *\n     * @param row\n     * @param log - whether or not to show lookups using `console.log`\n     * @memberof SpreadsheetRowMapper\n     */\n    formatRow(row: Record<string, any>, log = true) {\n        const ret: Record<string, any> = {};\n        for (const [key, value] of Object.entries(row)) {\n            // If we've found this key before, use the cached version.\n            if (key in this.empiricalKeyMap) {\n                ret[this.empiricalKeyMap[key]] = value;\n                continue;\n            }\n            // If we have cached that we don't know a key, continue\n            if (key in this.unknownKeys) {\n                continue;\n            }\n            const matchedKey = findMatchingKey(key, this.unmatchedKeys);\n            if (matchedKey == null) {\n                if (log) {\n                    console.log(\n                        \"Could not find a key corresponding to spreadsheet column\",\n                        `\"${key}\"`\n                    );\n                }\n                this.unknownKeys[key] = true;\n                continue;\n            }\n            if (log) {\n                console.log(\n                    \"Assuming association between spreadsheet column\",\n                    `\"${key}\"`,\n                    \"and the key\",\n                    `\"${matchedKey}\"`\n                );\n            }\n            this.empiricalKeyMap[key] = matchedKey;\n            deleteReferences(matchedKey, this.unmatchedKeys);\n            ret[matchedKey] = value;\n        }\n\n        return ret;\n    }\n}\n","import FuzzySet from \"fuzzyset\";\n\ninterface Person {\n    utorid: string;\n    first_name: string;\n    last_name: string | null;\n}\n\n/**\n * Find a suitable match in the `people` array for `name`. `name` can\n * be a utorid or a string `\"Last, First\"` or a string `\"First Last\"`.\n * If no suitable match is found, an error is thrown.\n *\n * @export\n * @param {string} name\n * @param {{utorid: string, first_name: string, last_name: string}[]} people\n * @returns\n */\nexport function matchByUtoridOrName<T extends Person>(\n    name: string,\n    people: T[]\n): T {\n    let match = people.find((x) => x.utorid === name);\n    if (match) {\n        // We found an exact match by UTORid\n        return match;\n    }\n\n    const nameHash: Record<string, T> = {};\n    for (const person of people) {\n        // We want to be able to match no matter the order in which the names are specified.\n        nameHash[`${person.last_name}, ${person.first_name}`] = person;\n        nameHash[`${person.first_name} ${person.last_name}`] = person;\n    }\n\n    const fuzzySet = FuzzySet(Object.keys(nameHash));\n    let fuzzyMatch: [number, string][] | string = (fuzzySet.get as any)(\n        name,\n        null,\n        0.7\n    );\n    if (fuzzyMatch) {\n        // If we get an array as a result, it will be of the form [[<%match>, <value matched>]]\n        let matchedKey = Array.isArray(fuzzyMatch)\n            ? fuzzyMatch[0][1]\n            : fuzzyMatch;\n        return nameHash[matchedKey];\n    }\n\n    throw new Error(`Could not find a match for \"${name}\"`);\n}\n","import { NormalizationSchema } from \"../schema\";\n\n/**\n * Validates `data` based on the specified `schema`. At the moment this\n * function only checks that every key specified by `schema.requiredKeys` is\n * non-null.\n *\n * @export\n * @param {*} data\n * @param {*} schema\n */\nexport function validate(data: any[], schema: NormalizationSchema<string[]>) {\n    const { requiredKeys, keys } = schema;\n    for (const item of data) {\n        for (const key of requiredKeys) {\n            if (item[key] == null) {\n                throw new Error(\n                    `Item \"${JSON.stringify(\n                        item\n                    )}\" missing required property \"${key}\"`\n                );\n            }\n        }\n        // convert all undefined values to null inside normalized object\n        for (const key of keys) {\n            if (item[key] === undefined) {\n                item[key] = null;\n            }\n        }\n    }\n}\n","import * as chrono from \"chrono-node\";\nimport { NormalizationSchema } from \"../schema\";\nimport { SpreadsheetRowMapper } from \"./spreadsheet-row-mapper\";\nimport { validate } from \"./validate\";\n\n/**\n * Parse a date string or integer and return a normalized date string.\n *\n * @param str - input date; either a string or an excel date integer\n * @returns date in YYYY-MM-DD:T00:00:00.000 format\n */\nfunction parseDate(str: string | number) {\n    // Dates parsed from excel will come in as a number. Convert those to an appropriate string first.\n    if (typeof str === \"number\") {\n        // Convert to seconds since epoch\n        const sec = Math.round((str - 25569) * 86400 * 1000);\n        // Excel ignores timezone information, so we need to parse this and\n        // remove the timezone tag.\n        str = new Date(sec).toJSON().replace(\"Z\", \"\");\n    }\n    // Parse the date accepting many different formats\n    let date = chrono.parseDate(str);\n    // We need to jump through some hoops to remove all the timezone information.\n    try {\n        return date.toJSON().replace(/T.*/, \"T00:00:00.000Z\");\n    } catch (e) {\n        throw new Error(`Cannot parse \"${str}\" as date`);\n    }\n}\n\nexport type DataFormat =\n    | { fileType: \"json\"; data: any }\n    | { fileType: \"spreadsheet\"; data: any[][] };\n\n/**\n * Use `schema` to normalize `data` to be an array of objects specified\n * by `schema`. `data` is expected to be an object with `fileType`\n * and `data` attributes. `data.fileType` may be `\"json\"` or `\"spreadsheet\"`.\n * `\"json\"` data is expected to already match the schema. `\"spreadsheet\"` data\n * is converted to match the schema using fuzzy matching on column names (if needed).\n *\n * @export\n * @returns\n */\nexport function normalizeImport(\n    dataWrapper: DataFormat,\n    schema: NormalizationSchema<string[]> = {\n        keys: [],\n        requiredKeys: [],\n        dateColumns: [],\n        keyMap: {},\n        primaryKey: \"\",\n        baseName: \"\",\n    },\n    log = true\n) {\n    const { keys, baseName } = schema;\n    let ret = [];\n    if (dataWrapper.fileType === \"json\") {\n        // Unwrap data so that it's just an array\n        let data = dataWrapper.data;\n        if (data[baseName]) {\n            data = data[baseName];\n        }\n        for (const item of data) {\n            const newItem: Record<string, any> = {};\n            for (const key of keys) {\n                newItem[key] = item[key];\n            }\n            ret.push(newItem);\n        }\n    }\n\n    if (dataWrapper.fileType === \"spreadsheet\") {\n        // `data` should be an array of objects indexed by column name.\n        // E.g., [{\"First Name\": \"Joe\", \"Last Name\": \"Smith\"}, ...]\n        let data = dataWrapper.data;\n\n        const rowMapper = new SpreadsheetRowMapper(schema);\n\n        for (const row of data) {\n            ret.push(rowMapper.formatRow(row, log));\n        }\n    }\n\n    if (schema.dateColumns && schema.dateColumns.length > 0) {\n        ret = ret.map((row) => {\n            const newRow = { ...row };\n            for (const col of schema.dateColumns) {\n                if (newRow[col] != null) {\n                    newRow[col] = parseDate(newRow[col]);\n                }\n            }\n            return newRow;\n        });\n    }\n\n    validate(ret, schema);\n\n    return ret;\n}\n","import {\n    WageChunk,\n    Position,\n    Assignment,\n    MinimalWageChunk,\n    MinimalSession,\n    MinimalPosition,\n    MinimalInstructor,\n    MinimalAssignment,\n    MinimalContractTemplate,\n    MinimalApplicant,\n    MinimalDdah,\n    Session,\n    Instructor,\n    ContractTemplate,\n    Applicant,\n    Ddah,\n    MinimalPosting,\n    Posting,\n    PostingPosition,\n} from \"../../api/defs/types\";\nimport { round } from \"../utils\";\n\n/**\n * The function type of a function that creates an upsertable\n * object. I.e., it may or may not have an ID field.\n *\n * @interface PrepareUpsertable\n * @template T - Minimal representation\n * @template U - Full representation\n * @template V - Context attributes that are required to create a full representation\n */\n\ninterface PrepareUpsertable<T, U, Context> {\n    (minimal: T, context: Omit<Context, \"id\">): Omit<U, \"id\">;\n    (minimal: T, context: Context): U;\n}\n\ninterface Context {\n    session: Session;\n    instructors: Instructor[];\n    contractTemplates: ContractTemplate[];\n    positions: Position[];\n    applicants: Applicant[];\n}\n\nexport interface IdContext extends Context {\n    id: number;\n}\n\nexport interface PrepareFull {\n    session: PrepareUpsertable<MinimalSession, Session, { id: number }>;\n    contractTemplate: PrepareUpsertable<\n        MinimalContractTemplate,\n        ContractTemplate,\n        { id: number }\n    >;\n    instructor: PrepareUpsertable<\n        MinimalInstructor,\n        Instructor,\n        { id: number }\n    >;\n    applicant: PrepareUpsertable<MinimalApplicant, Applicant, { id: number }>;\n    position: PrepareUpsertable<\n        MinimalPosition,\n        Position,\n        {\n            id: number;\n            contractTemplates: ContractTemplate[];\n            instructors: Instructor[];\n        }\n    >;\n    wageChunk: PrepareUpsertable<MinimalWageChunk, WageChunk, { id: number }>;\n    assignment: PrepareUpsertable<\n        MinimalAssignment,\n        Assignment,\n        {\n            id: number;\n            session: Session;\n            applicants: Applicant[];\n            positions: Position[];\n        }\n    >;\n    ddah: PrepareUpsertable<\n        MinimalDdah,\n        Ddah,\n        {\n            id: number;\n            assignments: Assignment[];\n        }\n    >;\n    posting: PrepareUpsertable<\n        MinimalPosting,\n        Posting,\n        {\n            id: number;\n            positions: Position[];\n        }\n    >;\n}\n\nexport const prepareFull: PrepareFull = {\n    session: function (minSession: MinimalSession, context?: any): any {\n        const { id } = context || {};\n        if (id != null) {\n            return { id, ...minSession };\n        }\n        return minSession;\n    },\n    contractTemplate: function (\n        minContractTemplate: MinimalContractTemplate,\n        context?: any\n    ): any {\n        const { id } = context || {};\n        if (id != null) {\n            return { id, ...minContractTemplate };\n        }\n        return minContractTemplate;\n    },\n    instructor: function (\n        minInstructor: MinimalInstructor,\n        context?: any\n    ): any {\n        const { id } = context || {};\n        if (id != null) {\n            return { id, ...minInstructor };\n        }\n        return minInstructor;\n    },\n    applicant: function (minApplicant: MinimalApplicant, context?: any): any {\n        const { id } = context || {};\n        if (id != null) {\n            return { id, ...minApplicant };\n        }\n        return minApplicant;\n    },\n    position: function (minPosition: MinimalPosition, context?: any): any {\n        const { id, instructors, contractTemplates }: Partial<IdContext> =\n            context || {};\n        if (!Array.isArray(instructors)) {\n            throw new Error(\n                \"You must pass an array of instructors to reconstruct a position\"\n            );\n        }\n        if (!Array.isArray(contractTemplates)) {\n            throw new Error(\n                \"You must pass an array of contract templates to reconstruct a position\"\n            );\n        }\n\n        const ret: Partial<Position> = {\n            position_code: minPosition.position_code,\n            position_title: minPosition.position_title,\n            hours_per_assignment: minPosition.hours_per_assignment,\n            start_date: minPosition.start_date,\n            end_date: minPosition.end_date,\n            duties: minPosition.duties,\n            qualifications: minPosition.qualifications,\n            desired_num_assignments: minPosition.desired_num_assignments,\n            current_enrollment: minPosition.current_enrollment,\n            current_waitlisted: minPosition.current_waitlisted,\n        };\n\n        // Add in the id if we have it\n        if (id != null) {\n            ret.id = id;\n        }\n\n        // Search for and add the contract template\n        const contract_template = contractTemplates.find(\n            (template) =>\n                template.template_name === minPosition.contract_template\n        );\n        if (contract_template == null) {\n            throw new Error(\n                `Couldn't find contract template with name \"${minPosition.contract_template}\"`\n            );\n        }\n        ret.contract_template = contract_template;\n\n        // Search for an add the list of instructors\n        const instructorList = minPosition.instructors.map((utorid) => {\n            const match = instructors.find((x) => x.utorid === utorid);\n            if (match == null) {\n                throw new Error(\n                    `Could not find instructor with utorid \"${utorid}\"`\n                );\n            }\n            return match;\n        });\n        ret.instructors = instructorList;\n\n        return ret;\n    },\n    wageChunk: function (minWageChunk: MinimalWageChunk, context?: any): any {\n        const { id } = context || {};\n        if (id != null) {\n            return { id, ...minWageChunk };\n        }\n        return minWageChunk;\n    },\n    assignment: function (\n        minAssignment: MinimalAssignment,\n        context?: any\n    ): any {\n        const { id, positions, applicants, session }: Partial<IdContext> =\n            context || {};\n        if (!Array.isArray(positions)) {\n            throw new Error(\n                \"You must pass an array of positions to reconstruct an assignment\"\n            );\n        }\n        if (!Array.isArray(applicants)) {\n            throw new Error(\n                \"You must pass an array of applicants to reconstruct an assignment\"\n            );\n        }\n        if (!session) {\n            throw new Error(\n                \"You must pass a session to reconstruct an assignment\"\n            );\n        }\n\n        const ret: Partial<Assignment> = {\n            contract_override_pdf: minAssignment.contract_override_pdf,\n        };\n\n        // Add in the id if we have it\n        if (id != null) {\n            ret.id = id;\n        }\n\n        if (minAssignment.hours != null) {\n            ret.hours = minAssignment.hours;\n        }\n\n        // Attach the position\n        const position = positions.find(\n            (x) => x.position_code === minAssignment.position_code\n        );\n        if (position == null) {\n            throw new Error(\n                `Cannot find position with position code \"${minAssignment.position_code}\"`\n            );\n        }\n        ret.position = position;\n\n        // Attach the applicant\n        const applicant = applicants.find(\n            (x) => x.utorid === minAssignment.utorid\n        );\n        if (applicant == null) {\n            throw new Error(\n                `Couldn't find applicant with UTORid \"${minAssignment.utorid}\"`\n            );\n        }\n        ret.applicant = applicant;\n\n        // Attach the wage chunks\n        if (Array.isArray(minAssignment.wage_chunks)) {\n            let hours = 0;\n            for (const chunk of minAssignment.wage_chunks) {\n                hours += chunk.hours;\n            }\n            ret.hours = hours;\n            ret.wage_chunks = minAssignment.wage_chunks as WageChunk[];\n        }\n\n        // Compute the start and end dates\n        ret.start_date = minAssignment.start_date || position.start_date;\n        ret.end_date = minAssignment.end_date || position.end_date;\n\n        return ret;\n    },\n    ddah: function (minDdah: MinimalDdah, context?: any): any {\n        const { id, assignments }: { id?: number; assignments?: Assignment[] } =\n            context || {};\n        if (!Array.isArray(assignments)) {\n            throw new Error(\n                \"You must pass an array of assignments to reconstruct a ddah\"\n            );\n        }\n        const matchingAssignment = assignments.find(\n            (assignment) =>\n                assignment.applicant.utorid === minDdah.applicant &&\n                assignment.position.position_code === minDdah.position_code\n        );\n        if (!matchingAssignment) {\n            throw new Error(\n                `Cannot find assignment corresponding to '${minDdah.position_code}' and UTORid '${minDdah.applicant}'`\n            );\n        }\n        const duties = minDdah.duties.map((duty, i) => ({\n            ...duty,\n            order: i + 1,\n        }));\n\n        let total_hours = 0;\n        for (const duty of duties) {\n            total_hours += duty.hours;\n        }\n        total_hours = round(total_hours, 2);\n\n        if (id == null) {\n            return {\n                assignment: matchingAssignment,\n                duties,\n                total_hours,\n                status: null,\n            };\n        }\n        return {\n            id,\n            assignment: matchingAssignment,\n            duties,\n            total_hours,\n            // We cannot import \"signed\" DDAHs, so the `status` is always null\n            status: null,\n        };\n    },\n    posting: function (minPosting: MinimalPosting, context?: any): any {\n        const { id, positions }: { id?: number; positions: Position[] } =\n            context || {};\n        if (!Array.isArray(positions)) {\n            throw new Error(\n                \"You must pass a positions list to create a posting\"\n            );\n        }\n        // We may or may not have an id. We lie to Typescript to keep it from complaining,\n        // since we create a posting without an id first and then update it to have an id\n        // if needed.\n        const ret: Posting = {\n            name: minPosting.name,\n            applications: [],\n            availability: \"auto\",\n            open_date: minPosting.open_date,\n            close_date: minPosting.close_date,\n            custom_questions: minPosting.custom_questions,\n            intro_text: minPosting.intro_text,\n            url_token: \"\",\n            posting_positions: [],\n        } as unknown as Posting;\n        let postingPositions: PostingPosition[] =\n            minPosting.posting_positions.map((minPostingPosition) => {\n                const position = positions.find(\n                    (position) =>\n                        position.position_code ===\n                        minPostingPosition.position_code\n                );\n                if (position == null) {\n                    throw new Error(\n                        `Could not find position corresponding to \"${minPostingPosition.position_code}\"`\n                    );\n                }\n                return {\n                    hours: minPostingPosition.hours,\n                    num_positions: minPostingPosition.num_positions,\n                    position,\n                    posting: ret as Posting,\n                };\n            });\n        if (id != null) {\n            ret.id = id;\n        }\n        ret.posting_positions = postingPositions;\n        return ret;\n    },\n};\n","import { Applicant, MinimalDdah } from \"../../api/defs/types\";\nimport {\n    SpreadsheetRowMapper,\n    matchByUtoridOrName,\n} from \"../../libs/import-export\";\n\n/**\n * Convert imported spreadsheet or JSON data into an\n * array of minimal DDAH objects.\n *\n * @param {({\n *     fileType: \"json\" | \"spreadsheet\";\n *     data: any;\n * })} data\n * @param {Applicant[]} applicants\n * @returns {MinimalDdah[]}\n */\nexport function normalizeDdahImports(\n    data: {\n        fileType: \"json\" | \"spreadsheet\";\n        data: any;\n    },\n    applicants: Applicant[],\n    log = true,\n    positionCodeOverride?: string\n): MinimalDdah[] {\n    let ret: MinimalDdah[] = [];\n\n    if (data.fileType === \"json\") {\n        let unwrapped: MinimalDdah[] = data.data;\n        if ((unwrapped as any).ddahs) {\n            unwrapped = (unwrapped as any).ddahs;\n        }\n        for (const ddah of unwrapped) {\n            ret.push(ddah);\n        }\n    }\n\n    if (data.fileType === \"spreadsheet\") {\n        const unwrapped = data.data;\n        // Get an upper bound for the maximum number of duties that the spreadsheet might have\n        let maxDuties = Math.round(\n            Math.max(\n                ...unwrapped.map((row: object) => Object.keys(row).length),\n                0\n            ) / 2\n        );\n        // If cells are blank, SheetJS does not import them. Therefore,\n        // the max number of cells found will be an under-count. This\n        // caused issue https://github.com/uoft-tapp/tapp/issues/575\n        // As an ugly hack, we just assume there's no more than 50 additional duties.\n        maxDuties += 50;\n\n        // We need to generate a keymap for all the likely column names\n        const keyMap: { [key: string]: string } = {\n            Position: \"position_code\",\n            \"First Name\": \"first_name\",\n            \"Given Name\": \"first_name\",\n            First: \"first_name\",\n            \"Last Name\": \"last_name\",\n            Surname: \"last_name\",\n            \"Family Name\": \"last_name\",\n            Last: \"last_name\",\n        };\n        // We will also add `Hours #` and `Duty #` to the keymap for the number of duties in our range\n        for (let i = 0; i <= maxDuties; i++) {\n            keyMap[`Duty ${i}`] = `duty_${i}`;\n            keyMap[`Hours ${i}`] = `hours_${i}`;\n            if (i < 10) {\n                keyMap[`Duty 0${i}`] = `duty_${i}`;\n                keyMap[`Hours 0${i}`] = `hours_${i}`;\n            }\n        }\n\n        // SpreadsheetRowMapper will perform fuzzy matching of column names for us.\n        const rowMapper = new SpreadsheetRowMapper({\n            keys: [\"position_code\", \"first_name\", \"last_name\", \"utorid\"],\n            keyMap,\n        });\n\n        for (const row of unwrapped) {\n            const normalized: {\n                [key: string]: any;\n            } = rowMapper.formatRow(row, log);\n            if (positionCodeOverride) {\n                normalized.position_code = positionCodeOverride;\n            }\n            if (normalized.utorid == null) {\n                // If a UTORid column was not specified, we need to manually search the applicants for\n                // someone matching the first/last name. `matchByUtoridOrName` will succeed or throw an error,\n                // so if we make it past this line of code, we've successfully found a match.\n                const applicant = matchByUtoridOrName(\n                    `${normalized.first_name} ${normalized.last_name}`,\n                    applicants\n                ) as Applicant;\n                normalized.utorid = applicant.utorid;\n                delete normalized.first_name;\n                delete normalized.last_name;\n            }\n            // Now we need to condense duties to a list\n            // The easiest way is to just hunt for them\n            const duties: { description: string; hours: number }[] = [];\n            for (let i = 0; i <= maxDuties; i++) {\n                const duty = normalized[`duty_${i}`];\n                const hours = normalized[`hours_${i}`];\n                if (duty != null || hours != null) {\n                    duties.push({ description: duty || \"\", hours: hours || 0 });\n                    delete normalized[`duty_${i}`];\n                    delete normalized[`hours_${i}`];\n                }\n            }\n            ret.push({\n                position_code: normalized.position_code,\n                applicant: normalized.utorid,\n                duties,\n            });\n        }\n    }\n\n    return ret;\n}\n","import {\n    FETCH_ASSIGNMENTS_SUCCESS,\n    FETCH_ONE_ASSIGNMENT_SUCCESS,\n    UPSERT_ONE_ASSIGNMENT_SUCCESS,\n    DELETE_ONE_ASSIGNMENT_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    validatedApiDispatcher,\n    arrayToHash,\n    flattenIdFactory,\n    HasId,\n    isSameSession,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { assignmentsReducer } from \"../reducers/assignments\";\nimport { createSelector } from \"reselect\";\nimport { applicantsSelector } from \"./applicants\";\nimport { positionsSelector } from \"./positions\";\nimport { activeRoleSelector } from \"./users\";\nimport {\n    fetchWageChunksForAssignment,\n    wageChunksByAssignmentSelector,\n    upsertWageChunksForAssignment,\n} from \"./wage_chunks\";\nimport type { RawAssignment, Assignment, WageChunk } from \"../defs/types\";\nimport { activeSessionSelector } from \"./sessions\";\nimport { ExportFormat, PrepareDataFunc } from \"../../libs/import-export\";\n\n// actions\nexport const fetchAssignmentsSuccess = actionFactory<RawAssignment[]>(\n    FETCH_ASSIGNMENTS_SUCCESS\n);\nconst fetchOneAssignmentSuccess = actionFactory<RawAssignment>(\n    FETCH_ONE_ASSIGNMENT_SUCCESS\n);\nconst upsertOneAssignmentSuccess = actionFactory<RawAssignment>(\n    UPSERT_ONE_ASSIGNMENT_SUCCESS\n);\nconst deleteOneAssignmentSuccess = actionFactory<RawAssignment>(\n    DELETE_ONE_ASSIGNMENT_SUCCESS\n);\n\nconst MissingActiveSessionError = new Error(\n    \"Cannot interact with Assignments without an active session\"\n);\n\n// dispatchers\nexport const fetchAssignments = validatedApiDispatcher({\n    name: \"fetchAssignments\",\n    description: \"Fetch assignments\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw MissingActiveSessionError;\n        }\n        const { id: activeSessionId } = activeSession;\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/assignments`\n        )) as RawAssignment[];\n        // Between the time we started fetching and the time the data arrived, the active session may have\n        // changed. Make sure the correct active session is set before updating the data.\n        if (isSameSession(activeSessionId, getState)) {\n            dispatch(fetchAssignmentsSuccess(data));\n        }\n        return data;\n    },\n});\n\nexport const fetchAssignment = validatedApiDispatcher({\n    name: \"fetchAssignment\",\n    description: \"Fetch assignment\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/assignments/${payload.id}`\n        )) as RawAssignment;\n        dispatch(fetchOneAssignmentSuccess(data));\n        return data;\n    },\n});\n\n// Some helper functions to convert the data that the UI uses\n// into data that the API can use\nconst applicantToApplicantId = flattenIdFactory<\"applicant\", \"applicant_id\">(\n    \"applicant\",\n    \"applicant_id\"\n);\nconst positionToPositionId = flattenIdFactory<\"position\", \"position_id\">(\n    \"position\",\n    \"position_id\"\n);\nfunction prepForApi(data: Partial<Assignment>) {\n    return positionToPositionId(\n        applicantToApplicantId(data)\n    ) as Partial<RawAssignment>;\n}\n\nexport const upsertAssignment = validatedApiDispatcher({\n    name: \"upsertAssignment\",\n    description: \"Add/insert assignment\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher:\n        (payload: Partial<Assignment>) => async (dispatch, getState) => {\n            const role = activeRoleSelector(getState());\n            let data = (await apiPOST(\n                `/${role}/assignments`,\n                prepForApi(payload)\n            )) as RawAssignment;\n            dispatch(upsertOneAssignmentSuccess(data));\n            if (payload.wage_chunks) {\n                await dispatch(\n                    upsertWageChunksForAssignment(data, payload.wage_chunks)\n                );\n                // The wage chunks could have changed the number of \"hours\" for the assignment.\n                // Refetch it to make sure the data isn't stale.\n                data = await dispatch(fetchAssignment(data));\n            }\n            dispatch(upsertOneAssignmentSuccess(data));\n            return data;\n        },\n});\n\nexport const deleteAssignment = validatedApiDispatcher({\n    name: \"deleteAssignment\",\n    description: \"Delete assignment\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/delete`,\n            prepForApi(payload)\n        );\n        dispatch(deleteOneAssignmentSuccess(data));\n    },\n});\n\nexport const exportAssignments = validatedApiDispatcher({\n    name: \"exportAssignments\",\n    description: \"Export assignments\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher:\n        (\n            formatter: PrepareDataFunc<Assignment>,\n            format: ExportFormat = \"spreadsheet\"\n        ) =>\n        async (dispatch, getState) => {\n            if (!(formatter instanceof Function)) {\n                throw new Error(\n                    `\"formatter\" must be a function when using the export action.`\n                );\n            }\n            // Re-fetch all assignments from the server in case things happened to be out of sync.\n            await dispatch(fetchAssignments());\n            const assignments = assignmentsSelector(getState());\n\n            // Normally, wage chunk information is not fetched with an assignment. This information\n            // must be fetched separately.\n            const wageChunkPromises = assignments.map((assignment) =>\n                dispatch(fetchWageChunksForAssignment(assignment))\n            );\n            await Promise.all(wageChunkPromises);\n            // Attach the wage chunk information to each assignment\n            for (const assignment of assignments) {\n                assignment.wage_chunks = wageChunksByAssignmentSelector(\n                    getState()\n                )(assignment);\n            }\n\n            return formatter(assignments, format);\n        },\n});\n\nexport const upsertAssignments = validatedApiDispatcher({\n    name: \"upsertAssignments\",\n    description: \"Upsert a list of assignments\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignments: Partial<Assignment>[]) => async (dispatch) => {\n        if (assignments.length === 0) {\n            return;\n        }\n        const dispatchers = assignments.map((assignment) =>\n            dispatch(upsertAssignment(assignment))\n        );\n        await Promise.all(dispatchers);\n        // Re-fetch all assignments from the server in case things happened to be out of sync.\n        await dispatch(fetchAssignments());\n    },\n});\n\n// selectors\n\n/**\n * Returns whether the number of hours for the `assignment` and the sum\n * total hours of `wageChunks` match.\n *\n * @param {*} assignment\n * @param {*} wageChunks\n * @returns\n */\nfunction wageChunksMatchAssignment(\n    assignment: RawAssignment,\n    wageChunks: WageChunk[]\n) {\n    if (!wageChunks) {\n        return true;\n    }\n    let totalHours = 0;\n    for (const chunk of wageChunks) {\n        totalHours += chunk.hours;\n    }\n    return totalHours === assignment.hours;\n}\n\n// Each reducer is given an isolated state; instead of needing to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nconst localStoreSelector = assignmentsReducer._localStoreSelector;\n/**\n * Get just the assignment data as it appears in the store; i.e., it has references to\n * id's of applicants and positions.\n */\nconst _assignmentsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData\n);\nconst _offersByAssignmentIdSelector = createSelector(\n    localStoreSelector,\n    (state) => state._offersByAssignmentId\n);\n/**\n * Get the current assignments. This selector is memoized and will only\n * be recomputed when assignments, applicants, or positions change. If wageChunks\n * have been loaded for the assignment, they are included, otherwise they are null.\n */\nexport const assignmentsSelector = createSelector(\n    [\n        _assignmentsSelector,\n        applicantsSelector,\n        positionsSelector,\n        wageChunksByAssignmentSelector,\n        _offersByAssignmentIdSelector,\n    ],\n    (\n        assignments,\n        applicants,\n        positions,\n        getWageChunksForAssignment,\n        offersByAssignmentIdHash\n    ) => {\n        if (assignments.length === 0) {\n            return [];\n        }\n        const applicantsById = arrayToHash(applicants);\n        const positionsById = arrayToHash(positions);\n        return (\n            assignments\n                .map((assignment) => {\n                    const { position_id, applicant_id, ...rest } = assignment;\n                    const wage_chunks = getWageChunksForAssignment(assignment);\n                    const offers = offersByAssignmentIdHash[assignment.id];\n                    return {\n                        ...rest,\n                        position: positionsById[position_id] || {},\n                        applicant: applicantsById[applicant_id] || {},\n                        // Only return wage chunks if they match the current assignment. This\n                        // ensures stale (previously-loaded) wage chunks don't get served.\n                        wage_chunks: wageChunksMatchAssignment(\n                            assignment,\n                            wage_chunks\n                        )\n                            ? wage_chunks\n                            : null,\n                        offers,\n                    } as Assignment;\n                })\n                // There could be a race condition where the assignments are loaded before applicants and positions.\n                // We filter out any assignments that don't have a corresponding applicant and position.\n                .filter(\n                    (assignment) =>\n                        assignment.position.id != null &&\n                        assignment.applicant.id != null\n                )\n        );\n    }\n);\n","import {\n    FETCH_POSITIONS_SUCCESS,\n    FETCH_ONE_POSITION_SUCCESS,\n    UPSERT_ONE_POSITION_SUCCESS,\n    DELETE_ONE_POSITION_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    validatedApiDispatcher,\n    arrayToHash,\n    flattenIdFactory,\n    HasId,\n    isSameSession,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { positionsReducer } from \"../reducers/positions\";\nimport { createSelector } from \"reselect\";\nimport { instructorsSelector } from \"./instructors\";\nimport { contractTemplatesSelector } from \"./contract_templates\";\nimport { activeRoleSelector } from \"./users\";\nimport { Position, RawPosition } from \"../defs/types\";\nimport { activeSessionSelector } from \"./sessions\";\nimport { ExportFormat, PrepareDataFunc } from \"../../libs/import-export\";\n\n// actions\nexport const fetchPositionsSuccess = actionFactory<RawPosition[]>(\n    FETCH_POSITIONS_SUCCESS\n);\nconst fetchOnePositionSuccess = actionFactory<RawPosition>(\n    FETCH_ONE_POSITION_SUCCESS\n);\nconst upsertOnePositionSuccess = actionFactory<RawPosition>(\n    UPSERT_ONE_POSITION_SUCCESS\n);\nconst deleteOnePositionSuccess = actionFactory<RawPosition>(\n    DELETE_ONE_POSITION_SUCCESS\n);\n\nconst MissingActiveSessionError = new Error(\n    \"Cannot interact with Positions without an active session\"\n);\n\n// dispatchers\nexport const fetchPositions = validatedApiDispatcher({\n    name: \"fetchPositions\",\n    description: \"Fetch positions\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw MissingActiveSessionError;\n        }\n        const { id: activeSessionId } = activeSession;\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/positions`\n        )) as RawPosition[];\n        // Between the time we started fetching and the time the data arrived, the active session may have\n        // changed. Make sure the correct active session is set before updating the data.\n        if (isSameSession(activeSessionId, getState)) {\n            dispatch(fetchPositionsSuccess(data));\n        }\n        return data;\n    },\n});\n\nexport const fetchPosition = validatedApiDispatcher({\n    name: \"fetchPosition\",\n    description: \"Fetch position\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw MissingActiveSessionError;\n        }\n        const { id: activeSessionId } = activeSession;\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/positions/${payload.id}`\n        )) as RawPosition;\n        dispatch(fetchOnePositionSuccess(data));\n    },\n});\n\n// Some helper functions to convert the data that the UI uses\n// into data that the API can use\nconst instructorsToInstructorIds = flattenIdFactory<\n    \"instructors\",\n    \"instructor_ids\"\n>(\"instructors\", \"instructor_ids\");\nconst contractTemplateToContractTemplateId = flattenIdFactory<\n    \"contract_template\",\n    \"contract_template_id\"\n>(\"contract_template\", \"contract_template_id\");\n\nfunction prepForApi(data: Partial<Position>) {\n    return contractTemplateToContractTemplateId(\n        instructorsToInstructorIds(data)\n    ) as Partial<RawPosition>;\n}\n\nexport const upsertPosition = validatedApiDispatcher({\n    name: \"upsertPosition\",\n    description: \"Add/insert position\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload: Partial<Position>) => async (dispatch, getState) => {\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw MissingActiveSessionError;\n        }\n        const { id: activeSessionId } = activeSession;\n        const role = activeRoleSelector(getState());\n        const data = (await apiPOST(\n            `/${role}/sessions/${activeSessionId}/positions`,\n            prepForApi(payload)\n        )) as RawPosition;\n        dispatch(upsertOnePositionSuccess(data));\n        return data;\n    },\n});\n\nexport const deletePosition = validatedApiDispatcher({\n    name: \"deletePosition\",\n    description: \"Delete position\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiPOST(\n            `/${role}/positions/delete`,\n            prepForApi(payload)\n        )) as RawPosition;\n        dispatch(deleteOnePositionSuccess(data));\n    },\n});\n\nexport const exportPositions = validatedApiDispatcher({\n    name: \"exportPositions\",\n    description: \"Export positions\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher:\n        (\n            formatter: PrepareDataFunc<Position>,\n            format: ExportFormat = \"spreadsheet\"\n        ) =>\n        async (dispatch, getState) => {\n            if (!(formatter instanceof Function)) {\n                throw new Error(\n                    `\"formatter\" must be a function when using the export action.`\n                );\n            }\n            // Re-fetch all positions from the server in case things happened to be out of sync.\n            await dispatch(fetchPositions());\n            const positions = positionsSelector(getState());\n\n            return formatter(positions, format);\n        },\n});\n\nexport const upsertPositions = validatedApiDispatcher({\n    name: \"upsertPositions\",\n    description: \"Upsert a list of positions\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (positions: Partial<Position>[]) => async (dispatch) => {\n        if (positions.length === 0) {\n            return;\n        }\n        const dispatchers = positions.map((position) =>\n            dispatch(upsertPosition(position))\n        );\n        await Promise.all(dispatchers);\n        // Re-fetch all positions from the server in case things happened to be out of sync.\n        await dispatch(fetchPositions());\n    },\n});\n\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nconst localStoreSelector = positionsReducer._localStoreSelector;\nconst _positionsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData\n);\n/**\n * Get the positions, but populate the `instructors` array with the full instructor\n * information.\n */\nexport const positionsSelector = createSelector(\n    [_positionsSelector, instructorsSelector, contractTemplatesSelector],\n    (positions, instructors, contractTemplates) => {\n        // Hash the instructors by `id` for fast lookup\n        const instructorsById = arrayToHash(instructors);\n        const contractTemplatesById = arrayToHash(contractTemplates);\n\n        // Leave all the data alone, except replace the `instructor_ids` list\n        // with the full instructor data.\n        return positions.map(\n            ({ instructor_ids, contract_template_id, ...rest }) => ({\n                ...rest,\n                // When the instructor list references an instructor that we haven't loaded\n                // we don't want the frontend to crash, so filter out any null instructors\n                instructors: instructor_ids\n                    .map((x) => instructorsById[x])\n                    .filter((x) => x),\n                contract_template: contractTemplatesById[contract_template_id],\n            })\n        ) as Position[];\n    }\n);\n","import {\n    FETCH_DDAHS_SUCCESS,\n    FETCH_ONE_DDAH_SUCCESS,\n    UPSERT_ONE_DDAH_SUCCESS,\n    DELETE_ONE_DDAH_SUCCESS,\n    DDAH_APPROVE_SUCCESS,\n    DDAH_EMAIL_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    validatedApiDispatcher,\n    arrayToHash,\n    flattenIdFactory,\n    HasId,\n    hasSubIdField,\n    isSameSession,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { createSelector } from \"reselect\";\nimport { activeRoleSelector } from \"./users\";\nimport { ddahsReducer } from \"../reducers\";\nimport { assignmentsSelector } from \"./assignments\";\nimport type { Ddah, RawAttachment, RawDdah } from \"../defs/types\";\nimport { activeSessionSelector } from \"./sessions\";\nimport { round } from \"../../libs/utils\";\n\n// actions\nconst fetchDdahsSuccess = actionFactory<RawDdah[]>(FETCH_DDAHS_SUCCESS);\nconst fetchOneDdahSuccess = actionFactory<RawDdah>(FETCH_ONE_DDAH_SUCCESS);\nconst upsertOneDdahSuccess = actionFactory<RawDdah>(UPSERT_ONE_DDAH_SUCCESS);\nconst deleteOneDdahSuccess = actionFactory<RawDdah>(DELETE_ONE_DDAH_SUCCESS);\nconst approveOneDdahSuccess = actionFactory<RawDdah>(DDAH_APPROVE_SUCCESS);\nconst emailOneDdahSuccess = actionFactory<RawDdah>(DDAH_EMAIL_SUCCESS);\n\n// dispatchers\nexport const fetchDdahs = validatedApiDispatcher({\n    name: \"fetchDdahs\",\n    description: \"Fetch DDAHs\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw new Error(\"Cannot fetch DDAHs without an active session\");\n        }\n        const { id: activeSessionId } = activeSession;\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/ddahs`\n        )) as RawDdah[];\n        // Between the time we started fetching and the time the data arrived, the active session may have\n        // changed. Make sure the correct active session is set before updating the data.\n        if (isSameSession(activeSessionId, getState)) {\n            dispatch(fetchDdahsSuccess(data));\n        }\n        return data;\n    },\n});\n\nexport const fetchDdah = validatedApiDispatcher({\n    name: \"fetchDdah\",\n    description: \"Fetch a DDAH\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(`/${role}/ddahs/${payload.id}`)) as RawDdah;\n        dispatch(fetchOneDdahSuccess(data));\n        return data;\n    },\n});\n\n// Some helper functions to convert the data that the UI uses\n// into data that the API can use\nconst assignmentToAssignmentId = flattenIdFactory<\n    \"assignment\",\n    \"assignment_id\"\n>(\"assignment\", \"assignment_id\");\nfunction prepForApi(data: Partial<Ddah>) {\n    if (hasSubIdField(data, \"assignment\")) {\n        return assignmentToAssignmentId(data);\n    }\n    return data;\n}\n\nexport const approveDdah = validatedApiDispatcher({\n    name: \"approveDdah\",\n    description: \"Set a DDAH's status to approved\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        let data = (await apiPOST(\n            `/${role}/ddahs/${payload.id}/approve`\n        )) as RawDdah;\n        dispatch(approveOneDdahSuccess(data));\n        // The previous action doesn't actually update the redux store,\n        // so we dispatch a fake upsert action to make sure the store gets updated\n        // with the new data.\n        dispatch(upsertOneDdahSuccess(data));\n        return data;\n    },\n});\n\nexport const emailDdah = validatedApiDispatcher({\n    name: \"emailDdah\",\n    description: \"Email a DDAH\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        let data = (await apiPOST(\n            `/${role}/ddahs/${payload.id}/email`\n        )) as RawDdah;\n        dispatch(emailOneDdahSuccess(data));\n        // The previous action doesn't actually update the redux store,\n        // so we dispatch a fake upsert action to make sure the store gets updated\n        // with the new data.\n        dispatch(upsertOneDdahSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertDdah = validatedApiDispatcher({\n    name: \"upsertDdah\",\n    description: \"Add/insert a DDAH\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload: Partial<Ddah>) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        let data = (await apiPOST(\n            `/${role}/ddahs`,\n            prepForApi(payload)\n        )) as RawDdah;\n        dispatch(upsertOneDdahSuccess(data));\n        return data;\n    },\n});\n\nexport const deleteDdah = validatedApiDispatcher({\n    name: \"deleteDdah\",\n    description: \"Delete a DDAH\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiPOST(\n            `/${role}/ddahs/${payload.id}/delete`,\n            prepForApi(payload)\n        )) as RawDdah;\n        dispatch(deleteOneDdahSuccess(data));\n    },\n});\n\nexport const exportDdahs = validatedApiDispatcher({\n    name: \"exportDdahs\",\n    description: \"Export DDAHs\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher:\n        (formatter, format = \"spreadsheet\") =>\n        async (dispatch, getState) => {\n            if (!(formatter instanceof Function)) {\n                throw new Error(\n                    `\"formatter\" must be a function when using the export action.`\n                );\n            }\n            // Re-fetch all assignments from the server in case things happened to be out of sync.\n            await dispatch(fetchDdahs());\n            const ddahs = ddahsSelector(getState());\n\n            return formatter(ddahs, format);\n        },\n});\n\nexport const upsertDdahs = validatedApiDispatcher({\n    name: \"upsertDdahs\",\n    description: \"Upsert a list of DDAHs\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (ddahs: Partial<Ddah>[]) => async (dispatch) => {\n        if (ddahs.length === 0) {\n            return;\n        }\n        const dispatchers = ddahs.map((ddah) => dispatch(upsertDdah(ddah)));\n        await Promise.all(dispatchers);\n        // Re-fetch all assignments from the server in case things happened to be out of sync.\n        await dispatch(fetchDdahs());\n    },\n});\n\nexport const downloadDdahAcceptedList = validatedApiDispatcher({\n    name: \"downloadDdahAcceptedList\",\n    description: \"Download a pdf list of accepted DDAHs for the active session\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (_dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw new Error(\"Cannot fetch DDAHs without an active session\");\n        }\n        const { id: activeSessionId } = activeSession;\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/ddahs/accepted_list.pdf`\n        )) as RawAttachment;\n\n        // The data comes in encoded as base64, so we decode it as binary data.\n        const content = new Uint8Array(\n            atob(data.content)\n                .split(\"\")\n                .map((x) => x.charCodeAt(0))\n        );\n        return new File([content], data.file_name, {\n            type: data.mime_type,\n        });\n    },\n});\n\n// selectors\n\n/**\n * Compute the status of a DDAH (e.g., accepted/rejected)\n *\n * @param {*} ddah\n * @returns\n */\nfunction computeDdahStatus(ddah: Pick<Ddah, \"accepted_date\" | \"emailed_date\">) {\n    if (ddah.accepted_date) {\n        return \"accepted\";\n    }\n    if (ddah.emailed_date) {\n        return \"emailed\";\n    }\n    return null;\n}\n\n/**\n * Compute the total number of hours for all duties for the current DDAH\n *\n * @param {*} ddah\n * @returns\n */\nfunction computeDdahHours(ddah: Pick<Ddah, \"duties\">) {\n    let ret = 0;\n    for (const duty of ddah.duties) {\n        ret += duty.hours;\n    }\n    return round(ret, 2);\n}\n\n// Each reducer is given an isolated state; instead of needing to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nexport const localStoreSelector = ddahsReducer._localStoreSelector;\n/**\n * Get just the ddah data as it appears in the store; i.e., it has references to\n * id's of assignments.\n */\nconst _ddahsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData as RawDdah[]\n);\n/**\n * Get the current ddahs. This selector is memoized and will only\n * be recomputed when ddahs or assignments change.\n */\nexport const ddahsSelector = createSelector(\n    [_ddahsSelector, assignmentsSelector],\n    (ddahs, assignments) => {\n        if (ddahs.length === 0) {\n            return [];\n        }\n        const assignmentsHash = arrayToHash(assignments);\n        return (\n            ddahs\n                .map(({ assignment_id, ...rest }) => ({\n                    ...rest,\n                    status: computeDdahStatus(rest),\n                    total_hours: computeDdahHours(rest),\n                    assignment: assignmentsHash[assignment_id] || {},\n                }))\n                // If the DDAHs are loaded before the assignments, we may have a mismatch here.\n                // We filter out any ddahs without assignments (they will be updated when\n                // assignments become available.)\n                .filter((ddah) => ddah.assignment.id != null) as Ddah[]\n        );\n    }\n);\n","import {\n    setActiveSession,\n    fetchSessions,\n    sessionsSelector,\n    activeSessionSelector,\n} from \"./sessions\";\nimport {\n    fetchActiveUser,\n    setActiveUserRole,\n    activeRoleSelector,\n} from \"./users\";\nimport { fetchApplicants, fetchApplicantsSuccess } from \"./applicants\";\nimport { fetchApplications, fetchApplicationsSuccess } from \"./applications\";\nimport { fetchAssignments, fetchAssignmentsSuccess } from \"./assignments\";\nimport {\n    fetchContractTemplates,\n    fetchContractTemplatesSuccess,\n} from \"./contract_templates\";\nimport { fetchInstructors, fetchInstructorsSuccess } from \"./instructors\";\nimport { fetchPositions, fetchPositionsSuccess } from \"./positions\";\nimport { setGlobals, globalsSelector } from \"./globals\";\nimport { parseURLSearchString } from \"../../libs/urls\";\nimport { fetchDdahs } from \"./ddahs\";\nimport { ThunkAction } from \"redux-thunk\";\nimport { RootState } from \"../../rootReducer\";\nimport { AnyAction } from \"redux\";\nimport {\n    fetchInstructorPreferences,\n    fetchInstructorPreferencesSuccess,\n} from \"./instructor_preferences\";\nimport { fetchPostingPositionsSuccess, fetchPostingsSuccess } from \"./postings\";\n\ntype InitStages =\n    | \"pageLoad\"\n    | \"toggleMockAPI\"\n    | \"setActiveUser\"\n    | \"setActiveUserRole\"\n    | \"fetchInstructors\"\n    | \"fetchSessions\"\n    | \"setActiveSession\"\n    | \"updateGlobals\"\n    | \"fetchSessionDependentData\";\n\n/**\n * A helper function to replace all API actions to\n * use mock API actions.\n *\n * @param {boolean} enableMockAPI\n */\nfunction toggleMockApi(enableMockAPI: boolean) {\n    // in production, ToggleMockApi is a no-op. In development, it actually\n    // does something.\n    /* eslint-disable */\n    if (enableMockAPI != null && process.env.REACT_APP_DEV_FEATURES) {\n        const mock = require(\"../mockAPI\");\n        const mockAPI = mock.mockAPI;\n\n        if (enableMockAPI === true) {\n            mockAPI.replaceGlobalFetch();\n        } else {\n            mockAPI.restoreGlobalFetch();\n        }\n    }\n    /* eslint-enable */\n}\n\n/**\n * Prepare an object to be used to set global variables. The\n * return value is the same as the input except with `null` entries\n * removed.\n *\n * @param globals\n * @returns same as input but with `null` values removed.\n */\nfunction prepareGlobals<T extends Record<string, string | number | null>>(\n    globals: T\n) {\n    const ret: Record<string, string | number> = {};\n    for (const [key, val] of Object.entries(globals)) {\n        if (val != null) {\n            ret[key] = val;\n        }\n    }\n    return ret;\n}\n\n/**\n * Various actions have side effects, requiring additional actions to\n * be dispatched. For example, if a session changes, all data related to\n * that session needs to be re-fetched.\n *\n * This function allows you to specify \"stage\" to start the init procedure at.\n * It will handle re-fetching any dependent data and dispatching any\n * required actions depending on the stage specified.\n *\n * @export\n * @param stage - What stage to start the init procedure at\n * @param options - if true, start from the stage following the specified stage; if false, start from the specified stage\n * @returns an async function that handles all the API calls.\n */\nexport function initFromStage(\n    stage: InitStages,\n    options = { startAfterStage: false }\n): ThunkAction<Promise<void>, RootState, void, AnyAction> {\n    const startAfterStage = options.startAfterStage ? 1 : 0;\n\n    return async (dispatch, getState) => {\n        const parsedGlobals = {\n            mockAPI: null,\n            activeSession: null,\n            role: null,\n        };\n\n        // These actions don't need to finish in a specific order,\n        // so we can wait for them to finish at the end of this function to speed up startup.\n        const asyncActions = [];\n\n        /**\n         * A helper function to determine if the `currentStage`\n         * should be run\n         *\n         * @param queryStage\n         * @returns whether the `currentStage` action should be performed\n         */\n        function shouldRunStage(queryStage: InitStages) {\n            const initOrder: InitStages[] = [\n                \"pageLoad\",\n                \"toggleMockAPI\",\n                \"setActiveUser\",\n                \"setActiveUserRole\",\n                \"fetchInstructors\",\n                \"fetchSessions\",\n                \"setActiveSession\",\n                \"updateGlobals\",\n                \"fetchSessionDependentData\",\n            ];\n\n            // Is the queried stage dependent on the current stage?\n            // If `startAfterStage` is set, we actually want to know\n            // if we are the *next* stage.\n            const stageDependent =\n                initOrder.indexOf(stage) + startAfterStage <=\n                initOrder.indexOf(queryStage);\n\n            // `\"setActiveSession\" requires that an active session be set before\n            // it gets run.\n            if (stageDependent && queryStage === \"setActiveSession\") {\n                const state = getState();\n                const sessions = sessionsSelector(state);\n                const activeSession = activeSessionSelector(state) || {\n                    id: parsedGlobals.activeSession,\n                };\n                return sessions.find(\n                    (session) => session.id === activeSession.id\n                );\n            }\n\n            // All session dependent data depends on an active session being set\n            if (stageDependent && queryStage === \"fetchSessionDependentData\") {\n                const state = getState();\n                const activeSession = activeSessionSelector(state);\n                return activeSession?.id != null;\n            }\n\n            return stageDependent;\n        }\n\n        if (shouldRunStage(\"pageLoad\")) {\n            // When the page loads we parse the URL and pull out any globals that\n            // need setting\n            if (window.location) {\n                Object.assign(\n                    parsedGlobals,\n                    parseURLSearchString(window.location.search)\n                );\n                // Immediately set any global variables in the Redux store.\n                await dispatch(setGlobals(prepareGlobals(parsedGlobals)));\n            }\n        }\n\n        if (shouldRunStage(\"toggleMockAPI\")) {\n            const globals = globalsSelector(getState());\n            toggleMockApi(globals.mockAPI);\n        }\n\n        if (shouldRunStage(\"setActiveUser\")) {\n            await dispatch(fetchActiveUser());\n        }\n\n        if (shouldRunStage(\"setActiveUserRole\")) {\n            // When the role is changed, data should be cleared immediately.\n            // It will be re-fetched via the appropriate routes.\n            dispatch(clearSessionDependentData());\n            dispatch(fetchInstructorsSuccess([]));\n\n            const activeRole = activeRoleSelector(getState());\n            await dispatch(setActiveUserRole(activeRole, { skipInit: true }));\n        }\n\n        if (shouldRunStage(\"fetchInstructors\")) {\n            // Even though we eventually catch all the errors when we await the asyncActions,\n            // sometimes an error is thrown before we have a chance to await it. React,\n            // in dev mode, watches for any uncaught errors in promises and will refuse to\n            // render the interface if there are any. For that reason, we set this promise\n            // up with a catch block right away.\n            asyncActions.push(dispatch(fetchInstructors()).catch(console.log));\n        }\n\n        if (shouldRunStage(\"fetchSessions\")) {\n            await dispatch(fetchSessions());\n        }\n\n        if (shouldRunStage(\"setActiveSession\")) {\n            // after sessions are fetched, we compare with the active session.\n            // The active session might need to be \"updated\" if the ID matches but\n            // the data doesn't\n            const state = getState();\n            const sessions = sessionsSelector(state);\n            const activeSession = activeSessionSelector(state);\n            // There are two places where the active session could be store:\n            // in the URL as a global and in the Redux store. Prefer the value\n            // in the URL.\n            const matchingSession =\n                sessions.find(\n                    (session) => session.id === parsedGlobals.activeSession\n                ) || activeSession;\n\n            await dispatch(\n                setActiveSession(matchingSession, { skipInit: true })\n            );\n        }\n\n        if (shouldRunStage(\"updateGlobals\")) {\n            await dispatch(setGlobals(prepareGlobals(parsedGlobals)));\n        }\n\n        if (shouldRunStage(\"fetchSessionDependentData\")) {\n            // Before fetching session-related data, the existing data\n            // should be cleared. It will be re-fetched via the appropriate routes,\n            // but clearing now will prevent excess re-renders as data streams in.\n            await dispatch(clearSessionDependentData());\n\n            // `fetchActions` array contains all the fetch API calls that need to be\n            // made in order to obtain all data that the app needs.\n            const fetchActions = [\n                fetchContractTemplates,\n                fetchApplicants,\n                fetchPositions,\n                fetchApplications,\n                fetchAssignments,\n                fetchDdahs,\n                fetchInstructorPreferences,\n            ];\n\n            // The order of fetching here doesn't matter, so dispatch all at once\n            await Promise.all(\n                fetchActions.map((action) => dispatch(action() as any))\n            );\n        }\n\n        // Wait for async actions dispatched earlier to complete.\n        await Promise.all(asyncActions);\n    };\n}\n\n/**\n * Clear all session-specific store data: applicants, assignments,\n * contract templates, applications, and positions.\n *\n * @export\n * @returns an async function that handles all the API calls.\n */\nexport function clearSessionDependentData(): ThunkAction<\n    Promise<void>,\n    RootState,\n    void,\n    AnyAction\n> {\n    return async (dispatch) => {\n        await Promise.all([\n            dispatch(fetchInstructorPreferencesSuccess([])),\n            dispatch(fetchApplicantsSuccess([])),\n            dispatch(fetchAssignmentsSuccess([])),\n            dispatch(fetchContractTemplatesSuccess([])),\n            dispatch(fetchApplicationsSuccess([])),\n            dispatch(fetchPositionsSuccess([])),\n            dispatch(fetchPostingsSuccess([])),\n            dispatch(fetchPostingPositionsSuccess([])),\n        ]);\n    };\n}\n","import {\n    FETCH_APPLICANTS_SUCCESS,\n    FETCH_ONE_APPLICANT_SUCCESS,\n    UPSERT_ONE_APPLICANT_SUCCESS,\n    DELETE_ONE_APPLICANT_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    HasId,\n    isSameSession,\n    validatedApiDispatcher,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { applicantsReducer } from \"../reducers/applicants\";\nimport { createSelector } from \"reselect\";\nimport { activeRoleSelector } from \"./users\";\nimport { activeSessionSelector } from \"./sessions\";\nimport { Applicant, RawApplicant } from \"../defs/types\";\nimport { ExportFormat, PrepareDataFunc } from \"../../libs/import-export\";\n\n// actions\nexport const fetchApplicantsSuccess = actionFactory<RawApplicant[]>(\n    FETCH_APPLICANTS_SUCCESS\n);\nconst fetchOneApplicantSuccess = actionFactory<RawApplicant>(\n    FETCH_ONE_APPLICANT_SUCCESS\n);\nconst upsertOneApplicantSuccess = actionFactory<RawApplicant>(\n    UPSERT_ONE_APPLICANT_SUCCESS\n);\nconst deleteOneApplicantSuccess = actionFactory<RawApplicant>(\n    DELETE_ONE_APPLICANT_SUCCESS\n);\n\n// dispatchers\nexport const fetchApplicants = validatedApiDispatcher({\n    name: \"fetchApplicants\",\n    description: \"Fetch applicants\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        // When we fetch applicants, we only want the applicants associated with the current session\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw new Error(\"Cannot fetch DDAHs without an active session\");\n        }\n        const { id: activeSessionId } = activeSession;\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/applicants`\n        )) as RawApplicant[];\n        // Between the time we started fetching and the time the data arrived, the active session may have\n        // changed. Make sure the correct active session is set before updating the data.\n        if (isSameSession(activeSessionId, getState)) {\n            dispatch(fetchApplicantsSuccess(data));\n        }\n        return data;\n    },\n});\n\nexport const fetchApplicant = validatedApiDispatcher({\n    name: \"fetchApplicant\",\n    description: \"Fetch applicant\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/applicants/${payload.id}`\n        )) as RawApplicant;\n        dispatch(fetchOneApplicantSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertApplicant = validatedApiDispatcher({\n    name: \"upsertApplicant\",\n    description: \"Add/insert applicant\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher:\n        (payload: Partial<Applicant>, bySession: boolean = true) =>\n        async (dispatch, getState) => {\n            const role = activeRoleSelector(getState());\n            let data: RawApplicant;\n            if (bySession) {\n                const activeSession = activeSessionSelector(getState());\n                if (activeSession == null) {\n                    throw new Error(\n                        \"Cannot fetch DDAHs without an active session\"\n                    );\n                }\n                const { id: activeSessionId } = activeSession;\n                data = await apiPOST(\n                    `/${role}/sessions/${activeSessionId}/applicants`,\n                    payload\n                );\n            } else {\n                data = await apiPOST(`/${role}/applicants`, payload);\n            }\n            dispatch(upsertOneApplicantSuccess(data));\n            return data;\n        },\n});\n\nexport const deleteApplicant = validatedApiDispatcher({\n    name: \"deleteApplicant\",\n    description: \"Delete applicant\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiPOST(\n            `/${role}/applicants/delete`,\n            payload\n        )) as RawApplicant;\n        dispatch(deleteOneApplicantSuccess(data));\n        return data;\n    },\n});\n\nexport const exportApplicants = validatedApiDispatcher({\n    name: \"exportApplicants\",\n    description: \"Export applicants\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher:\n        (\n            formatter: PrepareDataFunc<Applicant>,\n            format: ExportFormat = \"spreadsheet\"\n        ) =>\n        async (dispatch, getState) => {\n            if (!(formatter instanceof Function)) {\n                throw new Error(\n                    `\"formatter\" must be a function when using the export action.`\n                );\n            }\n            // Re-fetch all applicants from the server in case things happened to be out of sync.\n            await dispatch(fetchApplicants());\n            const applicants = applicantsSelector(getState());\n\n            return formatter(applicants, format);\n        },\n});\n\nexport const upsertApplicants = validatedApiDispatcher({\n    name: \"upsertApplicants\",\n    description: \"Upsert applicants\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (applicants: Partial<Applicant>[]) => async (dispatch) => {\n        if (applicants.length === 0) {\n            return;\n        }\n        const dispatchers = applicants.map((applicant) =>\n            dispatch(upsertApplicant(applicant))\n        );\n        await Promise.all(dispatchers);\n        // Re-fetch all applicants from the server in case things happened to be out of sync.\n        return await dispatch(fetchApplicants());\n    },\n});\n\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nconst localStoreSelector = applicantsReducer._localStoreSelector;\nexport const applicantsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData as Applicant[]\n);\n","import { createSelector } from \"reselect\";\nimport {\n    FETCH_POSTINGS_SUCCESS,\n    FETCH_ONE_POSTING_SUCCESS,\n    UPSERT_ONE_POSTING_SUCCESS,\n    DELETE_ONE_POSTING_SUCCESS,\n    FETCH_POSTING_POSITIONS_SUCCESS,\n    FETCH_ONE_POSTING_POSITION_SUCCESS,\n    UPSERT_ONE_POSTING_POSITION_SUCCESS,\n    DELETE_ONE_POSTING_POSITION_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    HasId,\n    isSameSession,\n    splitObjByProps,\n    validatedApiDispatcher,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { postingsReducer } from \"../reducers/postings\";\nimport { activeRoleSelector } from \"./users\";\nimport { postingPositionsReducer } from \"../reducers/posting_positions\";\nimport type {\n    Position,\n    Posting,\n    PostingPosition,\n    RawPosting,\n    RawPostingPosition,\n    RequireSome,\n} from \"../defs/types\";\nimport { positionsSelector } from \"./positions\";\nimport { ExportFormat } from \"../../libs/import-export\";\n\n// actions\nexport const fetchPostingsSuccess = actionFactory<RawPosting[]>(\n    FETCH_POSTINGS_SUCCESS\n);\nconst fetchOnePostingSuccess = actionFactory<RawPosting>(\n    FETCH_ONE_POSTING_SUCCESS\n);\nconst upsertOnePostingSuccess = actionFactory<RawPosting>(\n    UPSERT_ONE_POSTING_SUCCESS\n);\nconst deleteOnePostingSuccess = actionFactory<RawPosting>(\n    DELETE_ONE_POSTING_SUCCESS\n);\n\n// PostingPosition actions\nexport const fetchPostingPositionsSuccess = actionFactory<RawPostingPosition[]>(\n    FETCH_POSTING_POSITIONS_SUCCESS\n);\nconst fetchOnePostingPositionSuccess = actionFactory<RawPostingPosition>(\n    FETCH_ONE_POSTING_POSITION_SUCCESS\n);\nconst upsertOnePostingPositionSuccess = actionFactory<RawPostingPosition>(\n    UPSERT_ONE_POSTING_POSITION_SUCCESS\n);\nconst deleteOnePostingPositionSuccess = actionFactory<RawPostingPosition>(\n    DELETE_ONE_POSTING_POSITION_SUCCESS\n);\n\n// dispatchers\nexport const fetchPostings = validatedApiDispatcher({\n    name: \"fetchPostings\",\n    description: \"Fetch postings\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const activeSession = getState().model.sessions.activeSession;\n        if (activeSession == null) {\n            throw new Error(\"Cannot fetch Postings without an active session\");\n        }\n        const { id: activeSessionId } = activeSession;\n        const role = activeRoleSelector(getState());\n        const data = await apiGET(\n            `/${role}/sessions/${activeSessionId}/postings` as const\n        );\n        // Between the time we started fetching and the time the data arrived, the active session may have\n        // changed. Make sure the correct active session is set before updating the data.\n        if (isSameSession(activeSessionId, getState)) {\n            dispatch(fetchPostingsSuccess(data));\n        }\n        return data;\n    },\n});\n\nexport const fetchPosting = validatedApiDispatcher({\n    name: \"fetchPosting\",\n    description: \"Fetch posting\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/postings/${payload.id}`\n        )) as RawPosting;\n        dispatch(fetchOnePostingSuccess(data));\n        return data;\n    },\n});\n\nfunction prepPostingForApi(posting: Partial<Posting>): Partial<RawPosting> {\n    // eslint warns about unused variables by default. We want to ignore that warning in this case.\n    // eslint-disable-next-line\n    const [ret, _rest] = splitObjByProps(posting, [\n        \"posting_positions\",\n        \"applications\",\n    ]);\n    return ret;\n}\n\nexport const upsertPosting = validatedApiDispatcher({\n    name: \"upsertPosting\",\n    description: \"Add/insert posting\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher:\n        (payload: Partial<RawPosting> | Partial<Posting>) =>\n        async (dispatch, getState) => {\n            const role = activeRoleSelector(getState());\n            const activeSession = getState().model.sessions.activeSession;\n            if (activeSession == null) {\n                throw new Error(\n                    \"Cannot fetch Postings without an active session\"\n                );\n            }\n            const { id: activeSessionId } = activeSession;\n            const data = (await apiPOST(\n                `/${role}/sessions/${activeSessionId}/postings`,\n                prepPostingForApi(payload)\n            )) as RawPosting;\n            dispatch(upsertOnePostingSuccess(data));\n\n            // If there are posting_positions included with the posting, upsert them too\n            const posting_positions = (payload as Partial<Posting>)\n                .posting_positions;\n            if (Array.isArray(posting_positions)) {\n                const posting_id = data.id;\n                await Promise.all(\n                    posting_positions.map((postingPosition) =>\n                        dispatch(\n                            upsertPostingPosition({\n                                ...postingPosition,\n                                // Since we may be upserting into a newly-created posting, the supplied data\n                                // might not have the posting id. Insert it just to be sure it's there.\n                                posting_id,\n                                posting: {\n                                    ...postingPosition.posting,\n                                    id: posting_id,\n                                },\n                            })\n                        )\n                    )\n                );\n                // TODO: we currently don't check to see if there are any PostingPositions that we should delete.\n            }\n            return data;\n        },\n});\n\nexport const deletePosting = validatedApiDispatcher({\n    name: \"deletePosting\",\n    description: \"Delete posting\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiPOST(\n            `/${role}/postings/delete`,\n            payload\n        )) as RawPosting;\n        dispatch(deleteOnePostingSuccess(data));\n    },\n});\n\nexport const fetchSurvey = validatedApiDispatcher({\n    name: \"fetchSurvey\",\n    description: \"Fetch the survey associated with a posting\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (_dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/postings/${payload.id}/survey`\n        )) as any;\n        return data;\n    },\n});\n\n// PostingPosition dispatchers\nexport const fetchPostingPositions = validatedApiDispatcher({\n    name: \"fetchPostingPositions\",\n    description: \"Fetch posting_positions\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const activeSession = getState().model.sessions.activeSession;\n        if (activeSession == null) {\n            throw new Error(\n                \"Cannot fetch PostingPositions without an active session\"\n            );\n        }\n        const { id: activeSessionId } = activeSession;\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/posting_positions`\n        )) as RawPostingPosition[];\n        dispatch(fetchPostingPositionsSuccess(data));\n        return data;\n    },\n});\n\nexport const fetchPostingPositionsForPosting = validatedApiDispatcher({\n    name: \"fetchPostingPositionsForPosting\",\n    description: \"Fetch posting_positions for a particular posting\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (posting: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/postings/${posting.id}/posting_positions`\n        )) as RawPostingPosition[];\n        dispatch(fetchPostingPositionsSuccess(data));\n        return data;\n    },\n});\n\nexport const fetchPostingPosition = validatedApiDispatcher({\n    name: \"fetchPostingPosition\",\n    description: \"Fetch posting_position\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/posting_positions/${payload.id}`\n        )) as RawPostingPosition;\n        dispatch(fetchOnePostingPositionSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertPostingPosition = validatedApiDispatcher({\n    name: \"upsertPostingPosition\",\n    description: \"Add/insert posting_position\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher:\n        (\n            payload:\n                | RequireSome<RawPostingPosition, \"position_id\" | \"posting_id\">\n                | RequireSome<PostingPosition, \"position\" | \"posting\">\n        ) =>\n        async (dispatch, getState) => {\n            const rawPostingPosition = prepPostingPositionForApi(payload);\n            const role = activeRoleSelector(getState());\n            const data = (await apiPOST(\n                `/${role}/posting_positions`,\n                rawPostingPosition\n            )) as RawPostingPosition;\n            dispatch(upsertOnePostingPositionSuccess(data));\n            return data;\n        },\n});\n\nexport const deletePostingPosition = validatedApiDispatcher({\n    name: \"deletePostingPosition\",\n    description: \"Delete posting_position\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher:\n        (\n            payload:\n                | RequireSome<RawPostingPosition, \"position_id\" | \"posting_id\">\n                | RequireSome<PostingPosition, \"position\" | \"posting\">\n        ) =>\n        async (dispatch, getState) => {\n            const rawPostingPosition = prepPostingPositionForApi(payload);\n            const role = activeRoleSelector(getState());\n            const data = (await apiPOST(\n                `/${role}/posting_positions/delete`,\n                rawPostingPosition\n            )) as RawPostingPosition;\n            dispatch(deleteOnePostingPositionSuccess(data));\n        },\n});\n\nexport const exportPosting = validatedApiDispatcher({\n    name: \"exportPosting\",\n    description: \"Export a posting\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher:\n        (\n            postingId: number,\n            formatter: (posting: Posting, exportFormat: ExportFormat) => File,\n            format: ExportFormat = \"spreadsheet\"\n        ) =>\n        async (dispatch, getState) => {\n            if (!(formatter instanceof Function)) {\n                throw new Error(\n                    `\"formatter\" must be a function when using the export action.`\n                );\n            }\n            // Re-fetch all applicants from the server in case things happened to be out of sync.\n            await Promise.all([dispatch(fetchPostings())]);\n            const postings = postingsSelector(getState());\n            const posting = postings.find(\n                (posting) => posting.id === postingId\n            );\n\n            if (posting == null) {\n                throw new Error(`Could not find posting with id ${postingId}`);\n            }\n\n            return formatter(posting, format);\n        },\n});\n\nfunction isRawPostingPosition(\n    obj: any\n): obj is RequireSome<RawPostingPosition, \"position_id\" | \"posting_id\"> {\n    if (\n        obj != null &&\n        typeof obj === \"object\" &&\n        \"posting_id\" in obj &&\n        \"position_id\" in obj\n    ) {\n        return true;\n    }\n    return false;\n}\n\nfunction prepPostingPositionForApi(\n    obj:\n        | RequireSome<PostingPosition, \"position\" | \"posting\">\n        | RequireSome<RawPostingPosition, \"position_id\" | \"posting_id\">\n): RequireSome<RawPostingPosition, \"position_id\" | \"posting_id\"> {\n    if (isRawPostingPosition(obj)) {\n        return obj;\n    }\n    const [core, rest] = splitObjByProps(obj, [\"position\", \"posting\"]);\n    return {\n        ...core,\n        position_id: rest.position.id,\n        posting_id: rest.posting.id,\n    };\n}\n\n// selectors\n/**\n * Since Postings and PostingPositions reference each other,\n * we need a function that can create both at the same time.\n *\n * @param {RawPosting} rawPosting\n * @param {RawPostingPosition[]} rawPostingPositions\n * @param {Position[]} positions\n * @returns\n */\nfunction combinePostingAndPostingPosition(\n    rawPosting: RawPosting,\n    rawPostingPositions: RawPostingPosition[],\n    positions: Position[]\n) {\n    const positionsMap = new Map(\n        positions.map((position) => [position.id, position])\n    );\n    // eslint-disable-next-line\n    const [partialPosting, _postingRest] = splitObjByProps(rawPosting, [\n        \"application_ids\",\n    ]);\n    const posting: Posting = {\n        ...partialPosting,\n        applications: [],\n        posting_positions: [],\n    };\n    const postingPositions = rawPostingPositions\n        // We only want PostingPositions associated with the given posting\n        .filter(\n            (rawPostingPosition) =>\n                rawPostingPosition.posting_id === rawPosting.id\n        )\n        // We only want PostingPositions whose corresponding position has been loaded/exits\n        .filter((rawPostingPosition) =>\n            positionsMap.has(rawPostingPosition.position_id)\n        )\n        .map<PostingPosition>((rawPostingPosition) => {\n            const [partialPostingPosition, rest] = splitObjByProps(\n                rawPostingPosition,\n                [\"position_id\", \"posting_id\"]\n            );\n            return {\n                ...partialPostingPosition,\n                position: positionsMap.get(rest.position_id)!,\n                posting,\n            };\n        });\n\n    posting.posting_positions = postingPositions;\n\n    return { posting, postingPositions };\n}\n\nconst localStoreSelector = postingsReducer._localStoreSelector;\nconst localStoreSelector2 = postingPositionsReducer._localStoreSelector;\nexport const postingsSelector = createSelector(\n    localStoreSelector,\n    localStoreSelector2,\n    positionsSelector,\n    (postingsState, postingPositionsState, positions) => {\n        const rawPostingPositions = postingPositionsState._modelData;\n        return postingsState._modelData\n            .map((rawPosting) =>\n                combinePostingAndPostingPosition(\n                    rawPosting,\n                    rawPostingPositions,\n                    positions\n                )\n            )\n            .map((processed) => processed.posting);\n    }\n);\n\nexport const postingPositionsSelector = createSelector(\n    localStoreSelector2,\n    localStoreSelector,\n    positionsSelector,\n    (postingPositionsState, postingsState, positions) => {\n        const rawPostingPositions = postingPositionsState._modelData;\n        return (\n            postingsState._modelData\n                .map((rawPosting) =>\n                    combinePostingAndPostingPosition(\n                        rawPosting,\n                        rawPostingPositions,\n                        positions\n                    )\n                )\n                .map((processed) => processed.postingPositions)\n                // A PostingPosition is uniquely determined by its Position and Posting, so\n                // it is impossible to have duplicates when we call `.flat()`\n                .flat()\n        );\n    }\n);\n","import {\n    FETCH_INSTRUCTORS_SUCCESS,\n    FETCH_ONE_INSTRUCTOR_SUCCESS,\n    UPSERT_ONE_INSTRUCTOR_SUCCESS,\n    DELETE_ONE_INSTRUCTOR_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport { actionFactory, HasId, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { instructorsReducer } from \"../reducers/instructors\";\nimport { createSelector } from \"reselect\";\nimport { activeRoleSelector } from \"./users\";\nimport { Instructor, RawInstructor } from \"../defs/types\";\nimport { ExportFormat, PrepareDataFunc } from \"../../libs/import-export\";\n\n// actions\nexport const fetchInstructorsSuccess = actionFactory<RawInstructor[]>(\n    FETCH_INSTRUCTORS_SUCCESS\n);\nconst fetchOneInstructorSuccess = actionFactory<RawInstructor>(\n    FETCH_ONE_INSTRUCTOR_SUCCESS\n);\nconst upsertOneInstructorSuccess = actionFactory<RawInstructor>(\n    UPSERT_ONE_INSTRUCTOR_SUCCESS\n);\nconst deleteOneInstructorSuccess = actionFactory<RawInstructor>(\n    DELETE_ONE_INSTRUCTOR_SUCCESS\n);\n\n// dispatchers\nexport const fetchInstructors = validatedApiDispatcher({\n    name: \"fetchInstructors\",\n    description: \"Fetch instructors\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(`/${role}/instructors`)) as RawInstructor[];\n        dispatch(fetchInstructorsSuccess(data));\n        return data;\n    },\n});\n\nexport const fetchInstructor = validatedApiDispatcher({\n    name: \"fetchInstructor\",\n    description: \"Fetch instructor\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/instructors/${payload.id}`\n        )) as RawInstructor;\n        dispatch(fetchOneInstructorSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertInstructor = validatedApiDispatcher({\n    name: \"upsertInstructor\",\n    description: \"Add/insert instructor\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher:\n        (payload: Partial<Instructor>) => async (dispatch, getState) => {\n            const role = activeRoleSelector(getState());\n            const data = (await apiPOST(\n                `/${role}/instructors`,\n                payload\n            )) as RawInstructor;\n            dispatch(upsertOneInstructorSuccess(data));\n            return data;\n        },\n});\n\nexport const deleteInstructor = validatedApiDispatcher({\n    name: \"deleteInstructor\",\n    description: \"Delete instructor\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiPOST(\n            `/${role}/instructors/delete`,\n            payload\n        )) as RawInstructor;\n        dispatch(deleteOneInstructorSuccess(data));\n    },\n});\n\nexport const exportInstructors = validatedApiDispatcher({\n    name: \"exportInstructors\",\n    description: \"Export instructors\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher:\n        (\n            formatter: PrepareDataFunc<Instructor>,\n            format: ExportFormat = \"spreadsheet\"\n        ) =>\n        async (dispatch, getState) => {\n            if (!(formatter instanceof Function)) {\n                throw new Error(\n                    `\"formatter\" must be a function when using the export action.`\n                );\n            }\n            // Re-fetch all instructors from the server in case things happened to be out of sync.\n            await dispatch(fetchInstructors());\n            const instructors = instructorsSelector(getState());\n\n            return formatter(instructors, format);\n        },\n});\n\nexport const upsertInstructors = validatedApiDispatcher({\n    name: \"upsertInstructors\",\n    description: \"Upsert instructors\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (instructors: Partial<Instructor>[]) => async (dispatch) => {\n        if (instructors.length === 0) {\n            return;\n        }\n        const dispatchers = instructors.map((instructor) =>\n            dispatch(upsertInstructor(instructor))\n        );\n        await Promise.all(dispatchers);\n        // Re-fetch all instructors from the server in case things happened to be out of sync.\n        return await dispatch(fetchInstructors());\n    },\n});\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nconst localStoreSelector = instructorsReducer._localStoreSelector;\nexport const instructorsSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData as Instructor[]\n);\n","import {\n    FETCH_CONTRACT_TEMPLATES_SUCCESS,\n    UPSERT_ONE_CONTRACT_TEMPLATE_SUCCESS,\n    DELETE_ONE_CONTRACT_TEMPLATE_SUCCESS,\n    FETCH_ALL_CONTRACT_TEMPLATES_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    HasId,\n    isSameSession,\n    validatedApiDispatcher,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { contractTemplatesReducer } from \"../reducers/contract_templates\";\nimport { createSelector } from \"reselect\";\nimport { activeRoleSelector } from \"./users\";\nimport { bytesToBase64 } from \"../mockAPI/utils\";\nimport { activeSessionSelector } from \"./sessions\";\nimport {\n    ContractTemplate,\n    RawAttachment,\n    RawContractTemplate,\n} from \"../defs/types\";\n\n// actions\nexport const fetchContractTemplatesSuccess = actionFactory(\n    FETCH_CONTRACT_TEMPLATES_SUCCESS\n);\nconst fetchAllContractTemplatesSuccess = actionFactory(\n    FETCH_ALL_CONTRACT_TEMPLATES_SUCCESS\n);\nconst upsertOneContractTemplateSuccess = actionFactory(\n    UPSERT_ONE_CONTRACT_TEMPLATE_SUCCESS\n);\nconst deleteOneContractTemplateSuccess = actionFactory(\n    DELETE_ONE_CONTRACT_TEMPLATE_SUCCESS\n);\n\nconst MissingActiveSessionError = new Error(\n    \"Cannot interact with Contract Templates without an active session\"\n);\n// dispatchers\nexport const fetchContractTemplates = validatedApiDispatcher({\n    name: \"fetchContractTemplates\",\n    description: \"Fetch contract_templates\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw MissingActiveSessionError;\n        }\n        const { id: activeSessionId } = activeSession;\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/contract_templates`\n        )) as RawContractTemplate[];\n        // Between the time we started fetching and the time the data arrived, the active session may have\n        // changed. Make sure the correct active session is set before updating the data.\n        if (isSameSession(activeSessionId, getState)) {\n            dispatch(fetchContractTemplatesSuccess(data));\n        }\n        return data;\n    },\n});\n\nexport const upsertContractTemplate = validatedApiDispatcher({\n    name: \"upsertContractTemplate\",\n    description: \"Add/insert contract_template\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher:\n        (payload: Partial<ContractTemplate>) => async (dispatch, getState) => {\n            const role = activeRoleSelector(getState());\n            const activeSession = activeSessionSelector(getState());\n            if (activeSession == null) {\n                throw MissingActiveSessionError;\n            }\n            const { id: activeSessionId } = activeSession;\n            const data = (await apiPOST(\n                `/${role}/sessions/${activeSessionId}/contract_templates`,\n                payload\n            )) as RawContractTemplate;\n            dispatch(upsertOneContractTemplateSuccess(data));\n            return data;\n        },\n});\n\nexport const deleteContractTemplate = validatedApiDispatcher({\n    name: \"deleteContractTemplate\",\n    description: \"Delete contract_template from a session\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw MissingActiveSessionError;\n        }\n        const { id: activeSessionId } = activeSession;\n        const data = (await apiPOST(\n            `/${role}/sessions/${activeSessionId}/contract_templates/delete`,\n            payload\n        )) as RawContractTemplate;\n        dispatch(deleteOneContractTemplateSuccess(data));\n        return data;\n    },\n});\n\nexport const fetchAllContractTemplates = validatedApiDispatcher({\n    name: \"fetchAllContractTemplates\",\n    description: \"Fetch all available contract_templates\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/available_contract_templates`\n        )) as { template_file: string }[];\n        dispatch(fetchAllContractTemplatesSuccess(data));\n        return data;\n    },\n});\n\nexport const previewContractTemplate = validatedApiDispatcher({\n    name: \"previewContractTemplate\",\n    description:\n        \"Preview the html content of a contract template. No redux state is set by this call, but the contents of the template is returned.\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (template_id: number) => async (_dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/contract_templates/${template_id}/view`\n        )) as string;\n        return data;\n    },\n});\n\nexport const downloadContractTemplate = validatedApiDispatcher({\n    name: \"downloadContractTemplate\",\n    description:\n        \"Download the content of a contract template. No redux state is set by this call, but a `File` object with the contents of the template is returned.\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (template_id: number) => async (_dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/contract_templates/${template_id}/download`\n        )) as RawAttachment;\n        // The data comes in encoded as base64, so we decode it as binary data.\n        const content = new Uint8Array(\n            atob(data.content)\n                .split(\"\")\n                .map((x) => x.charCodeAt(0))\n        );\n        return new File([content], data.file_name, {\n            type: data.mime_type,\n        });\n    },\n});\n\nexport const uploadContractTemplate = validatedApiDispatcher({\n    name: \"uploadContractTemplate\",\n    description: \"Upload the `File` object as a contract template\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (file: File) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n\n        // We are expected to upload data in base64, so convert the file\n        // object to base64.\n        const file_name = file.name;\n        const rawContent = new Uint8Array(await file.arrayBuffer());\n        const content = bytesToBase64(rawContent);\n\n        const data = await apiPOST(`/${role}/contract_templates/upload`, {\n            file_name,\n            content,\n        });\n\n        dispatch(fetchAllContractTemplatesSuccess(data));\n        return data;\n    },\n});\n\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\nconst localStoreSelector = contractTemplatesReducer._localStoreSelector;\nexport const contractTemplatesSelector = createSelector(\n    localStoreSelector,\n    (state) => state._modelData as ContractTemplate[]\n);\nexport const allContractTemplatesSelector = createSelector(\n    localStoreSelector,\n    (state) => state.all\n);\n","/*\n * A collection of utility functions for interfacing with urls\n */\n\n/**\n * Try to parse `s` as a native javascript type. E.g., \"45.6\" will\n * be parsed as a number, \"true\" will be parsed as `true`, \"[]\"\n * will be parsed as an empty array.\n *\n * @param {string} s\n * @returns\n */\nfunction stringToNativeType(s: string) {\n    if (typeof s === \"string\" && s !== \"\" && !Number.isNaN(+s)) {\n        return +s;\n    }\n    try {\n        return JSON.parse(s);\n    } catch (e) {\n        return s;\n    }\n}\n\nfunction parseURLSearchString(s: string) {\n    const searchParams = new URLSearchParams(s);\n    const ret: Record<string, any> = {};\n    for (const [key, val] of searchParams.entries()) {\n        ret[key] = stringToNativeType(val);\n    }\n    return ret;\n}\n\nexport { stringToNativeType, parseURLSearchString };\n","import { API_INTERACTION_START, API_INTERACTION_END } from \"../constants\";\n\n// actions\nexport const apiInteractionStart = (id: string, message: string) => ({\n    type: API_INTERACTION_START,\n    payload: { id, message },\n});\nexport const apiInteractionEnd = (id: string) => ({\n    type: API_INTERACTION_END,\n    payload: { id },\n});\n","import {\n    FETCH_APPLICATIONS_SUCCESS,\n    FETCH_ONE_APPLICATION_SUCCESS,\n    UPSERT_ONE_APPLICATION_SUCCESS,\n    DELETE_ONE_APPLICATION_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    validatedApiDispatcher,\n    flattenIdFactory,\n    HasId,\n    isSameSession,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { fetchApplicants } from \"./applicants\";\nimport { activeRoleSelector } from \"./users\";\nimport type { Application, RawApplication } from \"../defs/types\";\nimport { activeSessionSelector } from \"./sessions\";\nimport { fetchPostings } from \"./postings\";\nimport { ExportFormat, PrepareDataFunc } from \"../../libs/import-export\";\nimport { applicationsSelector } from \"../selectors/application-smash\";\n\n// actions\nexport const fetchApplicationsSuccess = actionFactory<RawApplication[]>(\n    FETCH_APPLICATIONS_SUCCESS\n);\nconst fetchOneApplicationSuccess = actionFactory<RawApplication>(\n    FETCH_ONE_APPLICATION_SUCCESS\n);\nconst upsertOneApplicationSuccess = actionFactory<RawApplication>(\n    UPSERT_ONE_APPLICATION_SUCCESS\n);\nconst deleteOneApplicationSuccess = actionFactory<RawApplication>(\n    DELETE_ONE_APPLICATION_SUCCESS\n);\n\nconst applicantToApplicantId = flattenIdFactory<\"applicant\", \"applicant_id\">(\n    \"applicant\",\n    \"applicant_id\"\n);\n\nfunction prepApplicationForApi(data: Partial<Application>) {\n    return applicantToApplicantId(data as any);\n}\n\n// dispatchers\nexport const fetchApplications = validatedApiDispatcher({\n    name: \"fetchApplications\",\n    description: \"Fetch applications\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw new Error(\n                \"Cannot fetch Applications without an active session\"\n            );\n        }\n        const { id: activeSessionId } = activeSession;\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/applications`\n        )) as RawApplication[];\n        // Between the time we started fetching and the time the data arrived, the active session may have\n        // changed. Make sure the correct active session is set before updating the data.\n        if (isSameSession(activeSessionId, getState)) {\n            dispatch(fetchApplicationsSuccess(data));\n        }\n        return data;\n    },\n});\n\nexport const fetchApplication = validatedApiDispatcher({\n    name: \"fetchApplication\",\n    description: \"Fetch application\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw new Error(\n                \"Cannot fetch Applications without an active session\"\n            );\n        }\n        const { id: activeSessionId } = activeSession;\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/applications/${payload.id}`\n        )) as RawApplication;\n        dispatch(fetchOneApplicationSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertApplication = validatedApiDispatcher({\n    name: \"upsertApplication\",\n    description: \"Add/insert application\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher:\n        (payload: Partial<Application>) => async (dispatch, getState) => {\n            const role = activeRoleSelector(getState());\n            const activeSession = activeSessionSelector(getState());\n            if (activeSession == null) {\n                throw new Error(\n                    \"Cannot upsert Applications without an active session\"\n                );\n            }\n            const { id: activeSessionId } = activeSession;\n            const data = (await apiPOST(\n                `/${role}/sessions/${activeSessionId}/applications`,\n                prepApplicationForApi(payload)\n            )) as RawApplication;\n            dispatch(upsertOneApplicationSuccess(data));\n            return data;\n        },\n});\n\nexport const deleteApplication = validatedApiDispatcher({\n    name: \"deleteApplication\",\n    description: \"Delete application\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw new Error(\n                \"Cannot delete Applications without an active session\"\n            );\n        }\n        const { id: activeSessionId } = activeSession;\n        const data = (await apiPOST(\n            `/${role}/sessions/${activeSessionId}/applications/delete`,\n            prepApplicationForApi(payload)\n        )) as RawApplication;\n        dispatch(deleteOneApplicationSuccess(data));\n    },\n});\n\nexport const exportApplications = validatedApiDispatcher({\n    name: \"exportApplications\",\n    description: \"Export applications\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher:\n        (\n            formatter: PrepareDataFunc<Application>,\n            format: ExportFormat = \"spreadsheet\"\n        ) =>\n        async (dispatch, getState) => {\n            if (!(formatter instanceof Function)) {\n                throw new Error(\n                    `\"formatter\" must be a function when using the export action.`\n                );\n            }\n            // Re-fetch all applicants from the server in case things happened to be out of sync.\n            await Promise.all([\n                dispatch(fetchApplicants()),\n                dispatch(fetchPostings()),\n                dispatch(fetchApplications()),\n            ]);\n            const applications = applicationsSelector(getState());\n\n            return formatter(applications, format);\n        },\n});\n","import {\n    UPSERT_ONE_WAGE_CHUNK_SUCCESS,\n    DELETE_ONE_WAGE_CHUNK_SUCCESS,\n    FETCH_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS,\n    UPSERT_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport { actionFactory, HasId, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { createSelector } from \"reselect\";\nimport { assignmentsReducer } from \"../reducers/assignments\";\nimport { fetchAssignment } from \"./assignments\";\nimport { activeRoleSelector } from \"./users\";\nimport {\n    Assignment,\n    RawAssignment,\n    RawWageChunk,\n    WageChunk,\n} from \"../defs/types\";\n\n// actions\nconst fetchWageChunksForAssignmentSuccess = actionFactory<RawWageChunk[]>(\n    FETCH_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS\n);\nconst upsertWageChunksForAssignmentSuccess = actionFactory<RawWageChunk[]>(\n    UPSERT_WAGE_CHUNKS_FOR_ASSIGNMENT_SUCCESS\n);\nconst upsertOneWageChunkSuccess = actionFactory<RawWageChunk>(\n    UPSERT_ONE_WAGE_CHUNK_SUCCESS\n);\nconst deleteOneWageChunkSuccess = actionFactory<RawWageChunk>(\n    DELETE_ONE_WAGE_CHUNK_SUCCESS\n);\n\n// dispatchers\nexport const fetchWageChunksForAssignment = validatedApiDispatcher({\n    name: \"fetchWageChunksForAssignment\",\n    description: \"Fetch wage chunks associated with an assignment\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        // When we fetch wage chunks for an assignment, we only get the wage chunks for that particular assignment\n        const { id: assignmentId } = payload;\n        const data = (await apiGET(\n            `/${role}/assignments/${assignmentId}/wage_chunks`\n        )) as RawWageChunk[];\n        dispatch(fetchWageChunksForAssignmentSuccess(data));\n    },\n});\n\nexport const upsertWageChunksForAssignment = validatedApiDispatcher({\n    name: \"upsertWageChunksForAssignment\",\n    description: \"Fetch wage chunks associated with an assignment\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher:\n        (assignment: Assignment | RawAssignment, payload: WageChunk[]) =>\n        async (dispatch, getState) => {\n            const role = activeRoleSelector(getState());\n            // When we fetch wage chunks for an assignment, we only get the wage chunks for that particular assignment\n            const { id: assignmentId } = assignment;\n            const data = (await apiPOST(\n                `/${role}/assignments/${assignmentId}/wage_chunks`,\n                payload\n            )) as RawWageChunk[];\n            dispatch(upsertWageChunksForAssignmentSuccess(data));\n            // After we update a wage chunk, we should refetch the assignment to make sure\n            // there isn't stale data\n            await dispatch(fetchAssignment(assignment));\n        },\n});\n\nexport const upsertWageChunk = validatedApiDispatcher({\n    name: \"upsertWageChunk\",\n    description: \"Add/insert wage chunk\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher: (payload: WageChunk) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(`/${role}/wage_chunks`, payload);\n        dispatch(upsertOneWageChunkSuccess(data));\n    },\n});\n\nexport const deleteWageChunk = validatedApiDispatcher({\n    name: \"deleteWageChunk\",\n    description: \"Delete a wage chunk\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(`/${role}/wage_chunks/delete`, payload);\n        dispatch(deleteOneWageChunkSuccess(data));\n    },\n});\n\n// selectors\n\n// Each reducer is given an isolated state; instead of needed to remember to\n// pass the isolated state to each selector, `reducer._localStoreSelector` will intelligently\n// search for and return the isolated state associated with `reducer`. This is not\n// a standard redux function.\n\n// wage chunk data is stored with the assignments in the redux store\nconst localStoreSelector = assignmentsReducer._localStoreSelector;\nexport const wageChunksByAssignmentSelector = createSelector(\n    localStoreSelector,\n    (state) =>\n        function (assignment: Assignment | RawAssignment) {\n            const assignment_id = assignment.id;\n            if (!state._wageChunksByAssignmentId[assignment_id]) {\n                return [];\n            }\n            return state._wageChunksByAssignmentId[\n                assignment_id\n            ] as WageChunk[];\n        }\n);\n","import { validatedApiDispatcher } from \"./utils\";\nimport { apiError } from \"./errors\";\nimport { activeSessionSelector } from \"./sessions\";\nimport { initFromStage } from \"./init\";\nimport { RootState } from \"../../rootReducer\";\n\nexport const setGlobals = validatedApiDispatcher({\n    name: \"setGlobals\",\n    description: \"Sets global variables\",\n    onErrorDispatch: (e) => apiError(e.toString()),\n    dispatcher:\n        (payload: Record<string, any>) => async (dispatch, getState) => {\n            const globals = { ...globalsSelector(getState()), ...payload };\n\n            // Store the globals in the URL\n            await dispatch(setGlobalsInUrl(globals));\n\n            // Now store the globals in the Redux store\n            dispatch({ type: \"SET_GLOBALS\", payload: globals });\n        },\n});\n\n/**\n * Sets the specified values to be part of the URL\n */\nexport const setGlobalsInUrl = validatedApiDispatcher({\n    name: \"setGlobalsInUrl\",\n    description: \"Stores global variables in the URL\",\n    onErrorDispatch: (e) => apiError(e.toString()),\n    dispatcher: (payload: Record<string, any>) => async () => {\n        // Create a new URL with the globals set in it\n        const searchParams = new URLSearchParams();\n        for (const [key, val] of Object.entries(payload)) {\n            searchParams.append(key, JSON.stringify(val));\n        }\n\n        // If we have globals to store, push them onto the url\n        if (window.history.pushState && (\"\" + searchParams).length > 0) {\n            let newUrl = new URL(\"\" + window.location);\n            newUrl.search = \"?\" + searchParams;\n            let url = \"\" + newUrl;\n            if (\"\" + url !== \"\" + window.location) {\n                window.history.pushState({ path: url }, \"\", url);\n            }\n        }\n    },\n});\n\nexport const setMockAPIState = validatedApiDispatcher({\n    name: \"setMockAPIState\",\n    description: \"Activates or deactivates the mockAPI\",\n    onErrorDispatch: (e) => apiError(e.toString()),\n    dispatcher:\n        (\n            payload: boolean,\n            options: { skipInit?: boolean } = { skipInit: false }\n        ) =>\n        async (dispatch) => {\n            await dispatch(setGlobals({ mockAPI: payload }));\n\n            if (!options.skipInit) {\n                await dispatch(initFromStage(\"toggleMockAPI\"));\n            }\n        },\n});\n\nexport const globalsSelector = (state: RootState): Record<string, any> => {\n    // Peel off the `activeSession` if it is stored in globals.\n    // We want to always use the \"real\" active session and want\n    // to avoid multiple sources of truth.\n    // eslint-disable-next-line\n    const { activeSession, ...otherGlobals } = state.ui.globals;\n    const storedActiveSession = activeSessionSelector(state);\n    if (storedActiveSession != null && storedActiveSession.id != null) {\n        return { ...otherGlobals, activeSession: storedActiveSession.id };\n    }\n    return otherGlobals;\n};\n","// a collection of key-mapping between imported JSON keys/ Spreadsheet Column names and\n// actual keys of an object\n\nexport interface NormalizationSchema<T extends string[]> {\n    keys: T;\n    keyMap: Record<string, T[number]>;\n    requiredKeys: T[number][];\n    primaryKey: T[number] | T[number][];\n    dateColumns: T[number][];\n    baseName: string;\n}\n\nexport const instructorSchema: NormalizationSchema<\n    [\"first_name\", \"last_name\", \"utorid\", \"email\"]\n> = {\n    keys: [\"first_name\", \"last_name\", \"utorid\", \"email\"],\n    keyMap: {\n        \"First Name\": \"first_name\",\n        \"Given Name\": \"first_name\",\n        First: \"first_name\",\n        \"Last Name\": \"last_name\",\n        Surname: \"last_name\",\n        \"Family Name\": \"last_name\",\n        Last: \"last_name\",\n    },\n    requiredKeys: [\"utorid\"],\n    primaryKey: \"utorid\",\n    dateColumns: [],\n    baseName: \"instructors\",\n};\n\nexport const applicantSchema: NormalizationSchema<\n    [\"first_name\", \"last_name\", \"utorid\", \"email\", \"student_number\", \"phone\"]\n> = {\n    keys: [\n        \"first_name\",\n        \"last_name\",\n        \"utorid\",\n        \"email\",\n        \"student_number\",\n        \"phone\",\n    ],\n    keyMap: {\n        \"First Name\": \"first_name\",\n        \"Given Name\": \"first_name\",\n        First: \"first_name\",\n        \"Last Name\": \"last_name\",\n        Surname: \"last_name\",\n        \"Family Name\": \"last_name\",\n        Last: \"last_name\",\n        \"Student Number\": \"student_number\",\n    },\n    requiredKeys: [\"utorid\"],\n    primaryKey: \"utorid\",\n    dateColumns: [],\n    baseName: \"applicants\",\n};\n\nexport const postingSchema: NormalizationSchema<\n    [\n        \"name\",\n        \"open_date\",\n        \"close_date\",\n        \"intro_text\",\n        \"custom_questions\",\n        \"position_code\",\n        \"num_positions\",\n        \"hours\",\n        \"posting_positions\"\n    ]\n> = {\n    keys: [\n        \"name\",\n        \"open_date\",\n        \"close_date\",\n        \"intro_text\",\n        \"custom_questions\",\n        \"position_code\",\n        \"num_positions\",\n        \"hours\",\n        \"posting_positions\",\n    ],\n    keyMap: {\n        Name: \"name\",\n        \"Open Date\": \"open_date\",\n        \"Close Date\": \"close_date\",\n        \"Intro Text\": \"intro_text\",\n        \"Custom Questions\": \"custom_questions\",\n        \"Position Code\": \"position_code\",\n        \"Num Positions\": \"num_positions\",\n        \"Hours per Assignment\": \"hours\",\n        \"Hours per Position\": \"hours\",\n    },\n    requiredKeys: [],\n    primaryKey: \"name\",\n    dateColumns: [\"open_date\", \"close_date\"],\n    baseName: \"postings\",\n};\n\nexport const positionSchema: NormalizationSchema<\n    [\n        \"position_code\",\n        \"position_title\",\n        \"start_date\",\n        \"end_date\",\n        \"hours_per_assignment\",\n        \"desired_num_assignments\",\n        \"contract_template\",\n        \"instructors\",\n        \"duties\",\n        \"qualifications\",\n        \"current_enrollment\",\n        \"current_waitlisted\",\n        \"ad_open_date\",\n        \"ad_close_date\",\n        \"ad_hours_per_assignment\",\n        \"ad_num_assignments\"\n    ]\n> = {\n    keys: [\n        \"position_code\",\n        \"position_title\",\n        \"start_date\",\n        \"end_date\",\n        \"hours_per_assignment\",\n        \"desired_num_assignments\",\n        \"contract_template\",\n        \"instructors\",\n        \"duties\",\n        \"qualifications\",\n        \"current_enrollment\",\n        \"current_waitlisted\",\n        \"ad_open_date\",\n        \"ad_close_date\",\n        \"ad_hours_per_assignment\",\n        \"ad_num_assignments\",\n    ],\n    keyMap: {\n        \"Position Code\": \"position_code\",\n        \"Course Code\": \"position_code\",\n        \"Course Name\": \"position_code\",\n        \"Position Title\": \"position_title\",\n        \"Start Date\": \"start_date\",\n        Start: \"start_date\",\n        \"End Date\": \"end_date\",\n        End: \"end_date\",\n        \"Hours Per Assignment\": \"hours_per_assignment\",\n        \"Number of Assignments\": \"desired_num_assignments\",\n        \"Contract Template\": \"contract_template\",\n        \"Current Enrollment\": \"current_enrollment\",\n        \"Current Waitlist\": \"current_waitlisted\",\n    },\n    dateColumns: [\"start_date\", \"end_date\"],\n    requiredKeys: [\"position_code\", \"contract_template\"],\n    primaryKey: \"position_code\",\n    baseName: \"positions\",\n};\n\nexport const assignmentSchema: NormalizationSchema<\n    [\n        \"utorid\",\n        \"position_code\",\n        \"start_date\",\n        \"end_date\",\n        \"contract_template\",\n        \"contract_override_pdf\",\n        \"hours\",\n        \"wage_chunks\"\n    ]\n> = {\n    // We don't list \"active_offer_status\" because that cannot be imported. It has to be set\n    // via the TA or manually by the admin.\n    keys: [\n        \"utorid\",\n        \"position_code\",\n        \"start_date\",\n        \"end_date\",\n        \"contract_template\",\n        \"contract_override_pdf\",\n        \"hours\",\n        \"wage_chunks\",\n    ],\n    keyMap: {\n        \"Position Code\": \"position_code\",\n        \"Course Name\": \"position_code\",\n        \"Start Date\": \"start_date\",\n        Start: \"start_date\",\n        \"End Date\": \"end_date\",\n        End: \"end_date\",\n        Hours: \"hours\",\n        \"Contract Override PDF\": \"contract_override_pdf\",\n    },\n    dateColumns: [\"start_date\", \"end_date\"],\n    requiredKeys: [\"position_code\", \"utorid\"],\n    primaryKey: [\"utorid\", \"position_code\"],\n    baseName: \"assignments\",\n};\n","type NotNull<T> = T extends undefined | null ? never : T;\ntype NotNullField<T, K extends keyof T> = {\n    [Prop in keyof T]: Prop extends K ? NotNull<T[Prop]> : T[Prop];\n};\n\n/**\n * Removes any items where `item[attr] == null`.\n */\nexport function filterNull<T, K extends keyof T>(\n    data: T[],\n    attr: K\n): NotNullField<T, K>[] {\n    return data.filter((x) => x[attr] != null) as NotNullField<T, K>[];\n}\n\n/**\n * Removes any items where `item[attr] == null`.\n */\nexport function filterNullFields<T, K extends keyof T>(\n    data: T[],\n    attrs: K[]\n): NotNullField<T, K>[] {\n    return data.filter((x) =>\n        attrs.every((attr) => x[attr] != null)\n    ) as NotNullField<T, K>[];\n}\n\n/**\n * Removes any items where `item[attr] == null`.\n */\nexport function arrayToMapByAttr<T, K extends keyof T>(data: T[], key: K) {\n    const ret: Map<T[K], T> = new Map();\n    for (const item of data) {\n        ret.set(item[key], item);\n    }\n    return ret;\n}\n","import { createSelector } from \"reselect\";\nimport {\n    applicantsReducer,\n    applicationsReducer,\n    assignmentsReducer,\n    contractTemplatesReducer,\n    ddahsReducer,\n    instructorsReducer,\n    instructorPreferencesReducer,\n    positionsReducer,\n    postingsReducer,\n    sessionsReducer,\n} from \"../reducers\";\n\n/**\n * Given a selector that returns the local store, create a memoized selector\n * that returns the `_modelData` from the store.\n */\nfunction makeModelDataSelector<T>(\n    selector: (state: any, ...params: any[]) => { _modelData: T }\n) {\n    return createSelector(selector, (state) => state._modelData);\n}\n\n/**\n * When an API call is made, the raw data returned by the backend is stored. That data is recombined\n * in various ways by other selectors, as needed by the UI. These selectors directly access the raw data.\n *\n * In order to get at the raw data, we use the `_localStorSelector`, which is created whenever we create a\n * reducer. The `_localStoreSelector` intelligently searches for and returns the relevant portion of the\n * store. This is not a standard redux function.\n */\nexport const rawSelector = {\n    applicants: makeModelDataSelector(applicantsReducer._localStoreSelector),\n    applications: makeModelDataSelector(\n        applicationsReducer._localStoreSelector\n    ),\n    assignments: makeModelDataSelector(assignmentsReducer._localStoreSelector),\n    contractTemplates: makeModelDataSelector(\n        contractTemplatesReducer._localStoreSelector\n    ),\n    ddahs: makeModelDataSelector(ddahsReducer._localStoreSelector),\n    instructorPreferences: makeModelDataSelector(\n        instructorPreferencesReducer._localStoreSelector\n    ),\n    instructors: makeModelDataSelector(instructorsReducer._localStoreSelector),\n    positions: makeModelDataSelector(positionsReducer._localStoreSelector),\n    postings: makeModelDataSelector(postingsReducer._localStoreSelector),\n    session: makeModelDataSelector(sessionsReducer._localStoreSelector),\n};\n","import { createSelector } from \"reselect\";\nimport {\n    applicantsSelector,\n    positionsSelector,\n    postingsSelector,\n} from \"../actions\";\nimport type {\n    Applicant,\n    Application,\n    InstructorPreference,\n    Position,\n    Posting,\n    RawApplication,\n    RawInstructorPreference,\n} from \"../defs/types\";\nimport { arrayToMapByAttr, filterNull, filterNullFields } from \"./utils\";\nimport { rawSelector } from \"./raw-selectors\";\n\n/**\n * Link `Application`s with `Applicant`, `Posting`, and `Position` data.\n * The `InstructorPreferences` are not linked.\n *\n * @param {RawApplication[]} rawApplications\n * @param {Applicant[]} applicants\n * @param {Posting[]} postings\n * @param {Position[]} positions\n * @returns {Application[]}\n */\nfunction linkApplicationsWithData(\n    rawApplications: RawApplication[],\n    applicants: Applicant[],\n    postings: Posting[],\n    positions: Position[]\n): Application[] {\n    if (rawApplications.length === 0) {\n        return [];\n    }\n\n    const applicantsById = arrayToMapByAttr(applicants, \"id\");\n    const postingsById = arrayToMapByAttr(postings, \"id\");\n    const positionsById = arrayToMapByAttr(positions, \"id\");\n\n    // Change `applicant_id` to the corresponding `applicant` object\n    // and similarly, change each `position_id` in each entry of\n    // `position_preferences` to corresponding `position` object.\n    const ret = rawApplications.map(\n        ({\n            posting_id,\n            applicant_id,\n            position_preferences: rawPositionPreferences,\n            ...rest\n        }) => {\n            const position_preferences = filterNull(\n                rawPositionPreferences.map(\n                    ({ position_id, preference_level }) => ({\n                        position: positionsById.get(position_id),\n                        preference_level,\n                    })\n                ),\n                \"position\"\n            );\n\n            return {\n                ...rest,\n                applicant: applicantsById.get(applicant_id),\n                posting:\n                    posting_id == null\n                        ? null\n                        : postingsById.get(posting_id) || null,\n                position_preferences,\n                instructor_preferences: [],\n            };\n        }\n    );\n    return filterNull(ret, \"applicant\");\n}\n\nfunction smashApplicationsAndInstructorPreferences(\n    baseApplications: Application[],\n    rawInstructorPreferences: RawInstructorPreference[],\n    positions: Position[]\n): {\n    applications: Application[];\n    instructorPreferences: InstructorPreference[];\n} {\n    // Create a copy of each application so we can mutate the contents.\n    const applications = baseApplications.map((application) => ({\n        ...application,\n    }));\n    const positionsById = arrayToMapByAttr(positions, \"id\");\n    const applicationsById = arrayToMapByAttr(applications, \"id\");\n\n    // Create instructor preferences that reference the applications\n    const instructorPreferences: InstructorPreference[] = filterNullFields(\n        rawInstructorPreferences.map(\n            ({ position_id, application_id, ...rest }) => ({\n                ...rest,\n                position: positionsById.get(position_id),\n                application: applicationsById.get(application_id),\n            })\n        ),\n        [\"position\", \"application\"]\n    );\n\n    // Link the applications to the instructor preferences\n    for (const application of applications) {\n        application.instructor_preferences = instructorPreferences.filter(\n            (pref) => pref.application.id === application.id\n        );\n    }\n\n    return { applications, instructorPreferences };\n}\n\nconst applicationsAndInstructorPreferencesSelector = createSelector(\n    [\n        rawSelector.applications,\n        rawSelector.instructorPreferences,\n        // FIXME: There are circular dependencies in the imports which means that the\n        // imported selectors are initially `undefined`. When all imports finish, they become\n        // defined. Since these selectors aren't run until all imports have finished we're\n        // safe to call these function without checking if they're undefined. We wrap them\n        // in an anonymous function to keep reselect from complaining, but really\n        // the circular dependencies should be removed by splitting out the selectors into\n        // their own files.\n        (x: any) => positionsSelector(x),\n        (x: any) => applicantsSelector(x),\n        (x: any) => postingsSelector(x),\n    ],\n    (\n        rawApplications,\n        rawInstructorPreferences,\n        positions,\n        applicants,\n        postings\n    ) => {\n        const applications = linkApplicationsWithData(\n            rawApplications,\n            applicants,\n            postings,\n            positions\n        );\n        const ret = smashApplicationsAndInstructorPreferences(\n            applications,\n            rawInstructorPreferences,\n            positions\n        );\n        return ret;\n    }\n);\n\nexport const applicationsSelector = createSelector(\n    [applicationsAndInstructorPreferencesSelector],\n    (applicationsAndInstructorPreferences) =>\n        applicationsAndInstructorPreferences.applications\n);\n\nexport const instructorPreferencesSelector = createSelector(\n    [applicationsAndInstructorPreferencesSelector],\n    (applicationsAndInstructorPreferences) =>\n        applicationsAndInstructorPreferences.instructorPreferences\n);\n","import {\n    FETCH_INSTRUCTOR_PREFERENCES_SUCCESS,\n    FETCH_ONE_INSTRUCTOR_PREFERENCE_SUCCESS,\n    UPSERT_ONE_INSTRUCTOR_PREFERENCE_SUCCESS,\n    DELETE_ONE_INSTRUCTOR_PREFERENCE_SUCCESS,\n} from \"../constants\";\nimport { fetchError, upsertError, deleteError } from \"./errors\";\nimport {\n    actionFactory,\n    validatedApiDispatcher,\n    flattenIdFactory,\n    HasId,\n    isSameSession,\n} from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { activeRoleSelector } from \"./users\";\nimport type {\n    InstructorPreference,\n    RawInstructorPreference,\n} from \"../defs/types\";\nimport { activeSessionSelector } from \"./sessions\";\n\n// actions\nexport const fetchInstructorPreferencesSuccess = actionFactory<\n    RawInstructorPreference[]\n>(FETCH_INSTRUCTOR_PREFERENCES_SUCCESS);\nconst fetchOneInstructorPreferenceSuccess =\n    actionFactory<RawInstructorPreference>(\n        FETCH_ONE_INSTRUCTOR_PREFERENCE_SUCCESS\n    );\nconst upsertOneInstructorPreferenceSuccess =\n    actionFactory<RawInstructorPreference>(\n        UPSERT_ONE_INSTRUCTOR_PREFERENCE_SUCCESS\n    );\nconst deleteOneInstructorPreferenceSuccess =\n    actionFactory<RawInstructorPreference>(\n        DELETE_ONE_INSTRUCTOR_PREFERENCE_SUCCESS\n    );\n\nconst applicationToApplicationId = flattenIdFactory<\n    \"application\",\n    \"application_id\"\n>(\"application\", \"application_id\");\n\nconst positionToPositionId = flattenIdFactory<\"position\", \"position_id\">(\n    \"position\",\n    \"position_id\"\n);\n\nfunction prepInstructorPreferenceForApi(data: Partial<InstructorPreference>) {\n    return positionToPositionId(applicationToApplicationId(data as any));\n}\n\n// dispatchers\nexport const fetchInstructorPreferences = validatedApiDispatcher({\n    name: \"fetchInstructorPreferences\",\n    description: \"Fetch instructor_preferences\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: () => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw new Error(\n                \"Cannot fetch InstructorPreferences without an active session\"\n            );\n        }\n        const { id: activeSessionId } = activeSession;\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/instructor_preferences`\n        )) as RawInstructorPreference[];\n        // Between the time we started fetching and the time the data arrived, the active session may have\n        // changed. Make sure the correct active session is set before updating the data.\n        if (isSameSession(activeSessionId, getState)) {\n            dispatch(fetchInstructorPreferencesSuccess(data));\n        }\n        return data;\n    },\n});\n\nexport const fetchInstructorPreference = validatedApiDispatcher({\n    name: \"fetchInstructorPreference\",\n    description: \"Fetch instructor_preference\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const activeSession = activeSessionSelector(getState());\n        if (activeSession == null) {\n            throw new Error(\n                \"Cannot fetch InstructorPreferences without an active session\"\n            );\n        }\n        const { id: activeSessionId } = activeSession;\n        const data = (await apiGET(\n            `/${role}/sessions/${activeSessionId}/instructor_preferences/${payload.id}`\n        )) as RawInstructorPreference;\n        dispatch(fetchOneInstructorPreferenceSuccess(data));\n        return data;\n    },\n});\n\nexport const upsertInstructorPreference = validatedApiDispatcher({\n    name: \"upsertInstructorPreference\",\n    description: \"Add/insert instructor_preference\",\n    onErrorDispatch: (e) => upsertError(e.toString()),\n    dispatcher:\n        (payload: Partial<InstructorPreference>) =>\n        async (dispatch, getState) => {\n            const role = activeRoleSelector(getState());\n            const data = (await apiPOST(\n                `/${role}/instructor_preferences`,\n                prepInstructorPreferenceForApi(payload)\n            )) as RawInstructorPreference;\n            dispatch(upsertOneInstructorPreferenceSuccess(data));\n            return data;\n        },\n});\n\nexport const deleteInstructorPreference = validatedApiDispatcher({\n    name: \"deleteInstructorPreference\",\n    description: \"Delete instructor_preference\",\n    onErrorDispatch: (e) => deleteError(e.toString()),\n    dispatcher:\n        (payload: Pick<InstructorPreference, \"application\" | \"position\">) =>\n        async (dispatch, getState) => {\n            const role = activeRoleSelector(getState());\n            const data = (await apiPOST(\n                `/${role}/instructor_preferences/delete`,\n                prepInstructorPreferenceForApi(payload)\n            )) as RawInstructorPreference;\n            dispatch(deleteOneInstructorPreferenceSuccess(data));\n        },\n});\n","const contract_templates_by_filename = {\n    \"/math/default.html\": `<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <title>Offer Letter</title>\n        <style>\n            * {\n                box-sizing: border-box;\n            }\n            html {\n                margin: 0;\n                padding: 0;\n            }\n            body {\n                width: 8.5in;\n                margin: 0;\n                padding-left: 0.75in;\n                padding-right: 0.75in;\n                hyphens: auto;\n                text-align: justify;\n                box-sizing: border-box;\n                font-family: Helvetica, sans-serif;\n                font-size: 12pt;\n            }\n            .i {\n                font-style: italic;\n            }\n            .emphcolor {\n                color: red;\n            }\n            table.appointment-summary {\n                margin-left: 1in;\n                font-size: 0.9em;\n            }\n            .appointment-summary th {\n                padding-right: 0.5em;\n                text-align: right;\n                font-weight: normal;\n            }\n            .letter-head p {\n                margin-bottom: 0.5in;\n            }\n            .letter-foot {\n                margin-top: 1in;\n            }\n            .signature {\n                font-family: alex_brushregular, cursive;\n                font-size: 30pt;\n                margin-left: 0.5in;\n                margin-bottom: 0.1in;\n            }\n            .applicant .signature {\n                border-bottom: 1px solid black;\n                min-width: 2.5in;\n                display: inline-block;\n                margin-left: 0;\n            }\n            .checkbox {\n                font-size: 18pt;\n            }\n\n            @media only screen and (max-width: 9in) {\n                /* when printed, these styles won't show\n\t\t\t\tbecause the \"screen\" is 8.5in */\n                body {\n                    width: unset;\n                    padding-bottom: 0.5in;\n                    padding-left: 2em;\n                    padding-right: 2em;\n                }\n            }\n        </style>\n        <link rel=\"stylesheet\" href=\"font.css\" />\n        <link rel=\"stylesheet\" href=\"header.css\" />\n        <!-- for rendering with wkhtmltopdf styles need to be inlined; when rendered directly in a browser,\n\tthis will just be invalid CSS -->\n        <style>\n            {{ style_font }}\n        </style>\n        <style>\n            {{ style_header }}\n        </style>\n    </head>\n    <body>\n        <div class=\"letter-head\">\n            <div class=\"uoftlogo\"></div>\n            <p>{{ date }}</p>\n            <p>\n                {{ first_name }} {{ last_name }}<br />\n                c/o Some Department<br />\n                University of Toronto\n            </p>\n            <p>Dear {{ first_name }},</p>\n        </div>\n        <div class=\"letter-body\">\n            <p>\n                I am pleased to offer you an appointment as a Teaching Assistant\n                in Some Department. The starting date of your appointment will\n                be {{ start_date | date: \"%b %d, %Y\" }} and this appointment\n                will end on {{ end_date | date: \"%b %d, %Y\" }} with no further\n                notice to you.\n            </p>\n            <h3 class=\"i\">Appointment Summary</h3>\n            <table class=\"appointment-summary\">\n                <tr>\n                    <th>Appointment:</th>\n                    <td class=\"emphcolor\">\n                        {{ position_code }} {{ position_title }}\n                    </td>\n                </tr>\n                <tr>\n                    <th>Hours:</th>\n                    <td class=\"emphcolor\">{{ hours }}</td>\n                </tr>\n                <tr>\n                    <th>Start Date:</th>\n                    <td>{{ start_date | date: \"%b %d, %Y\" }}</td>\n                </tr>\n                <tr>\n                    <th>End Date:</th>\n                    <td>{{ end_date | date: \"%b %d, %Y\" }}</td>\n                </tr>\n                <tr>\n                    <th>Rate:</th>\n                    <td>{{ pay_period_desc }}</td>\n                </tr>\n            </table>\n\n            <p>\n                Your appointment will be for {{ hours }} hours for {{\n                position_code }}. Your Course Coordinator(s) {{\n                instructor_contact_desc }} will be in contact with you. You will\n                be paid {{ pay_period_desc }} for this position. You will be\n                paid in {{ installments }} instalments, once per month for the\n                period of your appointment. Your salary will be paid by direct\n                deposit.\n            </p>\n            Your payroll documentation will be available online through the\n            University’s Employee Self-Service (ESS) at\n            <a href=\"http://ess.hrandequity.utoronto.ca/\"\n                >ess.hrandequity.utoronto.ca/</a\n            >. This includes electronic delivery of your pay statement, tax\n            documentation, and other payroll documentation as made available\n            from time to time. You are able to print copies of these documents\n            directly from ESS.\n            <p>\n                By signing this Employment Agreement, you authorize the\n                University to provide your T4 slips electronically and not in a\n                paper format. If you wish to discuss an alternative format,\n                please contact Central Payroll Services at\n                payroll.hr@utoronto.ca.\n            </p>\n            <p>\n                This appointment is being granted on the basis that you are a\n                student or Post-Doctoral Fellow (PDF) at the University of\n                Toronto on the starting date of the appointment. If you are not\n                a student or PDF on the starting date of this appointment, this\n                offer is revoked and the University will have no obligations\n                under this letter.\n            </p>\n            <p>\n                As a Teaching Assistant, you will be a member of the Canadian\n                Union of Public Employees (CUPE) Local 3902, Unit 1 bargaining\n                unit. Your employment will be governed by the terms and\n                conditions of the collective agreement between the University of\n                Toronto and CUPE Local 3902, which may be found on the web at\n                <br />\n                <a\n                    href=\"http://agreements.hrandequity.utoronto.ca/#CUPE3902_Unit1\"\n                    >agreements.hrandequity.utoronto.ca/#CUPE3902_Unit1</a\n                >\n                <br />\n                Once you accept the offer of employment, a copy of the agreement\n                will be given to you if you do not already have one. A statement\n                about the Union, along with other information about the Union,\n                can be found on the Union's website (<a\n                    href=\"http://www.cupe3902.org/unit-1/\"\n                    >http://www.cupe3902.org/unit-1/</a\n                >). All of this information is that of the Union, represents the\n                views of the Union, and has not been approved or endorsed by the\n                University.\n            </p>\n            <h3>Required Training</h3>\n            <p>\n                You are required to take the following training:\n            </p>\n            <ul>\n                <li>\n                    U of T AODA Online Training, provided by the Accessibility\n                    for Ontarians with Disabilities Act (AODA) Office, available\n                    at\n                    <a href=\"http://aoda.hrandequity.utoronto.ca/\"\n                        >aoda.hrandequity.utoronto.ca/</a\n                    >\n                </li>\n            </ul>\n            <p>\n                If you are new to the University, or have not previously\n                completed the training, you will be notified by email when the\n                training module becomes available for your completion, normally\n                one month after the start date of this appointment. Completion\n                of this training will be automatically captured in the system\n                and you will be paid for this training in accordance with the\n                rates set out in your collective agreement. Please note that you\n                only need to complete the above training program once with the\n                University.\n            </p>\n            <h3>Policies & Procedures</h3>\n            <p>\n                You will also be subject to and bound by University policies of\n                general application and their related guidelines. The policies\n                are listed on the Governing Council website at\n                <a\n                    href=\"http://www.governingcouncil.utoronto.ca/Governing_Council/Policies.htm\"\n                    >www.governingcouncil.utoronto.ca/Governing_Council/Policies.htm</a\n                >\n                For convenience, a partial list of policies, those applicable to\n                all employees, and related guidelines can be found on the Human\n                Resources and Equity website at policies.hrandequity.utoronto.ca\n                Printed versions will be provided, upon request, through Human\n                Resources or your supervisor.\n            </p>\n            <p>\n                You should pay particular attention to those policies which\n                confirm the University’s commitment to, and your obligation to\n                support, a workplace that is free from discrimination and\n                harassment as set out in the Human Rights Code, is safe as set\n                out in the Occupational Health and Safety Act, and that respects\n                the University's commitment to equity and to workplace civility.\n            </p>\n            <p>\n                All of the applicable policies may be amended and/or new\n                policies may be introduced from time to time. When this happens,\n                if notice is required you will be given notice as the University\n                deems necessary and the amendments will become binding terms of\n                your employment contract with the University.\n            </p>\n            <h3>Accessibility</h3>\n            <p>\n                The University has a number of programs and services available\n                to employees who have need of accommodation due to disability\n                through its Health & Well-being Programs and Services (<a\n                    href=\"http://www.hrandequity.utoronto.ca/about-hr-equity/health.htm\"\n                    >www.hrandequity.utoronto.ca/about-hr-equity/health.htm</a\n                >). A description of the accommodation process is available in\n                the Accommodation for Employees with Disabilities: U of T\n                Guidelines, which may be found at:\n                <br />\n                <a\n                    href=\"http://well-being.hrandequity.utoronto.ca/services/#accommodation\"\n                    >well-being.hrandequity.utoronto.ca/services/#accommodation</a\n                >\n                <br />\n                In the event that you have a disability that would impact upon\n                how you would respond to an emergency in the workplace (e.g.,\n                situations requiring evacuation), you should contact Health &\n                Well-being Programs & Services at 416.978.2149 as soon as\n                possible so that you can be provided with information regarding\n                an individualized emergency response plan.\n            </p>\n            <p>\n                The law requires the Employment Standards Act Poster to be\n                provided to all employees; it is available on the HR & Equity\n                website at\n                <a\n                    href=\"http://www.hrandequity.utoronto.ca/news/employment-standards-ontario\"\n                    >www.hrandequity.utoronto.ca/news/employment-standards-ontario</a\n                >\n                This poster describes the minimum rights and obligations\n                contained in the Employment Standards Act. Please note that in\n                many respects this offer of employment exceeds the minimum\n                requirements set out in the Act.\n            </p>\n            <p>\n                Your duties may include all or any combination of the following:\n                grading, scheduled tutorials, office hours, Math Aid Centre\n                hours, and test and exam invigilation. You will be expected to\n                complete all grading for all student work that is completed\n                during the term of the appointment, up to and including final\n                exams.\n            </p>\n            <p>\n                Within 15 working days after the date of this letter, you will\n                be given the opportunity to review the Description of Duties and\n                Allocation of Hours (DDAH) form, which will set out more\n                specifically the duties of your position, and the hours assigned\n                to each.\n            </p>\n            <p>\n                Please sign below to indicate your acceptance of this offer, and\n                return a copy of this letter to me as soon as possible but no\n                later than 2 days after you have been provided with the DDAH\n                form. If we have not heard from you by this deadline, this offer\n                may be withdrawn. If you are unable to accept this offer, please\n                advise me immediately.\n            </p>\n            <p>\n                If you have any questions, please contact me via email at\n                <a href=\"mailto:tacoord@toronto.edu\">tacoord@toronto.edu</a>\n            </p>\n        </div>\n        <div class=\"letter-foot tacoordinator\">\n            <p>Yours sincerely,</p>\n            <div class=\"signature\">Tom Tomson</div>\n            <div class=\"details\">\n                Tom Tomson<br />TA Coordinator<br />Some Department\n            </div>\n        </div>\n        <div>\n            <p>\n                <span class=\"checkbox\"\n                    >{% if signature == blank %}☐{% else %}☑{% endif %}</span\n                >\n                I confirm that I will be registered as a University of Toronto\n                student or PDF on the date that this appointment begins. I\n                understand that if I should cease to be registered as a\n                University of Toronto student or PDF during the period of this\n                appointment, for any reason other than convocation, I must\n                immediately notify my supervisor, and my appointment may be\n                terminated.\n            </p>\n        </div>\n        <div class=\"letter-foot applicant\">\n            <p>Please sign below to accept this offer.</p>\n            <div class=\"signature\">{{ signature }}</div>\n            <div class=\"details\">\n                Applicant Signature\n            </div>\n        </div>\n    </body>\n</html>`,\n    \"/math/oto.html\": `<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset=\"utf-8\" />\n        <title>Offer Letter</title>\n        <style>\n            * {\n                box-sizing: border-box;\n            }\n            html {\n                margin: 0;\n                padding: 0;\n            }\n            body {\n                width: 8.5in;\n                margin: 0;\n                padding-left: 0.75in;\n                padding-right: 0.75in;\n                hyphens: auto;\n                text-align: justify;\n                box-sizing: border-box;\n                font-family: Helvetica, sans-serif;\n                font-size: 12pt;\n            }\n            .i {\n                font-style: italic;\n            }\n            .emphcolor {\n                color: red;\n            }\n            table.appointment-summary {\n                margin-left: 1in;\n                font-size: 0.9em;\n            }\n            .appointment-summary th {\n                padding-right: 0.5em;\n                text-align: right;\n                font-weight: normal;\n            }\n            .letter-head p {\n                margin-bottom: 0.5in;\n            }\n            .letter-foot {\n                margin-top: 1in;\n            }\n            .signature {\n                font-family: alex_brushregular, cursive;\n                font-size: 30pt;\n                margin-left: 0.5in;\n                margin-bottom: 0.1in;\n            }\n            .applicant .signature {\n                border-bottom: 1px solid black;\n                min-width: 2.5in;\n                display: inline-block;\n                margin-left: 0;\n            }\n            .checkbox {\n                font-size: 18pt;\n            }\n\n            @media only screen and (max-width: 9in) {\n                /* when printed, these styles won't show\n\t\t\t\tbecause the \"screen\" is 8.5in */\n                body {\n                    width: unset;\n                    padding-bottom: 0.5in;\n                    padding-left: 2em;\n                    padding-right: 2em;\n                }\n            }\n        </style>\n        <link rel=\"stylesheet\" href=\"font.css\" />\n        <link rel=\"stylesheet\" href=\"header.css\" />\n        <!-- for rendering with wkhtmltopdf styles need to be inlined; when rendered directly in a browser,\n\tthis will just be invalid CSS -->\n        <style>\n            {{ style_font }}\n        </style>\n        <style>\n            {{ style_header }}\n        </style>\n    </head>\n    <body>\n        <div class=\"letter-head\">\n            <div class=\"uoftlogo\"></div>\n            <p>{{ date }}</p>\n            <p>\n                {{ first_name }} {{ last_name }}<br />\n                c/o Some Department<br />\n                University of Toronto\n            </p>\n            <p>Dear {{ first_name }},</p>\n        </div>\n        <div class=\"letter-body\">\n            <p>\n                I am pleased to offer you an appointment as a Teaching Assistant\n                in Some Department. The starting date of your appointment will\n                be {{ start_date | date: \"%b %d, %Y\" }} and this appointment\n                will end on {{ end_date | date: \"%b %d, %Y\" }} with no further\n                notice to you.\n            </p>\n            <h3 class=\"i\">Appointment Summary</h3>\n            <table class=\"appointment-summary\">\n                <tr>\n                    <th>Appointment:</th>\n                    <td class=\"emphcolor\">\n                        {{ position_code }} {{ position_title }}\n                    </td>\n                </tr>\n                <tr>\n                    <th>Hours:</th>\n                    <td class=\"emphcolor\">{{ hours }}</td>\n                </tr>\n                <tr>\n                    <th>Start Date:</th>\n                    <td>{{ start_date | date: \"%b %d, %Y\" }}</td>\n                </tr>\n                <tr>\n                    <th>End Date:</th>\n                    <td>{{ end_date | date: \"%b %d, %Y\" }}</td>\n                </tr>\n                <tr>\n                    <th>Rate:</th>\n                    <td>{{ pay_period_desc }}</td>\n                </tr>\n            </table>\n\n            <p>\n                Your appointment will be for {{ hours }} hours for {{\n                position_code }}. This is a ONE TIME ONLY appointment. Your Course Coordinator(s) {{\n                instructor_contact_desc }} will be in contact with you. You will\n                be paid {{ pay_period_desc }} for this position. You will be\n                paid in one instalment. Your salary will be paid by direct\n                deposit.\n            </p>\n            Your payroll documentation will be available online through the\n            University’s Employee Self-Service (ESS) at\n            <a href=\"http://ess.hrandequity.utoronto.ca/\"\n                >ess.hrandequity.utoronto.ca/</a\n            >. This includes electronic delivery of your pay statement, tax\n            documentation, and other payroll documentation as made available\n            from time to time. You are able to print copies of these documents\n            directly from ESS.\n            <p>\n                By signing this Employment Agreement, you authorize the\n                University to provide your T4 slips electronically and not in a\n                paper format. If you wish to discuss an alternative format,\n                please contact Central Payroll Services at\n                payroll.hr@utoronto.ca.\n            </p>\n            <p>\n                This appointment is being granted on the basis that you are a\n                student or Post-Doctoral Fellow (PDF) at the University of\n                Toronto on the starting date of the appointment. If you are not\n                a student or PDF on the starting date of this appointment, this\n                offer is revoked and the University will have no obligations\n                under this letter.\n            </p>\n            <p>\n                As a Teaching Assistant, you will be a member of the Canadian\n                Union of Public Employees (CUPE) Local 3902, Unit 1 bargaining\n                unit. Your employment will be governed by the terms and\n                conditions of the collective agreement between the University of\n                Toronto and CUPE Local 3902, which may be found on the web at\n                <br />\n                <a\n                    href=\"http://agreements.hrandequity.utoronto.ca/#CUPE3902_Unit1\"\n                    >agreements.hrandequity.utoronto.ca/#CUPE3902_Unit1</a\n                >\n                <br />\n                Once you accept the offer of employment, a copy of the agreement\n                will be given to you if you do not already have one. A statement\n                about the Union, along with other information about the Union,\n                can be found on the Union's website (<a\n                    href=\"http://www.cupe3902.org/unit-1/\"\n                    >http://www.cupe3902.org/unit-1/</a\n                >). All of this information is that of the Union, represents the\n                views of the Union, and has not been approved or endorsed by the\n                University.\n            </p>\n            <h3>Required Training</h3>\n            <p>\n                You are required to take the following training:\n            </p>\n            <ul>\n                <li>\n                    U of T AODA Online Training, provided by the Accessibility\n                    for Ontarians with Disabilities Act (AODA) Office, available\n                    at\n                    <a href=\"http://aoda.hrandequity.utoronto.ca/\"\n                        >aoda.hrandequity.utoronto.ca/</a\n                    >\n                </li>\n            </ul>\n            <p>\n                If you are new to the University, or have not previously\n                completed the training, you will be notified by email when the\n                training module becomes available for your completion, normally\n                one month after the start date of this appointment. Completion\n                of this training will be automatically captured in the system\n                and you will be paid for this training in accordance with the\n                rates set out in your collective agreement. Please note that you\n                only need to complete the above training program once with the\n                University.\n            </p>\n            <h3>Policies & Procedures</h3>\n            <p>\n                You will also be subject to and bound by University policies of\n                general application and their related guidelines. The policies\n                are listed on the Governing Council website at\n                <a\n                    href=\"http://www.governingcouncil.utoronto.ca/Governing_Council/Policies.htm\"\n                    >www.governingcouncil.utoronto.ca/Governing_Council/Policies.htm</a\n                >\n                For convenience, a partial list of policies, those applicable to\n                all employees, and related guidelines can be found on the Human\n                Resources and Equity website at policies.hrandequity.utoronto.ca\n                Printed versions will be provided, upon request, through Human\n                Resources or your supervisor.\n            </p>\n            <p>\n                You should pay particular attention to those policies which\n                confirm the University’s commitment to, and your obligation to\n                support, a workplace that is free from discrimination and\n                harassment as set out in the Human Rights Code, is safe as set\n                out in the Occupational Health and Safety Act, and that respects\n                the University's commitment to equity and to workplace civility.\n            </p>\n            <p>\n                All of the applicable policies may be amended and/or new\n                policies may be introduced from time to time. When this happens,\n                if notice is required you will be given notice as the University\n                deems necessary and the amendments will become binding terms of\n                your employment contract with the University.\n            </p>\n            <h3>Accessibility</h3>\n            <p>\n                The University has a number of programs and services available\n                to employees who have need of accommodation due to disability\n                through its Health & Well-being Programs and Services (<a\n                    href=\"http://www.hrandequity.utoronto.ca/about-hr-equity/health.htm\"\n                    >www.hrandequity.utoronto.ca/about-hr-equity/health.htm</a\n                >). A description of the accommodation process is available in\n                the Accommodation for Employees with Disabilities: U of T\n                Guidelines, which may be found at:\n                <br />\n                <a\n                    href=\"http://well-being.hrandequity.utoronto.ca/services/#accommodation\"\n                    >well-being.hrandequity.utoronto.ca/services/#accommodation</a\n                >\n                <br />\n                In the event that you have a disability that would impact upon\n                how you would respond to an emergency in the workplace (e.g.,\n                situations requiring evacuation), you should contact Health &\n                Well-being Programs & Services at 416.978.2149 as soon as\n                possible so that you can be provided with information regarding\n                an individualized emergency response plan.\n            </p>\n            <p>\n                The law requires the Employment Standards Act Poster to be\n                provided to all employees; it is available on the HR & Equity\n                website at\n                <a\n                    href=\"http://www.hrandequity.utoronto.ca/news/employment-standards-ontario\"\n                    >www.hrandequity.utoronto.ca/news/employment-standards-ontario</a\n                >\n                This poster describes the minimum rights and obligations\n                contained in the Employment Standards Act. Please note that in\n                many respects this offer of employment exceeds the minimum\n                requirements set out in the Act.\n            </p>\n            <p>\n                Your duties may include all or any combination of the following:\n                grading, scheduled tutorials, office hours, Math Aid Centre\n                hours, and test and exam invigilation. You will be expected to\n                complete all grading for all student work that is completed\n                during the term of the appointment, up to and including final\n                exams.\n            </p>\n            <p>\n                Within 15 working days after the date of this letter, you will\n                be given the opportunity to review the Description of Duties and\n                Allocation of Hours (DDAH) form, which will set out more\n                specifically the duties of your position, and the hours assigned\n                to each.\n            </p>\n            <p>\n                Please sign below to indicate your acceptance of this offer, and\n                return a copy of this letter to me as soon as possible but no\n                later than 2 days after you have been provided with the DDAH\n                form. If we have not heard from you by this deadline, this offer\n                may be withdrawn. If you are unable to accept this offer, please\n                advise me immediately.\n            </p>\n            <p>\n                If you have any questions, please contact me via email at\n                <a href=\"mailto:tacoord@toronto.edu\">tacoord@toronto.edu</a>\n            </p>\n        </div>\n        <div class=\"letter-foot tacoordinator\">\n            <p>Yours sincerely,</p>\n            <div class=\"signature\">Tom Tomson</div>\n            <div class=\"details\">\n                Tom Tomson<br />TA Coordinator<br />Some Department\n            </div>\n        </div>\n        <div>\n            <p>\n                <span class=\"checkbox\"\n                    >{% if signature == blank %}☐{% else %}☑{% endif %}</span\n                >\n                I confirm that I will be registered as a University of Toronto\n                student or PDF on the date that this appointment begins. I\n                understand that if I should cease to be registered as a\n                University of Toronto student or PDF during the period of this\n                appointment, for any reason other than convocation, I must\n                immediately notify my supervisor, and my appointment may be\n                terminated.\n            </p>\n        </div>\n        <div class=\"letter-foot applicant\">\n            <p>Please sign below to accept this offer.</p>\n            <div class=\"signature\">{{ signature }}</div>\n            <div class=\"details\">\n                Applicant Signature\n            </div>\n        </div>\n    </body>\n</html>`,\n};\n// It's not important to store separate HTML templates for each of these\n// so just duplicate an existing template.\ncontract_templates_by_filename[\"/math/default2018.html\"] =\n    contract_templates_by_filename[\"/math/default.html\"];\ncontract_templates_by_filename[\"/math/invigilate.html\"] =\n    contract_templates_by_filename[\"/math/default.html\"];\ncontract_templates_by_filename[\"/math/invigilate2014.html\"] =\n    contract_templates_by_filename[\"/math/default.html\"];\n\nexport const mockData = {\n    sessions: [\n        {\n            id: 1,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            name: \"2019 Fall\",\n            rate1: 45.55,\n            rate2: 47.33,\n        },\n        {\n            id: 2,\n            start_date: \"2020-01-01T00:00:00.000Z\",\n            end_date: \"2020-04-30T00:00:00.000Z\",\n            name: \"2021 Spring\",\n            rate1: 45.55,\n            rate2: null,\n        },\n    ],\n    available_contract_templates: [\n        {\n            template_file: \"/math/default.html\",\n        },\n        {\n            template_file: \"/math/default2018.html\",\n        },\n        {\n            template_file: \"/math/invigilate.html\",\n        },\n        {\n            template_file: \"/math/invigilate2014.html\",\n        },\n        {\n            template_file: \"/math/oto.html\",\n        },\n    ],\n    contract_templates: [\n        {\n            id: 1,\n            template_name: \"standard\",\n            template_file: \"/math/default.html\",\n        },\n        {\n            id: 2,\n            template_name: \"oto\",\n            template_file: \"/math/oto.html\",\n        },\n        {\n            id: 3,\n            template_name: \"standard\",\n            template_file: \"/math/default2018.html\",\n        },\n        {\n            id: 4,\n            template_name: \"invigilate\",\n            template_file: \"/math/invigilate.html\",\n        },\n    ],\n    contract_templates_by_session: {\n        1: [1, 2],\n        2: [3, 4],\n    },\n    contract_templates_by_filename: contract_templates_by_filename,\n    instructors: [\n        {\n            id: 1000,\n            last_name: \"Smith\",\n            first_name: \"Henry\",\n            email: \"hery.smith@utoronto.ca\",\n            utorid: \"smithh\",\n        },\n        {\n            id: 1001,\n            last_name: \"Garcia\",\n            first_name: \"Emily\",\n            email: \"emily.garcia@utoronto.ca\",\n            utorid: \"garciae\",\n        },\n        {\n            id: 1002,\n            last_name: \"Miller\",\n            first_name: \"Megan\",\n            email: \"megan.miller@utoronto.ca\",\n            utorid: \"millerm\",\n        },\n        {\n            id: 1003,\n            last_name: \"Beera\",\n            first_name: \"Lizzy\",\n            email: \"lizzy.beera@utoronto.ca\",\n            utorid: \"beeral\",\n        },\n    ],\n    positions_by_session: {\n        1: [10, 11, 14, 15, 16],\n        2: [12, 13],\n    },\n    positions: [\n        {\n            id: 10,\n            position_code: \"MAT135H1F\",\n            position_title: \"Calculus I\",\n            hours_per_assignment: 70,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            contract_template_id: 1,\n            duties: \"Tutorials\",\n            qualifications: \"Teaching skill\",\n            desired_num_assignments: 15,\n            current_enrollment: 1200,\n            current_waitlisted: 200,\n            instructor_ids: [1000, 1001],\n            instructor_preferences: [\n                {\n                    preference_level: 2,\n                    applicant_id: 2000,\n                    instructor_id: 1000,\n                },\n                {\n                    preference_level: 1,\n                    applicant_id: 2002,\n                    instructor_id: 1000,\n                },\n                {\n                    preference_level: -1,\n                    applicant_id: 2005,\n                    instructor_id: 1001,\n                },\n                {\n                    preference_level: 1,\n                    applicant_id: 2002,\n                    instructor_id: 1001,\n                },\n                {\n                    preference_level: 1,\n                    applicant_id: 2006,\n                    instructor_id: 1001,\n                },\n            ],\n        },\n        {\n            id: 11,\n            position_code: \"MAT136H1F\",\n            position_title: \"Calculus II\",\n            hours_per_assignment: 70,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            contract_template_id: 2,\n            instructor_ids: [],\n        },\n        {\n            id: 12,\n            position_code: \"CSC135H1F\",\n            position_title: \"Computer Fun\",\n            hours_per_assignment: 70,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            duties: \"Tutorials\",\n            contract_template_id: 3,\n            instructor_ids: [1000],\n            instructor_preferences: [\n                {\n                    preference_level: -1,\n                    applicant_id: 2005,\n                    instructor_id: 1000,\n                },\n                {\n                    preference_level: 2,\n                    applicant_id: 2001,\n                    instructor_id: 1000,\n                },\n                {\n                    preference_level: 1,\n                    applicant_id: 2006,\n                    instructor_id: 1000,\n                },\n            ],\n        },\n        {\n            id: 13,\n            position_code: \"MAT235H1F\",\n            position_title: \"Calculus III\",\n            hours_per_assignment: 70,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            contract_template_id: 3,\n            instructor_ids: [1002],\n            instructor_preferences: [\n                {\n                    preference_level: 2,\n                    applicant_id: 2000,\n                    instructor_id: 1002,\n                },\n                {\n                    preference_level: 1,\n                    applicant_id: 2002,\n                    instructor_id: 1002,\n                },\n            ],\n        },\n        {\n            instructor_ids: [1002],\n            position_code: \"CSC100H1S\",\n            position_title: \"Computers for Humans\",\n            hours_per_assignment: 100,\n            duties: \"Some combination of marking, invigilating, tutorials, office hours, and the help centre.\",\n            contract_template_id: 1,\n            start_date: \"2021-01-01T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 14,\n        },\n        {\n            instructor_ids: [1000],\n            position_code: \"MAT137Y1Y\",\n            position_title: \"Calculus!\",\n            hours_per_assignment: 250,\n            duties: \"Some combination of marking, invigilating, tutorials, office hours, and the help centre.\",\n            contract_template_id: 1,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            qualifications: \"Skilled Proofs Reader\",\n            current_enrollment: 1500,\n            current_waitlisted: 78,\n            desired_num_assignments: 22,\n            id: 15,\n        },\n        {\n            instructor_ids: [1001],\n            position_code: \"MAT135H1F Head TA\",\n            position_title: \"Calculus I\",\n            hours_per_assignment: 225,\n            duties: \"Top-notch Head TA Stuff\",\n            contract_template_id: 1,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            desired_num_assignments: 3,\n            id: 16,\n        },\n    ],\n    applicants: [\n        {\n            id: 2000,\n            utorid: \"weasleyr\",\n            student_number: \"89013443\",\n            first_name: \"Ron\",\n            last_name: \"Weasley\",\n            email: \"ron@potter.com\",\n            phone: \"543-223-9993\",\n        },\n        {\n            id: 2001,\n            utorid: \"potterh\",\n            student_number: \"999666999\",\n            first_name: \"Harry\",\n            last_name: \"Potter\",\n            email: \"harry@potter.com\",\n        },\n        {\n            id: 2002,\n            utorid: \"smithb\",\n            email: \"smithb@mail.utoronto.ca\",\n            first_name: \"Bethany\",\n            last_name: \"Smith\",\n            student_number: \"131382748\",\n        },\n        {\n            id: 2003,\n            utorid: \"wilsonh\",\n            email: \"wilsonh@mail.utoronto.ca\",\n            first_name: \"Hanna\",\n            last_name: \"Wilson\",\n            student_number: \"600366904\",\n        },\n        {\n            id: 2004,\n            utorid: \"molinat\",\n            email: \"molinat@mail.utoronto.ca\",\n            first_name: \"Troy\",\n            last_name: \"Molina\",\n            student_number: \"328333023\",\n        },\n        {\n            id: 2005,\n            utorid: \"howeyb\",\n            email: \"howeyb@mail.utoronto.ca\",\n            first_name: \"Brett\",\n            last_name: \"Howey\",\n            student_number: \"329613524\",\n        },\n        {\n            id: 2006,\n            utorid: \"brownd\",\n            email: \"brownd@mail.utoronto.ca\",\n            first_name: \"David\",\n            last_name: \"Brown\",\n            student_number: \"29151485\",\n        },\n    ],\n    assignments_by_session: {\n        1: [100, 101, 102, 103, 104, 105, 106, 107, 108, 109],\n        2: [],\n    },\n    assignments: [\n        {\n            id: 100,\n            position_id: 10,\n            applicant_id: 2001,\n            hours: 90,\n        },\n        {\n            id: 101,\n            position_id: 10,\n            applicant_id: 2005,\n            hours: 95,\n        },\n        {\n            note: \"\",\n            position_id: 16,\n            applicant_id: 2000,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            id: 102,\n        },\n        {\n            note: \"\",\n            position_id: 16,\n            applicant_id: 2002,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            id: 103,\n        },\n        {\n            note: \"\",\n            position_id: 15,\n            applicant_id: 2001,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 104,\n        },\n        {\n            note: \"\",\n            position_id: 15,\n            applicant_id: 2002,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 105,\n        },\n        {\n            note: \"\",\n            position_id: 15,\n            applicant_id: 2005,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 106,\n        },\n        {\n            note: \"\",\n            position_id: 15,\n            applicant_id: 2000,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 107,\n        },\n        {\n            note: \"\",\n            position_id: 15,\n            applicant_id: 2006,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 108,\n        },\n        {\n            note: \"\",\n            position_id: 14,\n            applicant_id: 2002,\n            start_date: \"2021-01-01T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n            id: 109,\n        },\n    ],\n    wage_chunks: [\n        {\n            id: 3000,\n            assignment_id: 100,\n            hours: 20,\n            start_date: \"2019-09-08T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n            rate: 10.01,\n        },\n        {\n            id: 3001,\n            assignment_id: 100,\n            hours: 35,\n            start_date: \"2020-01-01T00:00:00.000Z\",\n            end_date: \"2020-04-20T00:00:00.000Z\",\n            rate: 12.02,\n        },\n        {\n            id: 3002,\n            assignment_id: 101,\n            hours: 95,\n            start_date: \"2019-09-01T00:00:00.000Z\",\n            end_date: \"2020-04-20T00:00:00.000Z\",\n            rate: null,\n        },\n        {\n            id: 3003,\n            assignment_id: 102,\n            hours: 225,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n        },\n        {\n            id: 3004,\n            assignment_id: 103,\n            hours: 225,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T00:00:00.000Z\",\n        },\n        {\n            id: 3005,\n            assignment_id: 104,\n            hours: 125,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T05:00:00.000Z\",\n        },\n        {\n            id: 3006,\n            assignment_id: 104,\n            hours: 125,\n            start_date: \"2020-01-01T05:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n        {\n            id: 3007,\n            assignment_id: 105,\n            hours: 125,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T05:00:00.000Z\",\n        },\n        {\n            id: 3008,\n            assignment_id: 105,\n            hours: 125,\n            start_date: \"2020-01-01T05:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n        {\n            id: 3009,\n            assignment_id: 106,\n            hours: 125,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T05:00:00.000Z\",\n        },\n        {\n            id: 3010,\n            assignment_id: 106,\n            hours: 125,\n            start_date: \"2020-01-01T05:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n        {\n            id: 3011,\n            assignment_id: 107,\n            hours: 100,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T05:00:00.000Z\",\n        },\n        {\n            id: 3012,\n            assignment_id: 107,\n            hours: 100,\n            start_date: \"2020-01-01T05:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n        {\n            id: 3013,\n            assignment_id: 108,\n            hours: 100,\n            start_date: \"2019-09-02T00:00:00.000Z\",\n            end_date: \"2019-12-31T05:00:00.000Z\",\n        },\n        {\n            id: 3014,\n            assignment_id: 108,\n            hours: 100,\n            start_date: \"2020-01-01T05:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n        {\n            id: 3015,\n            assignment_id: 109,\n            hours: 100,\n            start_date: \"2021-01-01T00:00:00.000Z\",\n            end_date: \"2020-04-03T00:00:00.000Z\",\n        },\n    ],\n    offers: [\n        {\n            id: 10000,\n            assignment_id: 100,\n            status: \"withdrawn\",\n        },\n        {\n            id: 10001,\n            assignment_id: 100,\n            status: \"pending\",\n        },\n        {\n            id: 10002,\n            assignment_id: 101,\n            status: \"accepted\",\n        },\n        {\n            id: 10003,\n            assignment_id: 102,\n            status: \"withdrawn\",\n        },\n    ],\n    applications: [\n        {\n            id: 15000,\n            comments: \"\",\n            program: \"Phd\",\n            department: \"Computer Science\",\n            previous_experience_summary: \"Last year I TAed a bunch\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 1,\n            applicant_id: 2000,\n            position_preferences: [\n                {\n                    preference_level: 2,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 15,\n                },\n            ],\n        },\n        {\n            id: 15001,\n            comments: \"\",\n            program: \"UG\",\n            department: \"Computer Science\",\n            previous_experience_summary: \"\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 1,\n            applicant_id: 2001,\n            position_preferences: [\n                {\n                    preference_level: 0,\n                    position_id: 12,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n            ],\n        },\n        {\n            id: 15002,\n            comments: \"\",\n            program: \"Phd\",\n            department: \"Math\",\n            previous_experience_summary: \"\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 1,\n            applicant_id: 2002,\n            position_preferences: [\n                {\n                    preference_level: 3,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n                {\n                    preference_level: 2,\n                    position_id: 12,\n                },\n                {\n                    preference_level: 0,\n                    position_id: 11,\n                },\n            ],\n        },\n        {\n            id: 15003,\n            comments: \"\",\n            program: \"Phd\",\n            department: \"Computer Science\",\n            previous_experience_summary: \"\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 1,\n            applicant_id: 2005,\n            position_preferences: [\n                {\n                    preference_level: 2,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n                {\n                    preference_level: 0,\n                    position_id: 12,\n                },\n                {\n                    preference_level: 1,\n                    position_id: 11,\n                },\n            ],\n        },\n        {\n            id: 15004,\n            comments: \"\",\n            program: \"UG\",\n            department: \"Computer Science\",\n            previous_experience_summary: \"\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 1,\n            applicant_id: 2006,\n            position_preferences: [\n                {\n                    preference_level: 3,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 0,\n                    position_id: 13,\n                },\n                {\n                    preference_level: 2,\n                    position_id: 12,\n                },\n            ],\n        },\n        {\n            id: 15005,\n            comments: \"\",\n            program: \"UG\",\n            department: \"Math\",\n            previous_experience_summary: \"\",\n            yip: 3,\n            annotation: \"\",\n            session_id: 2,\n            applicant_id: 2002,\n            position_preferences: [\n                {\n                    preference_level: 3,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n                {\n                    preference_level: 2,\n                    position_id: 12,\n                },\n                {\n                    preference_level: 0,\n                    position_id: 11,\n                },\n            ],\n        },\n        {\n            id: 15006,\n            comments: \"\",\n            program: \"MSc\",\n            department: \"Computer Science\",\n            previous_experience_summary: \"\",\n            yip: 2,\n            annotation: \"\",\n            session_id: 2,\n            applicant_id: 2003,\n            position_preferences: [\n                {\n                    preference_level: 3,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n                {\n                    preference_level: 2,\n                    position_id: 12,\n                },\n                {\n                    preference_level: 0,\n                    position_id: 11,\n                },\n            ],\n        },\n        {\n            id: 15007,\n            comments: \"\",\n            program: \"UG\",\n            department: \"Computer Science\",\n            previous_experience_summary: \"\",\n            yip: 4,\n            annotation: \"\",\n            session_id: 2,\n            applicant_id: 2004,\n            position_preferences: [\n                {\n                    preference_level: 1,\n                    position_id: 10,\n                },\n                {\n                    preference_level: 3,\n                    position_id: 13,\n                },\n            ],\n        },\n    ],\n    ddahs: [\n        {\n            id: 700,\n            assignment_id: 100,\n            signature: null,\n            approved_date: null,\n            accepted_date: null,\n            revised_date: null,\n            emailed_date: null,\n            url_token: \"DJAKSLJLFD\",\n            duties: [\n                {\n                    order: 2,\n                    hours: 25,\n                    description: \"marking:Marking the midterm\",\n                },\n                {\n                    order: 1,\n                    hours: 4,\n                    description: \"training:Initial training\",\n                },\n                {\n                    order: 3,\n                    hours: 40,\n                    description: \"contact:Running tutorials\",\n                },\n            ],\n        },\n        {\n            id: 701,\n            assignment_id: 101,\n            signature: \"Brett Howey\",\n            approved_date: null,\n            accepted_date: \"2019-09-02T00:00:00.000Z\",\n            revised_date: null,\n            emailed_date: \"2019-09-02T00:00:00.000Z\",\n            url_token: \"somerandomtoken\",\n            duties: [\n                {\n                    order: 2,\n                    hours: 50,\n                    description: \"marking:Marking the midterm\",\n                },\n                {\n                    order: 1,\n                    hours: 6,\n                    description: \"training:Initial training\",\n                },\n            ],\n        },\n    ],\n    users: [\n        {\n            email: \"hery.smith@utoronto.ca\",\n            utorid: \"smithh\",\n            roles: [\"admin\", \"instructor\"],\n        },\n        {\n            email: \"emily.garcia@utoronto.ca\",\n            utorid: \"garciae\",\n            roles: [\"instructor\"],\n        },\n        {\n            email: \"megan.miller@utoronto.ca\",\n            utorid: \"millerm\",\n            roles: [\"instructor\"],\n        },\n        {\n            email: \"lizzy.beera@utoronto.ca\",\n            utorid: \"beeral\",\n            roles: [\"instructor\"],\n        },\n    ],\n    active_user: \"smithh\",\n};\n","import {\n    getAttributesCheckMessage,\n    MockAPIController,\n    errorUnlessRole,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n    RouteParams,\n} from \"../defs/doc-generation\";\nimport { Session as SessionType } from \"../defs/types\";\n\nexport class Session extends MockAPIController {\n    constructor(data: any) {\n        super(data, data.sessions);\n    }\n    create(session: Partial<SessionType>): SessionType {\n        const newSession = super.create(session) as SessionType;\n        // If we insert a new session, we need to make sure we create\n        // a corresponding assignments_by_session array\n        this.data.assignments_by_session[newSession.id] = [];\n        return newSession;\n    }\n    findAll(...args: any[]): SessionType[] {\n        return super.findAll(...args) as SessionType[];\n    }\n    validateNew(session: Partial<SessionType>) {\n        // if we're here, we need to create a new session\n        // but check if the session name is empty or duplicate\n        const message = getAttributesCheckMessage(session, this.ownData, {\n            name: { required: true, unique: true },\n        } as any);\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    validateProp(prop: keyof SessionType, value: any, id: number) {\n        if (prop === \"name\") {\n            // check if `name` is empty\n            if (value === undefined || value.length === 0) {\n                throw new Error(\n                    `Property ${prop} cannot be empty or undefined.`\n                );\n            }\n            // if `name` is not empty, make sure it is unique after the update\n            // by filtering out the request session\n            const filteredData = this.findAll().filter(\n                (item) => item.id !== id\n            );\n            // and make sure `name` is unique to the rest\n            const message = getAttributesCheckMessage(\n                { name: value },\n                filteredData,\n                {\n                    name: { unique: true },\n                } as any\n            );\n            if (message) {\n                throw new Error(message);\n            }\n        }\n\n        return true;\n    }\n}\n\nexport const sessionsRoutes = {\n    get: {\n        \"/sessions\": documentCallback({\n            func: (data: any) => new Session(data).findAll(),\n            summary: \"Get all available sessions\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.session),\n        }),\n        \"/sessions/:session_id/instructor_preferences\": documentCallback({\n            func: () => {\n                throw new Error(\"not implemented\");\n            },\n            summary:\n                \"Get all instructor preferences associated with the session\",\n            returns: wrappedPropTypes.arrayOf(\n                docApiPropTypes.instructor_preference\n            ),\n        }),\n    },\n    post: {\n        \"/sessions\": documentCallback({\n            func: (\n                data: any,\n                params: RouteParams,\n                body: Partial<SessionType>\n            ) => {\n                errorUnlessRole(params, \"admin\");\n                // body should be a session object. If it contains an id,\n                // update an existing session. Otherwise, create a new one.\n                return new Session(data).upsert(body);\n            },\n            summary: \"Upsert a session\",\n            returns: docApiPropTypes.session,\n            posts: docApiPropTypes.session,\n        }),\n        \"/sessions/delete\": documentCallback({\n            func: (\n                data: any,\n                params: RouteParams,\n                body: Partial<SessionType>\n            ) => {\n                errorUnlessRole(params, \"admin\");\n                return new Session(data).delete(body as any);\n            },\n            summary: \"Delete a session\",\n            posts: docApiPropTypes.idOnly,\n            returns: docApiPropTypes.session,\n        }),\n    },\n};\n","import {\n    getAttributesCheckMessage,\n    findAllById,\n    MockAPIController,\n    bytesToBase64,\n    errorUnlessRole,\n    base64decode,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { Session } from \"./sessions\";\n\nexport class ContractTemplate extends MockAPIController {\n    constructor(data) {\n        super(data);\n        this.ownData = this.data.contract_templates;\n    }\n    validateNew(template, session = null) {\n        // The name and file are required\n        const message = getAttributesCheckMessage(template, this.ownData, {\n            template_name: { required: true },\n            template_file: { required: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n        // If we're inserting to a session, the name must be unique\n        if (session) {\n            const message = getAttributesCheckMessage(\n                template,\n                this.findAllBySession(session),\n                {\n                    template_name: { required: true, unique: true },\n                }\n            );\n            if (message) {\n                throw new Error(message);\n            }\n        }\n    }\n    upload({ file_contents, file_name }) {\n        if (file_name in this.data.contract_templates_by_filename) {\n            throw new Error(\n                `Template with filename '${file_name}' already exists.`\n            );\n        }\n        this.data.contract_templates_by_filename[file_name] = file_contents;\n        this.data.available_contract_templates.push({\n            template_file: file_name,\n        });\n    }\n    getTemplateHtml(template) {\n        template = new ContractTemplate(this.data).find(template);\n        if (\n            !(\n                template.template_file in\n                this.data.contract_templates_by_filename\n            )\n        ) {\n            throw new Error(\n                `Could not find Html for template ${template.template_file}`\n            );\n        }\n        return this.data.contract_templates_by_filename[template.template_file];\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).find(session);\n        return findAllById(\n            this.data.contract_templates_by_session[matchingSession.id] || [],\n            this.ownData\n        );\n    }\n    upsertBySession(obj, session) {\n        const matchingSession = new Session(this.data).find(session);\n        // If this is not an upsert, validate the parameters. Otherwise, don't validate.\n        if (!this.find(obj)) {\n            this.validateNew(obj, matchingSession);\n        }\n        const newTemplate = this.upsert(obj);\n        // Make sure there is an array for to store the contract_templates by session,\n        // and the push to this array before returning the new object\n        this.data.contract_templates_by_session[matchingSession.id] =\n            this.data.contract_templates_by_session[matchingSession.id] || [];\n        this.data.contract_templates_by_session[matchingSession.id].push(\n            newTemplate.id\n        );\n        return newTemplate;\n    }\n}\n\nexport const templatesRoutes = {\n    get: {\n        \"/available_contract_templates\": documentCallback({\n            func: (data) => [...data.available_contract_templates],\n            summary:\n                \"Get all available contract templates (these are literal files on the server).\",\n            returns: wrappedPropTypes.arrayOf(\n                docApiPropTypes.contractTemplateMinimal\n            ),\n        }),\n        \"/sessions/:session_id/contract_templates\": documentCallback({\n            func: (data, params) =>\n                new ContractTemplate(data).findAllBySession(params.session_id),\n            summary: \"Get contract templates associated with this session.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.contractTemplate),\n        }),\n        \"/contract_templates/:template_id/view\": documentCallback({\n            func: (data, params) =>\n                new ContractTemplate(data).getTemplateHtml(params.template_id),\n            summary:\n                \"Get a preview of the contact template (i.e., the actual HTML).\",\n            returns: wrappedPropTypes.string,\n        }),\n        \"/contract_templates/:template_id/download\": documentCallback({\n            func: (data, params) => {\n                const { template_id } = params;\n                const template = new ContractTemplate(data);\n                const templateContent = template.getTemplateHtml(template_id);\n\n                // We're directly sending binary data, so we need to encode the template\n                // as UTF-8 (rather than native Javascript UTF-16)\n                const encodedContent = new TextEncoder().encode(\n                    templateContent\n                );\n                return {\n                    file_name: template.find(template_id).template_file,\n                    mime_type: \"text/html\",\n                    content: bytesToBase64(encodedContent),\n                };\n            },\n            summary:\n                \"Download the raw HTML template associated with the contract-template. No substitutions are made to this file. The `content` filed is encoded in Base64 and may be a binary file (e.g., a zip file).\",\n            returns: wrappedPropTypes.shape({\n                file_name: wrappedPropTypes.string,\n                mime_type: wrappedPropTypes.string,\n                content: wrappedPropTypes.string,\n            }),\n        }),\n    },\n    post: {\n        \"/sessions/:session_id/contract_templates\": documentCallback({\n            func: (data, params, body) => {\n                return new ContractTemplate(data).upsertBySession(\n                    body,\n                    params.session_id\n                );\n            },\n            summary:\n                \"Associate a position template with a session; this method upserts\",\n            posts: docApiPropTypes.contractTemplate,\n            returns: docApiPropTypes.contractTemplate,\n        }),\n        \"/contract_templates/upload\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                const { file_name, content } = body;\n                const file_contents = base64decode(content);\n                new ContractTemplate(data).upload({ file_contents, file_name });\n                return [...data.available_contract_templates];\n            },\n            summary:\n                \"Upload a base64-encoded contract template. (The contract template should be utf-8 encoded HTML).\",\n            posts: wrappedPropTypes.shape({\n                file_name: wrappedPropTypes.string,\n                content: wrappedPropTypes.string,\n            }),\n            returns: wrappedPropTypes.arrayOf(\n                docApiPropTypes.contractTemplateMinimal\n            ),\n        }),\n        \"/contract_templates/delete\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"Delete a contract template\",\n            posts: docApiPropTypes.contractTemplate,\n            returns: docApiPropTypes.contractTemplate,\n        }),\n        \"/contract_templates\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"Update a contract template\",\n            posts: docApiPropTypes.contractTemplate,\n            returns: docApiPropTypes.contractTemplate,\n        }),\n    },\n};\n","import { MockAPIController, find, getAttributesCheckMessage } from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\n\nexport class User extends MockAPIController {\n    constructor(data) {\n        super(data, data.users);\n    }\n    validateNew(user) {\n        const message = getAttributesCheckMessage(user, this.ownData, {\n            utorid: { required: true, unique: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    rawFind(query) {\n        if (query == null) {\n            return null;\n        }\n        // If we pass an `id`, rely on that, otherwise,\n        // use the `utorid`.\n        if (query.id != null) {\n            return find(query, this.ownData);\n        }\n        if (query.utorid != null) {\n            return find(query, this.ownData, \"utorid\");\n        }\n        return find({ utorid: query }, this.ownData, \"utorid\");\n    }\n    setActiveUser(user) {\n        const matchingUser = this.find(user);\n        if (!matchingUser) {\n            throw new Error(\n                `Cannot find user ${JSON.stringify(user)} to set as active`\n            );\n        }\n        this.data.active_user = matchingUser.utorid;\n    }\n    getActiveUser() {\n        return this.find(this.data.active_user);\n    }\n}\n\nexport const activeUserRoutes = {\n    get: {\n        \"/users\": documentCallback({\n            func: (data) => new User(data).findAll(),\n            summary: \"Get all available users.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n        }),\n        \"/active_user\": documentCallback({\n            func: (data) => new User(data).getActiveUser(),\n            summary: \"Gets the currently active user.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n            roles: [\"instructor\", \"ta\"],\n        }),\n    },\n    post: {\n        \"/users\": documentCallback({\n            func: (data, params, body) => new User(data).upsert(body),\n            summary: \"Upserts user info\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n            posts: docApiPropTypes.user,\n        }),\n    },\n};\n","import {\n    getAttributesCheckMessage,\n    deleteInArray,\n    MockAPIController,\n    errorUnlessRole,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { User } from \"./active_user\";\nimport { Position } from \"./positions\";\n\nexport class Instructor extends MockAPIController {\n    constructor(data) {\n        super(data, data.instructors);\n    }\n    validateNew(instructor) {\n        const message = getAttributesCheckMessage(instructor, this.ownData, {\n            utorid: { required: true, unique: true },\n            first_name: { required: true },\n            last_name: { required: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    delete(instructor) {\n        const matchingInstructor = this.find(instructor);\n        if (!matchingInstructor) {\n            throw new Error(\n                `Cannot find instructor matching ${JSON.stringify(instructor)}`\n            );\n        }\n        super.delete(matchingInstructor);\n        // After an instructor is deleted, they should be removed from all courses\n\n        // remove this instructor from any positions\n        for (const position of this.data.positions) {\n            if (\n                (position.instructor_ids || []).includes(matchingInstructor.id)\n            ) {\n                deleteInArray(matchingInstructor.id, position.instructor_ids);\n            }\n        }\n        return matchingInstructor;\n    }\n    /**\n     * Returns the instructor object corresponding to the active user,\n     * or null if the active user doesn't correspond to an instructor.\n     *\n     * @returns {Instructor | null}\n     * @memberof Instructor\n     */\n    getFromActiveUser() {\n        const activeUser = new User(this.data).getActiveUser();\n        const activeInstructor = new Instructor(this.data)\n            .findAll()\n            .find((instructor) => instructor.utorid === activeUser.utorid);\n        return activeInstructor;\n    }\n}\n\nexport const instructorsRoutes = {\n    get: {\n        \"/instructors\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    return new Instructor(data).findAll();\n                }\n                if (params.role === \"instructor\") {\n                    const activeInstructor = new Instructor(\n                        data\n                    ).getFromActiveUser();\n                    if (!activeInstructor) {\n                        return [];\n                    }\n                    const instructorPositions = new Position(\n                        data\n                    ).getForInstructor(activeInstructor);\n                    const instructorIdsSet = new Set();\n                    for (const position of instructorPositions) {\n                        for (const id of position.instructor_ids) {\n                            instructorIdsSet.add(id);\n                        }\n                    }\n\n                    return new Instructor(data)\n                        .findAll()\n                        .filter((instructor) =>\n                            instructorIdsSet.has(instructor.id)\n                        );\n                }\n                // Always error if we've made it to this point\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Get a list of all instructors\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.instructor),\n        }),\n    },\n    post: {\n        \"/instructors\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new Instructor(data).upsert(body);\n            },\n            summary: \"Upsert an instructor\",\n            posts: docApiPropTypes.instructor,\n            returns: docApiPropTypes.instructor,\n        }),\n        \"/instructors/delete\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new Instructor(data).delete(body);\n            },\n            summary: \"Delete an instructor (removes from all positions)\",\n            posts: docApiPropTypes.idOnly,\n            returns: docApiPropTypes.instructor,\n        }),\n    },\n};\n","import {\n    find,\n    getAttributesCheckMessage,\n    deleteInArray,\n    findAllById,\n    MockAPIController,\n    errorUnlessRole,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { Session } from \"./sessions\";\nimport { ContractTemplate } from \"./contract_templates\";\nimport { Instructor } from \"./instructors\";\n\nexport class Position extends MockAPIController {\n    constructor(data) {\n        super(data, data.positions);\n    }\n    validateNew(position, session = null) {\n        // If we're inserting to a session, the position_code must be unique\n        if (session) {\n            const message = getAttributesCheckMessage(\n                position,\n                this.findAllBySession(session),\n                {\n                    position_code: { required: true, unique: true },\n                }\n            );\n            if (message) {\n                throw new Error(message);\n            }\n        }\n    }\n    find(query) {\n        const rawPosition = this.rawFind(query);\n        // Find which session we're part of\n\n        let session_id = null;\n        for (const [_session_id, assignment_ids] of Object.entries(\n            this.data.positions_by_session\n        )) {\n            if (assignment_ids.includes(rawPosition.id)) {\n                session_id = _session_id;\n                break;\n            }\n        }\n        return { ...rawPosition, session_id };\n    }\n    getSession(position) {\n        return new Session(this.data).find({\n            id: position.session_id,\n        });\n    }\n    getContractTemplate(position) {\n        return new ContractTemplate(this.data).find({\n            id: position.contract_template_id,\n        });\n    }\n    getInstructors(position) {\n        if (!position.instructor_ids) {\n            return [];\n        }\n        return position.instructor_ids.map((id) =>\n            new Instructor(this.data).find({ id })\n        );\n    }\n    /**\n     * Returns a list of positions that the specified `instructor` is an instructor for.\n     *\n     * @param {*} instructor\n     * @memberof Position\n     */\n    getForInstructor(instructor) {\n        instructor = new Instructor(this.data).find(instructor);\n        if (!instructor) {\n            throw new Error(`Cannot find a matching instructor`);\n        }\n        const positions = this.findAll();\n        return positions.filter((position) =>\n            (position.instructor_ids || []).includes(instructor.id)\n        );\n    }\n    delete(position) {\n        const matchingPosition = this.rawFind(position);\n        if (!matchingPosition) {\n            throw new Error(\n                `Cannot find position matching ${JSON.stringify(position)}`\n            );\n        }\n        super.delete(matchingPosition);\n        // After an instructor is deleted, they should be removed from all courses\n\n        // remove this instructor from any positions\n        for (const bySessionsList of Object.values(\n            this.data.positions_by_session\n        )) {\n            if (bySessionsList.includes(matchingPosition.id)) {\n                deleteInArray(matchingPosition.id, bySessionsList);\n            }\n        }\n        return matchingPosition;\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).find(session);\n        return findAllById(\n            this.data.positions_by_session[matchingSession.id] || [],\n            this.ownData\n        );\n    }\n    upsertBySession(obj, session) {\n        const matchingSession = new Session(this.data).rawFind(session);\n        // If this is not an upsert, validate the parameters. Otherwise, don't validate.\n        if (!this.rawFind(obj)) {\n            this.validateNew(obj, matchingSession);\n\n            // if the start/end date is not set,\n            // use the session dates\n            obj.start_date =\n                obj.start_date === undefined\n                    ? matchingSession.start_date\n                    : obj.start_date;\n            obj.end_date =\n                obj.end_date === undefined\n                    ? matchingSession.end_date\n                    : obj.end_date;\n        }\n        const newPosition = this.upsert(obj);\n        // Make sure there is an array for to store the contract_templates by session,\n        // and the push to this array before returning the new object\n        this.data.positions_by_session[matchingSession.id] =\n            this.data.positions_by_session[matchingSession.id] || [];\n        this.data.positions_by_session[matchingSession.id].push(newPosition.id);\n        return newPosition;\n    }\n    findAssociatedSession(position) {\n        const matchingPosition = this.find(position);\n        if (!matchingPosition) {\n            throw new Error(\n                `Could not associated session because there is no position matching ${JSON.stringify(\n                    position\n                )}`\n            );\n        }\n        const ret = Object.keys(this.data.positions_by_session).find((x) =>\n            this.data.positions_by_session[x].includes(matchingPosition.id)\n        );\n        // Make sure we recast the id as an int\n        return ret != null ? +ret : ret;\n    }\n}\n\nexport const positionsRoutes = {\n    get: {\n        \"/sessions/:session_id/positions\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    return new Position(data).findAllBySession(\n                        params.session_id\n                    );\n                }\n                if (params.role === \"instructor\") {\n                    // Only return the the positions belonging to the current session\n                    // for which the activeUser is an instructor.\n                    const activeInstructor = new Instructor(\n                        data\n                    ).getFromActiveUser();\n                    if (!activeInstructor) {\n                        return [];\n                    }\n                    return new Position(data)\n                        .findAllBySession(params.session_id)\n                        .filter((position) =>\n                            position.instructor_ids.includes(\n                                activeInstructor.id\n                            )\n                        );\n                }\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Get positions associated with this session.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.position),\n        }),\n    },\n    post: {\n        \"/sessions/:session_id/positions\": documentCallback({\n            func: (data, params, body) => {\n                return new Position(data).upsertBySession(\n                    body,\n                    params.session_id\n                );\n            },\n            summary:\n                \"Upsert a position associated with a session. If a new position is created, it will be automatically associated with the given session\",\n            posts: docApiPropTypes.position,\n            returns: docApiPropTypes.position,\n        }),\n        \"/positions\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                const positions = data.positions;\n                // body should be a session object. If it contains an id,\n                // update an existing session. Otherwise, create a new one.\n                const matchingPosition = find(body, positions);\n                if (matchingPosition) {\n                    return Object.assign(matchingPosition, body);\n                }\n                throw new Error(`Cannot find position with id=${body.id}`);\n            },\n            summary: \"Update a position\",\n            posts: docApiPropTypes.position,\n            returns: docApiPropTypes.position,\n        }),\n        \"/positions/delete\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new Position(data).delete(body);\n            },\n            summary: \"Delete a position\",\n            posts: docApiPropTypes.idOnly,\n            returns: docApiPropTypes.position,\n        }),\n    },\n};\n","import { documentCallback, docApiPropTypes } from \"../defs/doc-generation\";\nimport { find, MockAPIController, findAllById } from \"./utils\";\nimport { Assignment } from \"./assignments\";\nimport { Position } from \"./positions\";\n\nexport class WageChunk extends MockAPIController {\n    constructor(data) {\n        super(data, data.wage_chunks);\n    }\n    validateNew() {\n        // There is nothing to validate for a wage chunk\n    }\n    findAllByAssignment(assignment) {\n        const matchingAssignment = new Assignment(this.data).rawFind(\n            assignment\n        );\n        if (!matchingAssignment) {\n            throw new Error(\n                `Could not find assignment matching ${JSON.stringify(\n                    assignment\n                )}`\n            );\n        }\n        // Make sure we apply `this.find` so that the rates are computed.\n        return findAllById(\n            [matchingAssignment.id],\n            this.ownData,\n            \"assignment_id\"\n        ).map((x) => this.find(x));\n    }\n    find(wageChunk) {\n        const rawWageChunk = this.rawFind(wageChunk);\n        const ret = { ...rawWageChunk };\n        if (ret.rate == null) {\n            // If the rate is not set, look it up from the session\n            const session = this.getSession(wageChunk);\n            if (session.rate2 == null) {\n                ret.rate = session.rate1;\n            } else {\n                // Rates switch from session.rate1 to session.rate2 on January 1 of\n                // the year following the session start date.\n                const start_date = new Date(wageChunk.start_date);\n                const end_date = new Date(wageChunk.end_date);\n                const session_start_date = new Date(session.start_date);\n                // For `Date`, 11 is december\n                const december = new Date(\n                    session_start_date.getFullYear(),\n                    11,\n                    31\n                );\n                if (start_date <= december && end_date <= december) {\n                    ret.rate = session.rate1;\n                } else {\n                    ret.rate = session.rate2;\n                }\n            }\n        }\n        return ret;\n    }\n    getSession(wageChunk) {\n        const rawWageChunk = this.rawFind(wageChunk);\n        const assignment = new Assignment(this.data).rawFind({\n            id: rawWageChunk.assignment_id,\n        });\n        const position = new Assignment(this.data).getPosition(assignment);\n        return new Position(this.data).getSession(position);\n    }\n    upsertByAssignment(wageChunk, assignment) {\n        const matchingAssignment = new Assignment(this.data).rawFind(\n            assignment\n        );\n        if (!matchingAssignment) {\n            throw new Error(\n                `Could not find assignment matching ${JSON.stringify(\n                    assignment\n                )}`\n            );\n        }\n        return this.upsert({\n            ...wageChunk,\n            assignment_id: matchingAssignment.id,\n        });\n    }\n    /**\n     * Sets the list of wage chunks associated with a given assignment to `wageChunks`.\n     * Any wage chunks omitted from the list are deleted.\n     *\n     * @param {*} wageChunks\n     * @param {*} assignment\n     * @returns\n     * @memberof WageChunk\n     */\n    setAllByAssignment(wageChunks, assignment) {\n        const matchingAssignment = new Assignment(this.data).rawFind(\n            assignment\n        );\n        if (!matchingAssignment) {\n            throw new Error(\n                `Could not find assignment matching ${JSON.stringify(\n                    assignment\n                )}`\n            );\n        }\n        const existingWageChunks = this.findAllByAssignment(assignment);\n        // Now we can upsert all the wageChunks\n        wageChunks.forEach((chunk) =>\n            this.upsertByAssignment(chunk, matchingAssignment)\n        );\n        // every wage chunk that is not in the `wageChunks` list gets deleted\n        for (const wageChunk of existingWageChunks) {\n            if (!find(wageChunk, wageChunks)) {\n                this.delete(wageChunk);\n            }\n        }\n        // Recompute the wage chunks list. This is \"needless\"\n        // logically, but it might catch some bugs at some point.\n        return this.findAllByAssignment(matchingAssignment);\n    }\n}\n\nexport const wageChunkRoutes = {\n    get: {},\n    post: {\n        \"/wage_chunks\": documentCallback({\n            func: (data, params, body) => new WageChunk(data).upsert(body),\n            posts: docApiPropTypes.wageChunk,\n            summary: \"Upsert a wage_chunk\",\n            returns: docApiPropTypes.wageChunk,\n        }),\n        \"/wage_chunks/delete\": documentCallback({\n            func: (data, params, body) => new WageChunk(data).delete(body),\n            posts: docApiPropTypes.wageChunk,\n            summary: \"Delete a wage_chunk. Must have a valid id specified.\",\n            returns: docApiPropTypes.wageChunk,\n        }),\n    },\n};\n","import {\n    getAttributesCheckMessage,\n    MockAPIController,\n    findAllById,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { Session } from \"./sessions\";\n\nexport class Application extends MockAPIController {\n    constructor(data) {\n        super(data, data.applications);\n    }\n    validateNew(applicant) {\n        const message = getAttributesCheckMessage(applicant, this.ownData, {\n            session_id: { required: true },\n            applicant_id: { required: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).find(session);\n        if (!matchingSession) {\n            throw new Error(\n                `Cannot find applicant by session because session ${JSON.stringify(\n                    session\n                )} cannot be found`\n            );\n        }\n        // The applicants for this session are those who have submitted an application for this session\n        return findAllById([matchingSession.id], this.ownData, \"session_id\");\n    }\n}\n\nexport const applicationsRoutes = {\n    get: {\n        \"/sessions/:session_id/applications\": documentCallback({\n            func: (data, params) =>\n                new Application(data).findAllBySession(params.session_id),\n            summary: \"Get all applications associated with the given session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.application),\n        }),\n    },\n    post: {\n        \"/applications\": documentCallback({\n            func: (data, params, body) => new Application(data).upsert(body),\n            summary: \"Upsert an application\",\n            posts: docApiPropTypes.application,\n            returns: docApiPropTypes.application,\n        }),\n        \"/sessions/:session_id/applications\": documentCallback({\n            func: (data, params, body) => new Application(data).upsert(body),\n            summary: \"Upsert an application\",\n            posts: docApiPropTypes.application,\n            returns: docApiPropTypes.application,\n        }),\n        \"/instructor_preferences\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Upsert an instructor_preference\",\n            posts: docApiPropTypes.instructor_preference,\n            returns: docApiPropTypes.instructor_preference,\n        }),\n    },\n};\n","import {\n    getAttributesCheckMessage,\n    findAllById,\n    MockAPIController,\n    filterNullProps,\n    errorUnlessRole,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { Session } from \"./sessions\";\nimport { Application } from \"./applications\";\nimport { Assignment } from \"./assignments\";\nimport { stringToNativeType } from \"../../libs/urls\";\nimport { Instructor } from \"./instructors\";\n\nexport class Applicant extends MockAPIController {\n    constructor(data) {\n        super(data, data.applicants);\n    }\n    validateNew(applicant) {\n        const message = getAttributesCheckMessage(applicant, this.ownData, {\n            utorid: { required: true, unique: true },\n            first_name: { required: true },\n            last_name: { required: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).find(session);\n        if (!matchingSession) {\n            throw new Error(\n                `Cannot find applicant by session because session ${JSON.stringify(\n                    session\n                )} cannot be found`\n            );\n        }\n        // The applicants for this session are those who have submitted an\n        // application for this session or those who have an assignment in this\n        // session.\n        const applications = new Application(this.data).findAllBySession(\n            matchingSession\n        );\n        const assignments = new Assignment(this.data).findAllBySession(\n            matchingSession\n        );\n        // Get a unique list of applicant ids\n        const applicantIds = Array.from(\n            new Set(\n                applications\n                    .map((x) => x.applicant_id)\n                    .concat(assignments.map((x) => x.applicant_id))\n            )\n        );\n        return findAllById(applicantIds, this.ownData);\n    }\n}\n\nexport const applicantsRoutes = {\n    get: {\n        \"/sessions/:session_id/applicants\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    return new Applicant(data).findAllBySession(\n                        params.session_id\n                    );\n                }\n                if (params.role === \"instructor\") {\n                    const activeInstructor = new Instructor(\n                        data\n                    ).getFromActiveUser();\n                    if (!activeInstructor) {\n                        return [];\n                    }\n                    const applicantIds = new Assignment(data)\n                        .findAllBySessionAndInstructor(\n                            params.session_id,\n                            activeInstructor\n                        )\n                        .map((assignment) => assignment.applicant_id);\n                    // Only return applicants for positions that the instructor is instructing\n                    return new Applicant(data)\n                        .findAll()\n                        .filter((applicant) =>\n                            applicantIds.includes(applicant.id)\n                        );\n                }\n\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Get all applicants associated with the given session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.applicant),\n        }),\n        \"/applicants\": documentCallback({\n            func: (data) => new Applicant(data).findAll(),\n            summary: \"Get all applicants\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.applicant),\n        }),\n        \"/applicants/:applicant_id\": documentCallback({\n            func: (data, params) =>\n                new Applicant(data).find(params.applicant_id),\n            summary: \"Get an applicant\",\n            returns: docApiPropTypes.applicant,\n        }),\n    },\n    post: {\n        \"/applicants\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new Applicant(data).upsert(body);\n            },\n            summary: \"Upsert an applicant\",\n            posts: docApiPropTypes.applicant,\n            returns: docApiPropTypes.applicant,\n        }),\n        \"/sessions/:session_id/applicants\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                const applicants = new Applicant(data).findAll();\n                // If we didn't specify an `id` but we did specify a `utorid`,\n                // try to look up the applicant by `utorid`\n                const existingApplicant =\n                    applicants.find(\n                        (x) => x.id === body.id || x.utorid === body.utorid\n                    ) || {};\n                const applicant = new Applicant(data).upsert({\n                    ...existingApplicant,\n                    ...filterNullProps(body),\n                });\n                const applications = new Application(data).findAllBySession(\n                    params.session_id\n                );\n                // First search for an applicant with a matching `id`\n                let match = applications.find(\n                    (application) => application.applicant_id === applicant.id\n                );\n                if (!match) {\n                    // We need to create an application for this applicant\n                    new Application(data).upsert({\n                        session_id: stringToNativeType(params.session_id),\n                        applicant_id: applicant.id,\n                        comment: \"<Autogenerated>\",\n                    });\n                }\n\n                return applicant;\n            },\n            summary:\n                \"Upsert an applicant. If they have no application associated with the current session, an application is created.\",\n            posts: docApiPropTypes.applicant,\n            returns: docApiPropTypes.applicant,\n        }),\n        \"/applicants/delete\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new Applicant(data).delete(body);\n            },\n            summary: \"Delete an applicant\",\n            posts: docApiPropTypes.idOnly,\n            returns: docApiPropTypes.applicant,\n        }),\n    },\n};\n","import {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport {\n    getAttributesCheckMessage,\n    findAllById,\n    splitDateRangeAtNewYear,\n    MockAPIController,\n    wageChunkArrayToStartAndEndDates,\n    formatInstructorsContact,\n    wageChunkArrayToPayPeriodDescription,\n    errorUnlessRole,\n} from \"./utils\";\nimport { sum } from \"../../libs/utils\";\nimport { Session } from \"./sessions\";\nimport { Position } from \"./positions\";\nimport { WageChunk } from \"./wage_chunks\";\nimport { Applicant } from \"./applicants\";\nimport { Instructor } from \"./instructors\";\n\nexport class Assignment extends MockAPIController {\n    constructor(data) {\n        super(data, data.assignments);\n    }\n    validateNew(assignment) {\n        // No uniqueness required, so pass in an empty array ([]) to the verifier\n        const message = getAttributesCheckMessage(assignment, [], {\n            position_id: { required: true },\n            applicant_id: { required: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).rawFind(session);\n        return findAllById(\n            this.data.assignments_by_session[matchingSession.id] || [],\n            this.ownData\n            // Call \"find\" again to make sure every item gets packaged appropriately\n        ).map((x) => new Assignment(this.data).find(x));\n    }\n    getPosition(assignment) {\n        return new Position(this.data).find({\n            id: assignment.position_id,\n        });\n    }\n    getApplicant(assignment) {\n        return new Applicant(this.data).find({\n            id: assignment.applicant_id,\n        });\n    }\n    /**\n     * Grabs a bunch of data from the wage chunks related to an assignment\n     *\n     * @param {string} assignment\n     * @returnType {{hours: number, wage_chunks: object[]}}\n     */\n    getWageChunkInfo(assignment) {\n        const wageChunks = new WageChunk(this.data).findAllByAssignment(\n            assignment\n        );\n        const hours = sum(...wageChunks.map((x) => x.hours));\n        return { hours, wageChunks };\n    }\n    /**\n     * Grab the active offer for an assignment\n     *\n     * @param {number} matchingAssignment.id\n     * @param {object} this.data\n     * @returns {({}|null)} - an offer object or `undefined`\n     */\n    getActiveOffer(assignment) {\n        return new ActiveOffer(this.data).findByAssignment(assignment);\n    }\n    /**\n     * Pieces together all the details of an assignment from the mockAPI data\n     *\n     * @param {object} matchingAssignment - an assignment\n     * @returns\n     */\n    find(assignment) {\n        const matchingAssignment = this.rawFind(assignment);\n        if (!matchingAssignment) {\n            return matchingAssignment;\n        }\n        const ret = { ...matchingAssignment };\n        // compute the hours from wage chunks\n        const { hours } = this.getWageChunkInfo(matchingAssignment);\n        ret.hours = hours;\n        // compute offer_status\n        const activeOffer = this.getActiveOffer(matchingAssignment);\n        if (activeOffer) {\n            ret.active_offer_status = activeOffer.status;\n            ret.active_offer_url_token = activeOffer.url_token;\n        }\n        // Add position start and end dates if they are not defined\n        const position = this.getPosition(matchingAssignment);\n        if (!matchingAssignment.start_date) {\n            ret.start_date = position.start_date;\n        }\n        if (!matchingAssignment.end_date) {\n            ret.end_date = position.end_date;\n        }\n\n        return ret;\n    }\n    upsert(assignment) {\n        // Call `find` to make sure the `hours` field is computed\n        const upsertedAssignment = this.find(super.upsert(assignment));\n\n        // Make sure the assignment is in the assignments_by_session list\n        const session_id = new Position(this.data).findAssociatedSession(\n            upsertedAssignment.position_id\n        );\n        if (session_id) {\n            this.data.assignments_by_session[session_id].push(\n                upsertedAssignment.id\n            );\n        }\n\n        // If `hours` is passed into the assignment, we need to modify the wage chunks\n        // associated with the assignment (but only if the hours differ).\n        if (\n            assignment.hours == null ||\n            +upsertedAssignment.hours === +assignment.hours\n        ) {\n            return upsertedAssignment;\n        }\n\n        let wageChunks = new WageChunk(this.data).findAllByAssignment(\n            upsertedAssignment\n        );\n        // If there are no wage chunks, we need to create some\n        if (wageChunks.length === 0) {\n            const dateRanges = splitDateRangeAtNewYear(\n                upsertedAssignment.start_date,\n                upsertedAssignment.end_date\n            );\n            // create the wage chunks with zero hours, because it will be updated soon\n            for (const range of dateRanges) {\n                new WageChunk(this.data).upsertByAssignment(\n                    {\n                        hours: 0,\n                        start_date: range.start_date,\n                        end_date: range.end_date,\n                    },\n                    upsertedAssignment\n                );\n            }\n        }\n\n        // Now we are guaranteed to have wage chunks, so set them to the correct number\n        // of hours\n        wageChunks = new WageChunk(this.data).findAllByAssignment(\n            upsertedAssignment\n        );\n        const delta =\n            +assignment.hours - +(this.find(upsertedAssignment).hours || 0);\n        const perChunkDelta = delta / wageChunks.length;\n        for (const chunk of wageChunks) {\n            new WageChunk(this.data).upsert({\n                ...chunk,\n                hours: (chunk.hours || 0) + perChunkDelta,\n            });\n        }\n\n        // Find the assignment again, to make sure all computed fields are properly computed\n        return this.find(upsertedAssignment);\n    }\n    /**\n     * Returns the list of all assignments for positions that are (a) for the\n     * specified session, and (b) taught by the specified instructor.\n     *\n     * @param {*} session\n     * @param {*} instructor\n     * @returns\n     * @memberof Assignment\n     */\n    findAllBySessionAndInstructor(session, instructor) {\n        session = new Session(this.data).find(session);\n        instructor = new Instructor(this.data).find(instructor);\n        const instructorPositions = new Position(this.data).getForInstructor(\n            instructor\n        );\n        const assignments = this.findAllBySession(session);\n        const positionIds = instructorPositions.map((position) => position.id);\n\n        // Only return assignments for positions that the instructor is instructing\n        return assignments.filter((assignment) =>\n            positionIds.includes(assignment.position_id)\n        );\n    }\n}\n\nclass ActiveOffer extends MockAPIController {\n    constructor(data) {\n        super(data, data.offers);\n    }\n    findByAssignment(assignment) {\n        const matchingAssignment = this._ensureAssignment(assignment);\n\n        // As a hack, a `_noActiveOffer` flag is added to an assignment\n        // if the active offer should be ignore.\n        if (matchingAssignment && matchingAssignment._noActiveOffer) {\n            return null;\n        }\n\n        // offers are never deleted, only added to the table, so\n        // picking the last one is the same as picking the \"newest\"\n        const offers = findAllById(\n            [matchingAssignment.id],\n            this.data.offers,\n            \"assignment_id\"\n        );\n        const activeOffer = offers[offers.length - 1];\n        return activeOffer || null;\n    }\n    findAllByAssignment(assignment) {\n        const matchingAssignment = this._ensureAssignment(assignment);\n\n        // As a hack, a `_noActiveOffer` flag is added to an assignment\n        // if the active offer should be ignore.\n        if (matchingAssignment && matchingAssignment._noActiveOffer) {\n            return null;\n        }\n\n        // offers are never deleted, only added to the table, so\n        // picking the last one is the same as picking the \"newest\"\n        const offers = findAllById(\n            [matchingAssignment.id],\n            this.data.offers,\n            \"assignment_id\"\n        );\n        return offers;\n    }\n    _ensureAssignment(assignment) {\n        const matchingAssignment = new Assignment(this.data).rawFind(\n            assignment\n        );\n        if (!matchingAssignment) {\n            throw new Error(\n                `Could not find assignment matching ${JSON.stringify(\n                    assignment\n                )}`\n            );\n        }\n        return matchingAssignment;\n    }\n    getAssignment(offer) {\n        return new Assignment(this.data).find({\n            id: offer.assignment_id,\n        });\n    }\n    find(query) {\n        // This is where the magic happens. We create all the data needed for the offer here.\n        const baseOffer = this.rawFind(query);\n        const assignment = this.getAssignment(baseOffer);\n        const { hours, wageChunks } = new Assignment(\n            this.data\n        ).getWageChunkInfo(assignment);\n        const position = new Assignment(this.data).getPosition(assignment);\n        const applicant = new Assignment(this.data).getApplicant(assignment);\n        const instructors = new Position(this.data).getInstructors(position);\n        const contractTemplate = new Position(this.data).getContractTemplate(\n            position\n        );\n\n        const { start_date, end_date } =\n            wageChunkArrayToStartAndEndDates(wageChunks);\n\n        const offer = {\n            accepted_date: null,\n            rejected_date: null,\n            withdrawn_date: null,\n            signature: \"\",\n            nag_count: 0,\n            // All mutable fields should come before `baseOffer` is destructured.\n            // Fields that come after are computed and cannot be directly set.\n            ...baseOffer,\n            contract_template: contractTemplate.template_file,\n            contract_override_pdf: assignment.contract_override_pdf,\n            first_name: applicant.first_name,\n            last_name: applicant.last_name,\n            email: applicant.email,\n            position_code: position.position_code,\n            position_title: position.position_title,\n            position_start_date: start_date,\n            position_end_date: end_date,\n            first_time_ta: null,\n            instructor_contact_desc: formatInstructorsContact(instructors),\n            pay_period_desc: wageChunkArrayToPayPeriodDescription(wageChunks),\n            hours,\n            ta_coordinator_name: \"Dr. Coordinator\",\n            ta_coordinator_email: \"coordinator@utoronto.ca\",\n            url_token: \"mock_api_offer_url_token\",\n        };\n\n        return offer;\n    }\n    withdrawByAssignment(assignment) {\n        const offer = this.findByAssignment(this._ensureAssignment(assignment));\n        return this.find(\n            this.upsert({\n                ...offer,\n                status: \"withdrawn\",\n                withdrawn_date: new Date().toISOString(),\n            })\n        );\n    }\n    rejectByAssignment(assignment) {\n        const offer = this.findByAssignment(this._ensureAssignment(assignment));\n        return this.find(\n            this.upsert({\n                ...offer,\n                status: \"rejected\",\n                rejected_date: new Date().toISOString(),\n            })\n        );\n    }\n    acceptByAssignment(assignment) {\n        const offer = this.findByAssignment(this._ensureAssignment(assignment));\n        return this.find(\n            this.upsert({\n                ...offer,\n                status: \"accepted\",\n                accepted_date: new Date().toISOString(),\n            })\n        );\n    }\n    emailByAssignment(assignment) {\n        const offer = this.findByAssignment(this._ensureAssignment(assignment));\n        return this.find(\n            this.upsert({\n                ...offer,\n                status: \"pending\",\n                emailed_date: new Date().toISOString(),\n            })\n        );\n    }\n    nagByAssignment(assignment) {\n        const offer = this.findByAssignment(this._ensureAssignment(assignment));\n        if (!offer.emailed_date) {\n            throw new Error(\n                `The active offer for assignment with id=${assignment.id} has not been emailed yet, so a nag email cannot be sent`\n            );\n        }\n        return this.find(\n            this.upsert({\n                ...offer,\n                nag_count: (offer.nag_count || 0) + 1,\n            })\n        );\n    }\n    getHistoryByAssignment(assignment) {\n        const offers = this.findAllByAssignment(\n            this._ensureAssignment(assignment)\n        );\n        if (offers.length === 0) {\n            throw new Error(\n                `There is no offer history for assignment with id=${assignment.id}.`\n            );\n        }\n        // Note: allocating memory inside of the sort callback is frowned upon, but this is just a mock API\n        offers.sort(function (a, b) {\n            return new Date(b.emailed_date) - new Date(a.emailed_date);\n        });\n        return offers;\n    }\n    createByAssignment(assignment) {\n        const matchingAssignment = this._ensureAssignment(assignment);\n        const offer = this.findByAssignment(matchingAssignment);\n        if (\n            offer &&\n            [\"pending\", \"accepted\", \"rejected\", \"provisional\"].includes(\n                offer.status\n            )\n        ) {\n            throw new Error(\n                `An offer already exists for assignment=${JSON.stringify(\n                    assignment\n                )}`\n            );\n        }\n\n        // As a hack, sometimes a `_noActiveOffer` flag is set. Make sure to unset this flag\n        // before creating an offer.\n        new Assignment(this.data).upsert({\n            ...matchingAssignment,\n            _noActiveOffer: false,\n        });\n        return this.upsert(\n            this.find(\n                this.create({\n                    assignment_id: matchingAssignment.id,\n                    status: \"provisional\",\n                })\n            )\n        );\n    }\n}\n\nexport const assignmentsRoutes = {\n    get: {\n        \"/sessions/:session_id/assignments\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    return new Assignment(data).findAllBySession(\n                        params.session_id\n                    );\n                }\n                if (params.role === \"instructor\") {\n                    const activeInstructor = new Instructor(\n                        data\n                    ).getFromActiveUser();\n                    if (!activeInstructor) {\n                        return [];\n                    }\n                    return new Assignment(data).findAllBySessionAndInstructor(\n                        params.session_id,\n                        activeInstructor\n                    );\n                }\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Get assignments associated with a session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.assignment),\n        }),\n        \"/assignments/:assignment_id\": documentCallback({\n            func: (data, params) =>\n                new Assignment(data).find(params.assignment_id),\n            summary: \"Get an assignment\",\n            returns: docApiPropTypes.assignment,\n        }),\n        \"/assignments/:assignment_id/active_offer\": documentCallback({\n            func: (data, params) =>\n                new Assignment(data).getActiveOffer(params.assignment_id),\n            summary: \"Get the active offer associated with an assignment\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/wage_chunks\": documentCallback({\n            func: (data, params) =>\n                new Assignment(data).getWageChunkInfo(params.assignment_id)\n                    .wageChunks,\n            summary: \"Get the wage_chunks associated with an assignment\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.wageChunk),\n        }),\n        \"/assignments/:assignment_id/active_offer/history\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).getHistoryByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary: \"Fetches all offers that have previously been emailed.\",\n            returns: docApiPropTypes.offer,\n        }),\n    },\n    post: {\n        \"/assignments\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                const existingAssignment = new Assignment(data).find(body);\n                if (existingAssignment) {\n                    const activeOffer = new Assignment(data).getActiveOffer(\n                        existingAssignment\n                    );\n                    if (!activeOffer) {\n                        return new Assignment(data).upsert(body);\n                    }\n                    if (\n                        [\"withdrawn\", \"provisional\"].includes(\n                            activeOffer.status\n                        )\n                    ) {\n                        // In this case, we can upsert the assignment, but we remove any active offer\n                        // in the process\n                        return new Assignment(data).upsert({\n                            ...body,\n                            _noActiveOffer: true,\n                        });\n                    }\n                    throw new Error(\n                        `Cannot update an assignment that has an active offer with status '${activeOffer.status}'`\n                    );\n                }\n                return new Assignment(data).upsert(body);\n            },\n            posts: docApiPropTypes.assignment,\n            summary: \"Upsert an assignment\",\n            returns: docApiPropTypes.assignment,\n        }),\n        \"/assignments/:assignment_id/wage_chunks\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                return new WageChunk(data).setAllByAssignment(\n                    body,\n                    params.assignment_id\n                );\n            },\n            summary:\n                \"Sets the wage chunks of an assignment to the specified list. The contents of the list are upserted. Omitted wage chunks are deleted.\",\n            posts: wrappedPropTypes.arrayOf(docApiPropTypes.wageChunk),\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.wageChunk),\n        }),\n        \"/assignments/:assignment_id/active_offer/withdraw\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).withdrawByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary: \"Withdraws the active offer for the specified assignment\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/active_offer/reject\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).rejectByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary: \"Rejects the active offer for the specified assignment\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/active_offer/accept\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).acceptByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary: \"Accepts the active offer for the specified assignment\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/active_offer/create\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).createByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary:\n                \"Creates an offer for the specified assignment, provided there are no active offers for this assignment.\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/active_offer/email\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).emailByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary: \"Emails the active offer for the specified assignment\",\n            returns: docApiPropTypes.offer,\n        }),\n        \"/assignments/:assignment_id/active_offer/nag\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                return new ActiveOffer(data).nagByAssignment(\n                    params.assignment_id\n                );\n            },\n            summary:\n                \"Sends a nag email for the active offer for the specified assignment which has already been emailed once\",\n            returns: docApiPropTypes.offer,\n        }),\n    },\n};\n","import {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { User } from \"./active_user\";\n\n// persistent storage for the Debug class\nconst storage = {};\n\nexport class Debug {\n    constructor(data) {\n        this.data = data;\n    }\n    getAllData() {\n        return this.data;\n    }\n    makeSnapshot(name = \"snapshot\") {\n        storage[name] = JSON.stringify(this.getAllData());\n        return this.getAllData();\n    }\n    clearData() {\n        this.makeSnapshot(\"beforeclear\");\n        Object.keys(this.data).forEach((key) => {\n            // Contract templates are supposed to be stored on \"disk\"\n            // and so they shouldn't be cleared when we clear the database\n            if (\n                key === \"available_contract_templates\" ||\n                key === \"contract_templates_by_filename\"\n            ) {\n                return;\n            }\n            this.data[key] = createBlankCopy(this.data[key]);\n        });\n        return this.getAllData();\n    }\n    restoreSnapshot(name = \"snapshot\") {\n        const snapshot = JSON.parse(storage[name] || \"{}\");\n        this.clearData();\n        Object.assign(this.data, snapshot);\n        return this.getAllData();\n    }\n}\n\nexport const debugRoutes = {\n    get: {\n        \"/debug/active_user\": documentCallback({\n            func: (data) => new User(data).getActiveUser(),\n            summary:\n                \"Gets the active user; in debug mode this is specified by posting to `active_user`.\",\n            returns: docApiPropTypes.user,\n        }),\n        \"/debug/users\": documentCallback({\n            func: (data) => new User(data).findAll(),\n            summary: \"Get a list of all users\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n        }),\n        \"/debug/routes\": documentCallback({\n            func: () => {},\n            summary: \"Get a all available routes\",\n        }),\n        \"/debug/serializers\": documentCallback({\n            func: () => {},\n            summary:\n                \"Get a all available serializers and their attributes. These will cover the majority of the payloads that the API can return.\",\n        }),\n    },\n    post: {\n        \"/debug/active_user\": documentCallback({\n            func: (data, params, body) => {\n                const user = new User(data);\n                const found_user = user.find(body);\n                if (!found_user) {\n                    throw new Error(\n                        `Could not find user matching ${JSON.stringify(body)}`\n                    );\n                }\n                user.setActiveUser(found_user);\n                return user.getActiveUser();\n            },\n            summary:\n                \"Sets the active user; this will override whatever credentials are passed to the server.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n            posts: docApiPropTypes.user,\n        }),\n        \"/debug/users\": documentCallback({\n            func: (data, params, body) => new User(data).upsert(body),\n            summary:\n                \"Adds a user; this is done without any permission checks, so it can be used to bootstrap permissions during debug.\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.user),\n            posts: docApiPropTypes.user,\n        }),\n        \"/debug/clear_data\": documentCallback({\n            func: (data) => {\n                return new Debug(data).clearData();\n            },\n            summary: \"Deletes all data in the database\",\n        }),\n        \"/debug/snapshot\": documentCallback({\n            func: (data) => {\n                return new Debug(data).makeSnapshot();\n            },\n            summary: \"Makes a snapshot of the current state of the database\",\n        }),\n        \"/debug/restore_snapshot\": documentCallback({\n            func: (data) => {\n                return new Debug(data).restoreSnapshot();\n            },\n            summary: \"Restores the last snapshot of the database\",\n        }),\n    },\n};\n\n/**\n * Returns the blank value of the same type\n * as the passed-in data\n *\n * @param {*} data\n * @returns\n */\nfunction createBlankCopy(data) {\n    if (typeof data === \"object\") {\n        if (data instanceof Array) {\n            return [];\n        } else {\n            return {};\n        }\n    } else if (typeof data === \"string\") {\n        return \"\";\n    } else {\n        // If `data` is not of type string, array or object\n        // use the constructor, which will return blank value\n        // of that particular type.\n        return data.constructor();\n    }\n}\n","import {\n    getAttributesCheckMessage,\n    MockAPIController,\n    errorUnlessRole,\n} from \"./utils\";\nimport {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\nimport { Session } from \"./sessions\";\nimport { Assignment } from \"./assignments\";\nimport { stringToNativeType } from \"../../libs/urls\";\n\nexport class Ddah extends MockAPIController {\n    constructor(data) {\n        super(data, data.ddahs);\n    }\n    validateNew(ddah) {\n        const message = getAttributesCheckMessage(ddah, this.ownData, {\n            assignment_id: { required: true, unique: true },\n        });\n        if (message) {\n            throw new Error(message);\n        }\n    }\n    findAllBySession(session) {\n        const matchingSession = new Session(this.data).find(session);\n        if (!matchingSession) {\n            throw new Error(\n                `Cannot find DDAHs by session because session ${JSON.stringify(\n                    session\n                )} cannot be found`\n            );\n        }\n        const assignments = new Assignment(this.data).findAllBySession(\n            matchingSession\n        );\n        const assignmentIds = assignments.map((assignment) => assignment.id);\n        return this.ownData.filter((ddah) =>\n            assignmentIds.includes(ddah.assignment_id)\n        );\n    }\n}\n\nexport const ddahsRoutes = {\n    get: {\n        \"/sessions/:session_id/ddahs\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    return new Ddah(data).findAllBySession(params.session_id);\n                }\n                errorUnlessRole(params, \"\");\n            },\n            summary:\n                \"Get all ddah forms associated with assignments for the given session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.ddah),\n        }),\n        \"/sessions/:session_id/ddahs/accepted_list\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    throw new Error(\"Not implemented in mock API\");\n                }\n                errorUnlessRole(params, \"\");\n            },\n            summary:\n                \"Get a signature list of all TAs who have acknowledged their DDAH form for this session. Returns a base64 encoded html file.\",\n            returns: wrappedPropTypes.shape({\n                file_name: wrappedPropTypes.string,\n                mime_type: wrappedPropTypes.string,\n                content: wrappedPropTypes.string,\n            }),\n        }),\n        \"/sessions/:session_id/ddahs/accepted_list.pdf\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\") {\n                    throw new Error(\"Not implemented in mock API\");\n                }\n                errorUnlessRole(params, \"\");\n            },\n            summary:\n                \"Get a signature list of all TAs who have acknowledged their DDAH form for this session. Returns a base64 encoded html file.\",\n            returns: wrappedPropTypes.shape({\n                file_name: wrappedPropTypes.string,\n                mime_type: wrappedPropTypes.string,\n                content: wrappedPropTypes.string,\n            }),\n        }),\n        \"/ddahs/:ddah_id\": documentCallback({\n            func: (data, params) => new Ddah(data).find(params.ddah_id),\n            summary: \"Get a ddah\",\n            returns: docApiPropTypes.ddah,\n        }),\n        \"/assignments/:assignment_id/ddah\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\" || params.role === \"instructor\") {\n                    const assignment = new Assignment(data).find(\n                        params.assignment_id\n                    );\n                    if (!assignment) {\n                        throw new Error(\n                            `Cannot create a DDAH because an assignment with id '${params.assignment_id}' cannot be found.`\n                        );\n                    }\n                    return new Ddah(data)\n                        .findAll()\n                        .find((ddah) => ddah.assignment_id === assignment.id);\n                }\n                // If we make it here, we should error because of invalid permissions\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Find a DDAH associated with a specific assignment.\",\n            returns: docApiPropTypes.ddah,\n            roles: [\"instructor\"],\n        }),\n    },\n    post: {\n        \"/ddahs\": documentCallback({\n            func: (data, params, body) => {\n                errorUnlessRole(params, \"admin\");\n                const existingDdah = new Ddah(data).find({ id: body.id });\n                if (!existingDdah || !body.duties) {\n                    // Create a new DDAH if there isn't one already\n                    return new Ddah(data).upsert(body);\n                }\n                // If there is a DDAH already and we change the duties at all, we must\n                // remove the accepted date, the signature, and the approved date.\n                const overwriteFields = {\n                    accepted_date: null,\n                    approved_date: null,\n                    signature: null,\n                };\n                // Since we only care about a change to the duties, a quick-and-dirty way is to\n                // compare the JSONified duties\n                function sortByOrder(a, b) {\n                    return a.order - b.order;\n                }\n                if (\n                    JSON.stringify([...body.duties].sort(sortByOrder)) !==\n                    JSON.stringify([...existingDdah.duties].sort(sortByOrder))\n                ) {\n                    // If the DDAH has been accepted, its new (signatureless)\n                    // state will be \"revised\"\n                    if (\n                        existingDdah.accepted_date ||\n                        existingDdah.emailed_date\n                    ) {\n                        overwriteFields.revised_date = new Date();\n                    }\n                    return new Ddah(data).upsert({\n                        ...body,\n                        ...overwriteFields,\n                    });\n                }\n                return new Ddah(data).upsert(body);\n            },\n            summary: \"Upsert a ddah\",\n            posts: docApiPropTypes.ddah,\n            returns: docApiPropTypes.ddah,\n        }),\n        \"/ddahs/:ddah_id/approve\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                const ddah = new Ddah(data).find({ id: params.ddah_id });\n                if (!ddah) {\n                    throw new Error(\n                        `Could not find DDAH with id '${params.ddah_id}'`\n                    );\n                }\n                return new Ddah(data).upsert({\n                    ...ddah,\n                    approved_date: new Date().toISOString(),\n                });\n            },\n            summary: \"Approve a DDAH\",\n            returns: docApiPropTypes.ddah,\n        }),\n        \"/ddahs/:ddah_id/delete\": documentCallback({\n            func: (data, params) => {\n                errorUnlessRole(params, \"admin\");\n                const ddah = new Ddah(data).find({ id: params.ddah_id });\n                if (!ddah) {\n                    throw new Error(\n                        `Could not find DDAH with id '${params.ddah_id}'`\n                    );\n                }\n                return new Ddah(data).delete({ id: params.ddah_id });\n            },\n            summary: \"Delete a DDAH\",\n            returns: docApiPropTypes.ddah,\n        }),\n        \"/ddahs/:ddah_id/email\": documentCallback({\n            func: (data, params) => {\n                if (params.role === \"admin\" || params.role === \"instructor\") {\n                    const ddah = new Ddah(data).find({ id: params.ddah_id });\n                    if (!ddah) {\n                        throw new Error(\n                            `Could not find DDAH with id '${params.ddah_id}'`\n                        );\n                    }\n                    return new Ddah(data).upsert({\n                        ...ddah,\n                        emailed_date: new Date().toISOString(),\n                    });\n                }\n                // If we make it here, we should error because of invalid permissions\n                errorUnlessRole(params, \"\");\n            },\n            summary: \"Email a DDAH\",\n            returns: docApiPropTypes.ddah,\n            roles: [\"instructor\"],\n        }),\n        \"/assignments/:assignment_id/ddah\": documentCallback({\n            func: (data, params, body) => {\n                if (params.role === \"admin\" || params.role === \"instructor\") {\n                    const assignment = new Assignment(data).find(\n                        params.assignment_id\n                    );\n                    if (!assignment) {\n                        throw new Error(\n                            `Cannot create a DDAH because an assignment with id '${params.assignment_id}' cannot be found.`\n                        );\n                    }\n                    return new Ddah(data).upsert({\n                        ...body,\n                        assignment_id: stringToNativeType(params.assignment_id),\n                    });\n                }\n                // If we make it here, we should error because of invalid permissions\n                errorUnlessRole(params, \"\");\n            },\n            summary:\n                \"Create a DDAH associated with a specific assignment. You may specify the details of the DDAH in th body of this request.\",\n            posts: docApiPropTypes.ddah,\n            returns: docApiPropTypes.ddah,\n        }),\n    },\n};\n","import {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\n\nexport const reportingTagRoutes = {\n    get: {\n        \"/sessions/:session_id/positions/reporting_tags\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in mock API\");\n            },\n            summary: \"Get all reporting tags associated with a session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.reportingTag),\n        }),\n        \"/sessions/:session_id/wage_chunks/reporting_tags\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in mock API\");\n            },\n            summary: \"Get all reporting tags associated with a session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.reportingTag),\n        }),\n        \"/wage_chunks/:wage_chunk_id/reporting_tags\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in mock API\");\n            },\n            summary: \"Get all reporting tags associated with a wage chunk\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.reportingTag),\n        }),\n        \"/positions/:position_id/reporting_tags\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in mock API\");\n            },\n            summary: \"Get all reporting tags associated with a position\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.reportingTag),\n        }),\n    },\n    post: {\n        \"/wage_chunks/:wage_chunk_id/reporting_tags\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in mock API\");\n            },\n            summary: \"Add a reporting tag associated with a wage chunk\",\n            returns: docApiPropTypes.reportingTag,\n            posts: docApiPropTypes.reportingTag,\n        }),\n        \"/wage_chunks/:wage_chunk_id/reporting_tags/delete\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in mock API\");\n            },\n            summary:\n                \"Remove an association between a reporting tag and a wage chunk\",\n            returns: docApiPropTypes.reportingTag,\n            posts: docApiPropTypes.reportingTag,\n        }),\n        \"/positions/:position_id/reporting_tags\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in mock API\");\n            },\n            summary: \"Add a reporting tag associated with a position\",\n            returns: docApiPropTypes.reportingTag,\n            posts: docApiPropTypes.reportingTag,\n        }),\n        \"/positions/:position_id/reporting_tags/delete\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in mock API\");\n            },\n            summary:\n                \"Remove an association between a reporting tag and a position\",\n            returns: docApiPropTypes.reportingTag,\n            posts: docApiPropTypes.reportingTag,\n        }),\n    },\n};\n","import {\n    documentCallback,\n    wrappedPropTypes,\n    docApiPropTypes,\n} from \"../defs/doc-generation\";\n\nexport const postingRoutes = {\n    get: {\n        \"/sessions/:session_id/postings\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Get all postings associated with a session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.posting),\n        }),\n        \"/sessions/:session_id/posting_positions\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Get all posting_positions associated with a session\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.posting_position),\n        }),\n        \"/postings/:posting_id/posting_positions\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Get all posting_positions associated with a posting\",\n            returns: wrappedPropTypes.arrayOf(docApiPropTypes.posting_position),\n        }),\n        \"/postings/:posting_id\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Get a single posting\",\n            returns: docApiPropTypes.posting,\n        }),\n        \"/postings/:posting_id/survey\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Get the survey associated with a posting\",\n            returns: wrappedPropTypes.any,\n        }),\n        \"/posting_positions/:posting_position_id\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Get a single posting_position\",\n            returns: docApiPropTypes.posting_position,\n        }),\n    },\n    post: {\n        \"/sessions/:session_id/postings\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Upsert a posting\",\n            returns: docApiPropTypes.posting,\n            posts: docApiPropTypes.posting,\n        }),\n        \"/postings\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Upsert a posting\",\n            returns: docApiPropTypes.posting,\n            posts: docApiPropTypes.posting,\n        }),\n        \"/postings/delete\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Delete a posting\",\n            posts: docApiPropTypes.idOnly,\n            returns: docApiPropTypes.posting,\n        }),\n        \"/postings/:posting_id/posting_positions\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Upsert a posting_position\",\n            returns: docApiPropTypes.posting_position,\n            posts: docApiPropTypes.posting_position,\n        }),\n        \"/posting_positions\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Upsert a posting_position\",\n            returns: docApiPropTypes.posting_position,\n            posts: docApiPropTypes.posting_position,\n        }),\n        \"/posting_positions/delete\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented\");\n            },\n            summary: \"Delete a posting_position\",\n            posts: docApiPropTypes.idOnly,\n            returns: docApiPropTypes.posting_position,\n        }),\n    },\n};\n","import { documentCallback, wrappedPropTypes } from \"../defs/doc-generation\";\n\nexport const publicRoutes = {\n    get: {\n        \"/public/ddahs/:token\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"Get the contents of ddah as `html` or `pdf`\",\n            returns: wrappedPropTypes.any,\n        }),\n        \"/public/ddahs/:token/view\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"View a ddah with an accept dialog\",\n            returns: wrappedPropTypes.any,\n        }),\n        \"/public/ddahs/:token/details\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"Get JSON information about a DDAH\",\n            returns: wrappedPropTypes.any,\n        }),\n        \"/public/contracts/:token\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"Get an offer as `html` or `pdf`\",\n            returns: wrappedPropTypes.any,\n        }),\n        \"/public/contracts/:token/view\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"View an offer with an accept dialog\",\n            returns: wrappedPropTypes.any,\n        }),\n        \"/public/contracts/:token/details\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"Get a JSON object with all the details about the offer\",\n            returns: wrappedPropTypes.any,\n        }),\n        \"/public/postings/:token\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary:\n                \"Get a JSON object with the survey_js data for the posting\",\n            returns: wrappedPropTypes.any,\n        }),\n        \"/public/files/:token\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"Return the file corresponding to the specified token\",\n            returns: wrappedPropTypes.any,\n        }),\n    },\n    post: {\n        \"/public/ddahs/:token/accept\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"Set a ddah as accepted\",\n            returns: wrappedPropTypes.any,\n        }),\n        \"/public/contracts/:token/accept\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"Accept an offer\",\n            returns: wrappedPropTypes.any,\n        }),\n        \"/public/contracts/:token/reject\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"Reject an offer\",\n            returns: wrappedPropTypes.any,\n        }),\n        \"/public/postings/:token/submit\": documentCallback({\n            func: () => {\n                throw new Error(\"Not implemented in Mock API\");\n            },\n            summary: \"Submit survey_js data after filling out a posting\",\n            posts: wrappedPropTypes.any,\n            returns: wrappedPropTypes.any,\n        }),\n    },\n};\n","import Route from \"route-parser\";\nimport { mockData } from \"./data\";\nimport { sessionsRoutes } from \"./sessions\";\nimport { templatesRoutes } from \"./contract_templates\";\nimport { positionsRoutes } from \"./positions\";\nimport { instructorsRoutes } from \"./instructors\";\nimport { documentCallback } from \"../defs/doc-generation\";\nimport { assignmentsRoutes } from \"./assignments\";\nimport { applicantsRoutes } from \"./applicants\";\nimport { applicationsRoutes } from \"./applications\";\nimport { wageChunkRoutes } from \"./wage_chunks\";\nimport { debugRoutes } from \"./debug\";\nimport { activeUserRoutes, User } from \"./active_user\";\nimport { ddahsRoutes } from \"./ddahs\";\nimport { reportingTagRoutes } from \"./reportingTags\";\nimport { postingRoutes } from \"./postings\";\nimport { publicRoutes } from \"./public-routes\";\n\n/**\n * Mock API server that runs locally; useful for demo purposes.\n *\n * @module\n */\n\nexport class MockAPI {\n    routePrefix = \"/api/v1\";\n    // a list of selectors for each route\n    getRoutes = Object.assign(\n        {},\n        sessionsRoutes.get,\n        templatesRoutes.get,\n        positionsRoutes.get,\n        instructorsRoutes.get,\n        assignmentsRoutes.get,\n        applicantsRoutes.get,\n        applicationsRoutes.get,\n        wageChunkRoutes.get,\n        ddahsRoutes.get,\n        reportingTagRoutes.get,\n        debugRoutes.get,\n        activeUserRoutes.get,\n        postingRoutes.get,\n        publicRoutes.get,\n        {\n            \"/all_data\": documentCallback({\n                func: (data) => data,\n                exclude: true,\n            }),\n        }\n    );\n    postRoutes = Object.assign(\n        {},\n        sessionsRoutes.post,\n        templatesRoutes.post,\n        positionsRoutes.post,\n        instructorsRoutes.post,\n        assignmentsRoutes.post,\n        applicantsRoutes.post,\n        applicationsRoutes.post,\n        wageChunkRoutes.post,\n        ddahsRoutes.post,\n        reportingTagRoutes.post,\n        debugRoutes.post,\n        activeUserRoutes.post,\n        postingRoutes.post,\n        publicRoutes.post\n    );\n\n    constructor(seedData) {\n        this.active = false;\n        this.data = seedData;\n        this._getRoutesParsers = Object.keys(this.getRoutes).map((routeStr) => {\n            // We want to peel of the role from the start of the route, but we don't want\n            // to consider it part of the route for documentation purposes. Since `routeStr`\n            // is used to find the callback of the route, we hack `Route` so that `spec`\n            // is the same as `routeStr`.\n            const r = new Route(\"(/:role)\" + routeStr);\n            r.spec = routeStr;\n            return r;\n        });\n        this._postRoutesParsers = Object.keys(this.postRoutes).map(\n            (routeStr) => {\n                // We want to peel of the role from the start of the route, but we don't want\n                // to consider it part of the route for documentation purposes. Since `routeStr`\n                // is used to find the callback of the route, we hack `Route` so that `spec`\n                // is the same as `routeStr`.\n                const r = new Route(\"(/:role)\" + routeStr);\n                r.spec = routeStr;\n                return r;\n            }\n        );\n    }\n\n    /**\n     * Make a mock `apiGET` call. Always returns an object of\n     * the form\n     * `{status: ..., message: ..., payload: ...}`\n     * This method is bound, so it is safe to pass this function around.\n     *\n     * @memberof MockAPI\n     * @param {string} url An API route without `/api/v1` (e.g., `/sessions`)\n     */\n    apiGET = (url) => {\n        for (const route of this._getRoutesParsers) {\n            const match = route.match(url);\n            // if we have a match, run the selector with the parsed data\n            if (match) {\n                try {\n                    this.authenticateActiveUserBasedOnRole(match.role);\n                    const payload = this.getRoutes[route.spec](\n                        this.data,\n                        match\n                    );\n\n                    return {\n                        status: \"success\",\n                        message: \"\",\n                        payload,\n                    };\n                } catch (e) {\n                    return { status: \"error\", message: e.toString() };\n                }\n            }\n        }\n        return {\n            status: \"error\",\n            message: `could not find route matching ${url}`,\n        };\n    };\n\n    /**\n     * Make a mock `apiPOST` call. Always returns an object of\n     * the form\n     * `{status: ..., message: ..., payload: ...}`\n     * This method is bound, so it is safe to pass this function around.\n     *\n     * @memberof MockAPI\n     * @param {string} url An API route without `/api/v1` (e.g., `/sessions`)\n     * @param {object} body The body of a post request. This should be an object, *not* a JSON string.\n     */\n    apiPOST = (url, body) => {\n        for (const route of this._postRoutesParsers) {\n            const match = route.match(url);\n            // if we have a match, run the selector with the parsed data\n            if (match) {\n                try {\n                    this.authenticateActiveUserBasedOnRole(match.role);\n                    const payload = this.postRoutes[route.spec](\n                        this.data,\n                        match,\n                        body\n                    );\n                    return {\n                        status: \"success\",\n                        message: \"\",\n                        payload,\n                    };\n                } catch (e) {\n                    return { status: \"error\", message: e.toString() };\n                }\n            }\n        }\n        return {\n            status: \"error\",\n            message: `could not find route matching ${url}`,\n        };\n    };\n\n    /**\n     * Authenticates the `active_user` as having the role `role`.\n     * If the user is not authenticated, an error is thrown.\n     *\n     * @param {string} role\n     * @returns\n     * @memberof MockAPI\n     */\n    authenticateActiveUserBasedOnRole(role) {\n        if (role == null) {\n            return;\n        }\n        const active_user = new User(this.data).getActiveUser();\n        if (active_user == null) {\n            return;\n        }\n        if (!active_user.roles.includes(role)) {\n            throw new Error(\n                `Not authenticated for accessing routes with prefix /${role}`\n            );\n        }\n    }\n\n    /**\n     * Replaces the global `window.fetch` object with calls to `apiGET` and\n     * `apiPOST`. This means that true network requests will no longer\n     * work.\n     *\n     * @param {number} [delay=1000]\n     * @memberof MockAPI\n     */\n    replaceGlobalFetch(delay = 1000) {\n        if (this.active) {\n            return;\n        }\n        this.active = true;\n        this._origFetch = fetch;\n        window.fetch = async (url, init = {}) => {\n            // Parse the URL first. We only want the pathname\n            const parsedURL = new URL(url, \"http://dummy.com\");\n            url = parsedURL.pathname;\n            // Make sure the url doesn't start with \"/api/v1\"\n            url = url.startsWith(this.routePrefix)\n                ? url.replace(this.routePrefix, \"\")\n                : url;\n            let mockResponse;\n            if (init.method === \"GET\") {\n                mockResponse = this.apiGET(url);\n            } else {\n                let body = init.body;\n                if (typeof body === \"string\") {\n                    body = JSON.parse(body);\n                }\n                mockResponse = this.apiPOST(url, body);\n            }\n            // eslint-disable-next-line\n            console.log(\n                `MockAPI ${init.method} Request.`,\n                url,\n                init,\n                \"Responding with\",\n                mockResponse\n            );\n            // Create a `Response` object to return so that we fully imitate\n            // the `fetch` api.\n            const responseObj = new Response(\n                new Blob([JSON.stringify(mockResponse)], {\n                    type: \"application/json\",\n                }),\n                { status: 200, statusText: \"OK\" }\n            );\n            return new Promise((resolve) => {\n                window.setTimeout(() => resolve(responseObj), delay);\n            });\n        };\n    }\n\n    /**\n     * Restore the global `window.fetch` to what the browser provides.\n     * If `window.fetch` has not been overridden, this function does nothing.\n     *\n     * @memberof MockAPI\n     */\n    restoreGlobalFetch() {\n        this.active = false;\n        window.fetch = this._origFetch || fetch;\n    }\n}\n\nconst mockAPI = new MockAPI(mockData);\nexport { mockAPI, mockData };\n","import React from \"react\";\nimport { Button, ButtonGroup } from \"react-bootstrap\";\nimport { connect } from \"react-redux\";\nimport { setGlobals, globalsSelector } from \"../../api/actions\";\n\n/**\n * A toggle switch for turning on and off the Mock API. An instance\n * of the Mock API is included in this component, and this component\n * takes no arguments.\n *\n * This component only renders when `process.env.REACT_APP_DEV_FEATURES` is truthy.\n *\n * @export\n * @returns {React.ElementType}\n */\nlet ToggleMockApi = function ToggleMockApi(props) {\n    const { globals, setMockAPIState } = props;\n    const active = globals.mockAPI;\n\n    return (\n        <span\n            title={\n                \"The Mock API simulates the TAPP API but uses browser-based storage. This allows you to test TAPP functionality without a working server.\"\n            }\n        >\n            Mock API{\" \"}\n            <ButtonGroup>\n                <Button\n                    variant={active ? \"primary\" : \"secondary\"}\n                    onClick={() => setMockAPIState(true)}\n                >\n                    On\n                </Button>\n                <Button\n                    variant={active ? \"secondary\" : \"primary\"}\n                    onClick={() => setMockAPIState(false)}\n                >\n                    Off\n                </Button>\n            </ButtonGroup>\n        </span>\n    );\n};\n\nToggleMockApi = connect((state) => ({ globals: globalsSelector(state) }), {\n    setGlobals,\n})(ToggleMockApi);\n\nexport { ToggleMockApi };\n","import React from \"react\";\nimport { Dropdown } from \"react-bootstrap\";\n\nconst ident = () => {};\n\n/**\n * A toggle switch for turning on and off the Mock API. An instance\n * of the Mock API is included in this component, and this component\n * takes no arguments.\n *\n * This component only renders when `process.env.REACT_APP_DEV_FEATURES` is truthy.\n *\n * @export\n * @returns {React.ElementType}\n */\nfunction ActiveUserButton({\n    users = [],\n    activeUser = {},\n    setActiveUser = ident,\n    fetchUsers = ident,\n}) {\n    const [dropdownVisible, setDropdownVisible] = React.useState(false);\n\n    React.useEffect(() => {\n        // Whenever the dropdown is open, fetch a list of all available users.\n        // This would normally not be a good idea, but since this button is only\n        // used in debug mode, it's okay.\n        if (dropdownVisible) {\n            fetchUsers();\n        }\n    }, [dropdownVisible, fetchUsers]);\n\n    return (\n        <span\n            title={\n                \"Set which user you are currently logged in as. This is only available when the server is running in debug mode.\"\n            }\n            className=\"logged-in-as-container\"\n        >\n            <label>Logged in as</label>\n            <Dropdown\n                onSelect={(i) => {\n                    setActiveUser(users[i]);\n                }}\n                onToggle={(desiredVisibility) =>\n                    setDropdownVisible(desiredVisibility)\n                }\n                show={dropdownVisible}\n                alignRight\n            >\n                <Dropdown.Toggle split variant=\"dark\">\n                    {activeUser.utorid}{\" \"}\n                </Dropdown.Toggle>\n                <Dropdown.Menu flip={true}>\n                    {(users || []).map((user, i) => (\n                        <Dropdown.Item\n                            key={i}\n                            eventKey={\"\" + i}\n                            active={activeUser.utorid === user.utorid}\n                        >\n                            {user.utorid} ({(user.roles || []).join(\", \")})\n                        </Dropdown.Item>\n                    ))}\n                </Dropdown.Menu>\n            </Dropdown>\n        </span>\n    );\n}\n\nexport { ActiveUserButton };\n","import { RawUser } from \"../api/defs/types\";\nimport applicants from \"./applicants.json\";\nimport assignments from \"./assignments.json\";\nimport contractTemplates from \"./contract_templates.json\";\nimport instructors from \"./instructors.json\";\nimport positions from \"./positions.json\";\nimport sessions from \"./sessions.json\";\nimport users from \"./users.json\";\nimport applications from \"./applications.json\";\n\nexport const seedData = {\n    applicants,\n    assignments,\n    contractTemplates,\n    instructors,\n    positions,\n    sessions,\n    applications,\n    users: users as Omit<RawUser, \"id\">[],\n};\n","import { normalizeImport } from \"../../libs/import-export\";\nimport {\n    instructorsSelector,\n    contractTemplatesSelector,\n    upsertApplicant,\n    upsertAssignment,\n    upsertPosition,\n    upsertSession,\n    upsertInstructor,\n    upsertContractTemplate,\n    setActiveSession,\n    positionsSelector,\n    activeSessionSelector,\n    debugOnlyUpsertUser,\n    debugOnlySetActiveUser,\n    applicationsSelector,\n    fetchActiveUser,\n    upsertPosting,\n    upsertPostingPosition,\n    fetchPositions,\n} from \"../../api/actions\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport {\n    positionSchema,\n    applicantSchema,\n    assignmentSchema,\n} from \"../../libs/schema\";\nimport React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { Button, Modal, ProgressBar, Dropdown } from \"react-bootstrap\";\nimport { useThunkDispatch } from \"../../libs/thunk-dispatch\";\nimport { prepareFull } from \"../../libs/import-export\";\nimport {\n    Applicant,\n    MinimalAssignment,\n    MinimalPosition,\n    Session,\n} from \"../../api/defs/types\";\nimport { seedData } from \"../../mock_data\";\n\ntype PromiseOrVoidFunction = (...args: any[]) => Promise<any> | void;\n\nconst ident = () => {};\n\n/**\n * A button to automatically set up a mock session with contract_template and\n * instructors, and upsert positions, applicants, and assignments from mock data\n * JSON files in order.\n */\nexport function SeedDataMenu({\n    sessions = [],\n    fetchSessions = ident,\n}: {\n    sessions?: Session[];\n    fetchSessions: Function;\n}) {\n    const [dropdownVisible, setDropdownVisible] = React.useState(false);\n    const [confirmDialogVisible, setConfirmDialogVisible] =\n        React.useState(false);\n    const [seedAction, _setSeedAction] = React.useState<PromiseOrVoidFunction>(\n        () => ident\n    );\n    const [inProgress, setInProgress] = React.useState(false);\n    const [stage, setStage] = React.useState(\"\");\n    const [progress, setProgress] = React.useState(0);\n    const dispatch = useThunkDispatch();\n    const instructors = useSelector(instructorsSelector);\n    const contractTemplates = useSelector(contractTemplatesSelector);\n    const positions = useSelector(positionsSelector);\n    const targetSession = useSelector(activeSessionSelector);\n\n    let session: Session | null;\n    let applicants: Applicant[] = [];\n    let applications = useSelector(applicationsSelector);\n    let count;\n    let total;\n\n    // If a function is passed to a `useSate` setter, it is evaluated.\n    // Since we want to set the state to a function, we need to wrap the setter,\n    // so that it does the right thing.\n    function setSeedAction(action: PromiseOrVoidFunction) {\n        _setSeedAction(() => action);\n    }\n\n    const seedActions = {\n        user: { name: `Users (${seedData.users.length})`, action: seedUsers },\n        session: { name: \"Session (1)\", action: seedSession },\n        contractTemplate: {\n            name: \"Contract Templates (2)\",\n            action: seedContractTemplate,\n        },\n        instructors10: {\n            name: \"Instructors (10)\",\n            action: () => seedInstructors(10),\n        },\n        instructors: {\n            name: `Instructors (${seedData.instructors.length})`,\n            action: seedInstructors,\n        },\n        position10: { name: \"Positions (10)\", action: () => seedPositions(10) },\n        position: {\n            name: `Positions (${seedData.positions.length})`,\n            action: seedPositions,\n        },\n        applicant10: {\n            name: \"Applicants (10)\",\n            action: () => seedApplicants(10),\n        },\n        applicant: {\n            name: `Applicants (${seedData.applicants.length})`,\n            action: seedApplicants,\n        },\n        assignment10: {\n            name: \"Assignments (10)\",\n            action: () => seedAssignments(10),\n        },\n        assignment: {\n            name: `Assignment (${seedData.assignments.length})`,\n            action: seedAssignments,\n        },\n        application: {\n            name: `Applications (${seedData.applications.length})`,\n            action: seedApplications,\n        },\n        instructorPref: {\n            name: `Instructor Preferences (${seedData.applications.length})`,\n            action: seedInstructorPreferences,\n        },\n        all: { name: \"All Data\", action: seedAll },\n        matching: { name: \"All Matching Data\", action: seedMatching },\n    };\n\n    React.useEffect(() => {\n        // Whenever the dropdown is open, fetch a list of all existing sessions.\n        // This would normally not be a good idea, but since this button is only\n        // used in debug mode, it's okay.\n        if (dropdownVisible) {\n            fetchSessions();\n        }\n    }, [dropdownVisible, fetchSessions]);\n\n    async function seedSession() {\n        setStage(\"Session\");\n        setProgress(0);\n\n        if (targetSession === null) {\n            // create the mock session\n            const mockSessionData = {\n                start_date: \"2020/01/01\",\n                end_date: \"2021/12/31\",\n                name: `Session ${new Date().toLocaleString()}`,\n                rate1: 50,\n            };\n            session = await dispatch(upsertSession(mockSessionData));\n        } else {\n            // use the selected session\n            session = targetSession;\n        }\n\n        await dispatch(setActiveSession(session));\n\n        setProgress(100);\n    }\n\n    async function seedUsers(limit = 600) {\n        setProgress(0);\n        setStage(\"Users\");\n        const users = seedData.users.slice(0, limit);\n        count = 0;\n        for (const user of users) {\n            await dispatch(debugOnlyUpsertUser(user));\n            count++;\n            setProgress(Math.round((count / users.length) * 100));\n        }\n        setProgress(100);\n    }\n\n    async function seedContractTemplate() {\n        setProgress(0);\n        setStage(\"Contract Template\");\n        for (const template of seedData.contractTemplates) {\n            await dispatch(upsertContractTemplate(template));\n        }\n        setProgress(100);\n    }\n\n    async function seedInstructors(limit = 1000) {\n        setStage(\"Instructors\");\n        setProgress(0);\n        for (const instructor of seedData.instructors.slice(0, limit)) {\n            if (\n                !instructors.some((inst) => inst.utorid === instructor.utorid)\n            ) {\n                const newInstructor = await dispatch(\n                    upsertInstructor(instructor)\n                );\n                instructors.push(newInstructor);\n            }\n        }\n        setProgress(100);\n    }\n\n    async function seedPositions(limit = 1000) {\n        setStage(\"Positions\");\n        setProgress(0);\n        count = 0;\n        total = seedData.positions.length;\n\n        const data = (\n            normalizeImport(\n                {\n                    fileType: \"json\",\n                    data: seedData.positions,\n                },\n                positionSchema\n            ) as MinimalPosition[]\n        ).map((position) =>\n            prepareFull.position(position, {\n                instructors,\n                contractTemplates,\n            })\n        );\n        for (const position of data.slice(0, limit)) {\n            await dispatch(upsertPosition(position));\n            count++;\n            setProgress(Math.round((count / total) * 100));\n        }\n    }\n\n    async function seedApplicants(limit = 1000) {\n        setStage(\"Applicants\");\n        setProgress(0);\n        count = 0;\n        total = seedData.applicants.length;\n        const data = normalizeImport(\n            {\n                fileType: \"json\",\n                data: seedData.applicants,\n            },\n            applicantSchema\n        );\n        for (const a of data.slice(0, limit)) {\n            const applicant = await dispatch(upsertApplicant(a));\n            applicants.push(applicant);\n            count++;\n            setProgress(Math.round((count / total) * 100));\n        }\n    }\n\n    async function seedAssignments(limit = 1000) {\n        setStage(\"Assignments\");\n        setProgress(0);\n        if (!session) {\n            throw new Error(\"Need a valid session to continue\");\n        }\n        count = 0;\n        total = seedData.assignments.length;\n        const data = (\n            normalizeImport(\n                {\n                    fileType: \"json\",\n                    data: seedData.assignments,\n                },\n                assignmentSchema\n            ) as MinimalAssignment[]\n        ).map((assignment) => {\n            if (!session) {\n                throw new Error(\"Need a valid session to continue\");\n            }\n            return prepareFull.assignment(assignment, {\n                positions,\n                applicants,\n                session,\n            });\n        });\n        for (const a of data.slice(0, limit)) {\n            await dispatch(upsertAssignment(a));\n            count++;\n            setProgress(Math.round((count / total) * 100));\n        }\n    }\n\n    async function seedApplications(limit = 600) {\n        setStage(\"Applications\");\n        setProgress(0);\n\n        if (!targetSession) {\n            throw new Error(\"Need a valid session to continue\");\n        }\n\n        let count = 0;\n        let total = seedData.applications.length;\n\n        // Keep track of the original active user so we can swap back\n        const initialUser = await dispatch(fetchActiveUser());\n\n        // Get this session's posting token:\n        const resp = await apiGET(\n            `/admin/sessions/${targetSession.id}/postings`\n        );\n\n        if (resp.length === 0) {\n            throw new Error(\"No postings found\");\n        }\n\n        // Seeded applications are directed at the first posting of the active session\n        let url_token = resp[0].url_token;\n\n        for (const application of seedData.applications.slice(0, limit)) {\n            const currUser = {\n                utorid: application.utorid,\n                roles: [\"admin\", \"instructor\", \"ta\"],\n            };\n            await dispatch(\n                debugOnlySetActiveUser(currUser, { skipInit: true })\n            );\n\n            const newApp = {\n                utorid: application.utorid,\n                student_number: application.student_number,\n                first_name: application.first_name,\n                last_name: application.last_name,\n                email: application.email,\n                phone: application.phone.toString(),\n                program: application.program,\n                department: application.department,\n                yip: application.yip,\n                gpa: application.gpa || 0,\n                previous_department_ta: application.previous_department_ta,\n                previous_university_ta: application.previous_university_ta,\n                program_start: application.program_start,\n                previous_other_university_ta:\n                    application.previous_other_university_ta,\n                position_preferences: application.position_preferences,\n            };\n\n            await apiPOST(\n                `/public/postings/${url_token}/submit`,\n                { answers: newApp },\n                true\n            );\n\n            count++;\n            setProgress(Math.round((count / total) * 100));\n        }\n\n        await dispatch(\n            debugOnlySetActiveUser({\n                utorid: initialUser.utorid,\n                roles: initialUser.roles,\n            })\n        );\n\n        setProgress(100);\n    }\n\n    async function seedInstructorPreferences(limit = 600) {\n        setStage(\"Instructor Preferences\");\n        setProgress(0);\n\n        if (!targetSession) {\n            throw new Error(\"Need a valid session to continue\");\n        }\n\n        let count = 0;\n        let total = seedData.applications.length;\n\n        for (const application of seedData.applications.slice(0, limit)) {\n            if (application.instructor_preferences) {\n                const targetApplication =\n                    applications.find(\n                        (currApplication) =>\n                            currApplication.applicant.utorid ===\n                            application.utorid\n                    ) || null;\n\n                if (!targetApplication) {\n                    throw new Error(\"No application found for \" + application);\n                }\n\n                for (const position of application.instructor_preferences) {\n                    const targetPosition =\n                        positions.find(\n                            (currPosition) =>\n                                currPosition.position_code ===\n                                position.position_code\n                        ) || null;\n\n                    if (!targetPosition) {\n                        throw new Error(\n                            \"No position found for \" + position.position_code\n                        );\n                    }\n\n                    await apiPOST(`/instructor/instructor_preferences`, {\n                        preference_level: position.preference_level,\n                        comment: position.comment,\n                        application_id: targetApplication.id,\n                        position_id: targetPosition.id,\n                    });\n                }\n            }\n            count++;\n            setProgress(Math.round((count / total) * 100));\n        }\n        setProgress(100);\n    }\n\n    async function seedAll() {\n        try {\n            setConfirmDialogVisible(false);\n            setInProgress(true);\n\n            await seedSession();\n            await seedContractTemplate();\n            await seedInstructors();\n            await seedPositions();\n            await seedApplicants();\n            await seedAssignments();\n        } catch (error) {\n            console.error(error);\n        } finally {\n            setInProgress(false);\n        }\n    }\n\n    async function seedMatching() {\n        try {\n            setConfirmDialogVisible(false);\n            setInProgress(true);\n\n            setStage(\"Matching Data\");\n\n            // Keep track of current user so we can swap back at the end\n            const initialUser = await dispatch(fetchActiveUser());\n\n            // // Create a new session\n            const mockSessionData = {\n                start_date: \"2021/01/01\",\n                end_date: \"2022/12/31\",\n                name: `Session ${new Date().toLocaleString()}`,\n                rate1: 50,\n                applications_visible_to_instructors: true,\n            };\n            session = await dispatch(upsertSession(mockSessionData));\n            await dispatch(setActiveSession(session));\n\n            await seedContractTemplate();\n            await seedUsers();\n            await seedInstructors();\n            await seedPositions();\n\n            // Create a new posting\n            setStage(\"Posting\");\n            const newPosting = await dispatch(\n                upsertPosting({\n                    name: \"Matching Data Posting\",\n                    open_date: \"2022-01-01T00:00:00.000Z\",\n                    close_date: \"2022-12-31T00:00:00.000Z\",\n                    intro_text: \"This is a test posting for matching data.\",\n                    availability: \"auto\",\n                    custom_questions: null,\n                    open_status: true,\n                })\n            );\n\n            // Add all seeded positions to posting:\n            const sessionPositions = await dispatch(fetchPositions());\n\n            setStage(\"Posting Positions\");\n            for (const position of sessionPositions) {\n                await dispatch(\n                    upsertPostingPosition({\n                        position_id: position.id,\n                        posting_id: newPosting.id,\n                        hours: position.hours_per_assignment,\n                        num_positions: Math.floor(Math.random() * 29) + 1,\n                    })\n                );\n            }\n\n            await seedApplications();\n\n            // Temporarily set user to someone marked as an instructor in all positions\n            await dispatch(\n                debugOnlySetActiveUser(\n                    {\n                        utorid: \"smithh\",\n                        roles: [\"admin, instructor\", \"ta\"],\n                    },\n                    { skipInit: true }\n                )\n            );\n            await seedInstructorPreferences();\n\n            // Go back to the original user\n            await dispatch(\n                debugOnlySetActiveUser({\n                    utorid: initialUser.utorid,\n                    roles: initialUser.roles,\n                })\n            );\n        } catch (error) {\n            console.error(error);\n        } finally {\n            setInProgress(false);\n        }\n    }\n\n    function onSelectHandler(eventKey: string | null) {\n        setSeedAction(\n            seedActions[eventKey as keyof typeof seedActions]?.action || ident\n        );\n        setConfirmDialogVisible(true);\n    }\n\n    return (\n        <span\n            title=\"Load seed data. If a new session is not specified, the active session is used.\"\n            className=\"mock-button\"\n        >\n            <Dropdown\n                onSelect={onSelectHandler}\n                onToggle={(desiredVisibility) =>\n                    setDropdownVisible(desiredVisibility)\n                }\n                show={dropdownVisible}\n                alignRight\n            >\n                <Dropdown.Toggle split variant=\"dark\">\n                    Seed Data{\" \"}\n                </Dropdown.Toggle>\n                <Dropdown.Menu flip={true}>\n                    <Dropdown.Header>\n                        Load seed data into current session\n                    </Dropdown.Header>\n                    {Object.keys(seedActions).map((key: string) => (\n                        <Dropdown.Item key={key} eventKey={key}>\n                            {seedActions[key as keyof typeof seedActions].name}\n                        </Dropdown.Item>\n                    ))}\n                </Dropdown.Menu>\n            </Dropdown>\n\n            <Modal\n                show={confirmDialogVisible}\n                onHide={() => {\n                    setConfirmDialogVisible(false);\n                }}\n                size=\"lg\"\n            >\n                <Modal.Header closeButton>\n                    <Modal.Title>Loading Seed Data</Modal.Title>\n                </Modal.Header>\n                <Modal.Body>\n                    {targetSession === null ? (\n                        \"Are you sure to create a new session and load mock data?\"\n                    ) : (\n                        <React.Fragment>\n                            Are you sure to load mock data into the session{\" \"}\n                            <b>{targetSession.name}</b>?\n                        </React.Fragment>\n                    )}\n                </Modal.Body>\n                <Modal.Footer>\n                    <Button\n                        variant=\"secondary\"\n                        onClick={() => {\n                            setConfirmDialogVisible(false);\n                        }}\n                    >\n                        Cancel\n                    </Button>\n                    <Button\n                        variant=\"primary\"\n                        onClick={async () => {\n                            try {\n                                setConfirmDialogVisible(false);\n                                setInProgress(true);\n                                await seedAction();\n                            } catch (e) {\n                                console.log(e);\n                            } finally {\n                                setInProgress(false);\n                            }\n                        }}\n                    >\n                        Confirm\n                    </Button>\n                </Modal.Footer>\n            </Modal>\n\n            <Modal show={inProgress} size=\"lg\">\n                <Modal.Header>\n                    <Modal.Title>{`Upserting mock ${stage}`}</Modal.Title>\n                </Modal.Header>\n\n                <Modal.Body\n                    style={{\n                        display: \"flex\",\n                        justifyContent: \"center\",\n                        alignItems: \"center\",\n                    }}\n                >\n                    <ProgressBar\n                        now={progress}\n                        label={`${progress}%`}\n                        style={{ minWidth: \"90%\" }}\n                    />\n                </Modal.Body>\n            </Modal>\n        </span>\n    );\n}\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport PropTypes from \"prop-types\";\nimport { NavLink, Switch, Route } from \"react-router-dom\";\n\nimport \"./main.css\";\nimport \"../../components/components.css\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { Navbar, Nav } from \"react-bootstrap\";\nimport { ToggleMockApi } from \"./mockAPI\";\n\nimport \"swagger-ui-react/swagger-ui.css\";\nimport { mockApiRoutesAsSwaggerPaths } from \"../../api/defs/doc-generation\";\nimport { mockAPI } from \"../../api/mockAPI\";\nimport {\n    setMockAPIState,\n    usersSelector,\n    activeUserSelector,\n    debugOnlySetActiveUser,\n    debugOnlyFetchUsers,\n    sessionsSelector,\n    fetchSessions,\n} from \"../../api/actions\";\nimport { ActiveUserButton } from \"./active-user-switch\";\nimport { SeedDataMenu } from \"./load-mock-data\";\nimport { ErrorBoundary } from \"react-error-boundary\";\n\n// We don't need SwaggerUI all the time, so load it lazily.\nconst SwaggerUI = React.lazy(() => import(\"swagger-ui-react\"));\n\n/**\n * Wrap `\"react-router-dom\"`'s `NavLink` in Bootstrap\n * styling.\n *\n * @param {*} props\n * @returns\n */\nfunction BootstrapNavLink(props) {\n    return (\n        <Nav.Link\n            as={NavLink}\n            activeClassName=\"bg-warning text-dark\"\n            to={props.to}\n        >\n            {props.children}\n        </Nav.Link>\n    );\n}\nBootstrapNavLink.propTypes = {\n    to: PropTypes.string,\n};\n\nconst swaggerData = {\n    openapi: \"3.0.0\",\n    info: {\n        description:\n            \"TAPP is a program for TA management--for making TA assignments and distributing TA contracts.\",\n        title: \"TAPP\",\n    },\n    servers: [\n        { url: \"/api/v1/admin\" },\n        { url: \"/api/v1/instructor\" },\n        { url: \"/api/v1/ta\" },\n        { url: \"/api/v1\" },\n        { url: \"/\" },\n    ],\n    paths: {\n        /* XXX this is hear temporarily to serve as an example for generating Swagger (openapi) documentation\n        \"/bob\": {\n            get: {\n                summary: \"Bob's summary\",\n                tags: [\"helpful\"],\n                produces: \"application/json\",\n                responses: {\n                    default: {\n                        description: \"OK\",\n                        content: {\n                            \"application/json\": {\n                                schema: {\n                                    type: \"object\",\n                                    properties: {\n                                        status: {\n                                            type: \"string\",\n                                            enum: [\"success\", \"error\"]\n                                        },\n                                        message: { type: \"string\" },\n                                        payload: {\n                                            type: \"array\",\n                                            items: {\n                                                type: \"object\",\n                                                properties: {\n                                                    name: { type: \"string\" }\n                                                },\n                                                required: [\"name\"]\n                                            }\n                                        }\n                                    },\n                                    required: [\"status\"]\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        },\n*/\n        ...mockApiRoutesAsSwaggerPaths(mockAPI),\n    },\n};\n\nconst ConnectedActiveUserButton = connect(\n    (state) => ({\n        activeUser: activeUserSelector(state),\n        users: usersSelector(state),\n    }),\n    { fetchUsers: debugOnlyFetchUsers, setActiveUser: debugOnlySetActiveUser }\n)(ActiveUserButton);\n\n// When toggled, `ToggleMockApi` will try\n// to refetch all the sessions, so pass it an\n// appropriate dispatcher.\nconst ConnectedToggleMockApi = connect(null, { setMockAPIState })(\n    ToggleMockApi\n);\n\nconst ConnectedLoadMockButton = connect(\n    (state) => ({ sessions: sessionsSelector(state) }),\n    { fetchSessions }\n)(SeedDataMenu);\n\nfunction DevFrame(props) {\n    return (\n        <div id=\"dev-frame\" className=\"bg-info\">\n            <div id=\"dev-frame-header\">\n                <Navbar expand variant=\"dark\">\n                    <Navbar.Brand\n                        href=\"#/\"\n                        title=\"View TAPP in development mode in a framed window.\"\n                    >\n                        Dev Mode\n                    </Navbar.Brand>\n                    <Nav className=\"mr-auto\">\n                        <BootstrapNavLink to=\"/api-docs\">\n                            API Docs\n                        </BootstrapNavLink>\n                    </Nav>\n                    <Navbar.Collapse className=\"justify-content-end\">\n                        <ConnectedLoadMockButton />\n                        <ConnectedActiveUserButton />\n                        <ConnectedToggleMockApi />\n                    </Navbar.Collapse>\n                </Navbar>\n            </div>\n            <div id=\"dev-frame-body\">\n                <div id=\"dev-frame-body-inner\">\n                    <Switch>\n                        <Route path=\"/api-docs\">\n                            <React.Suspense fallback=\"Loading...\">\n                                <SwaggerUI\n                                    spec={swaggerData}\n                                    docExpansion=\"list\"\n                                />\n                            </React.Suspense>\n                        </Route>\n                        <Route>\n                            <ErrorBoundary\n                                FallbackComponent={\n                                    \"There was an error when rendering. See console for details.\"\n                                }\n                                onError={console.error}\n                            >\n                                {props.children}\n                            </ErrorBoundary>\n                        </Route>\n                    </Switch>\n                </div>\n            </div>\n            <div id=\"dev-frame-footer\"></div>\n        </div>\n    );\n}\n\nexport { DevFrame };\n","import {\n    FETCH_ONE_OFFER_SUCCESS,\n    SET_OFFER_ACCEPTED_SUCCESS,\n    SET_OFFER_REJECTED_SUCCESS,\n    OFFER_CREATE_SUCCESS,\n    OFFER_EMAIL_SUCCESS,\n    OFFER_NAG_SUCCESS,\n    OFFER_WITHDRAW_SUCCESS,\n    FETCH_OFFERS_FOR_ASSIGNMENT_SUCCESS,\n} from \"../constants\";\nimport { fetchError } from \"./errors\";\nimport { actionFactory, HasId, validatedApiDispatcher } from \"./utils\";\nimport { apiGET, apiPOST } from \"../../libs/api-utils\";\nimport { fetchAssignment } from \"./assignments\";\nimport { activeRoleSelector } from \"./users\";\nimport { Assignment, RawOffer } from \"../defs/types\";\n\n// actions\n// XXX These actions don't actually do anything ATM; They're here in case we want to incorporate\n// this information into the reducer at some point.\nexport const fetchOfferSuccess = actionFactory<RawOffer>(\n    FETCH_ONE_OFFER_SUCCESS\n);\nexport const setOfferAcceptedSuccess = actionFactory<RawOffer>(\n    SET_OFFER_ACCEPTED_SUCCESS\n);\nexport const setOfferRejectedSuccess = actionFactory<RawOffer>(\n    SET_OFFER_REJECTED_SUCCESS\n);\nexport const offerCreateSuccess = actionFactory<RawOffer>(OFFER_CREATE_SUCCESS);\nexport const offerEmailSuccess = actionFactory<RawOffer>(OFFER_EMAIL_SUCCESS);\nexport const offerNagSuccess = actionFactory<RawOffer>(OFFER_NAG_SUCCESS);\nexport const offerWithdrawSuccess = actionFactory<RawOffer>(\n    OFFER_WITHDRAW_SUCCESS\n);\n\nexport const fetchOffersForAssignmentSuccess = actionFactory<{\n    assignment_id: number;\n    offers: RawOffer[];\n}>(FETCH_OFFERS_FOR_ASSIGNMENT_SUCCESS);\n\n// dispatchers\nexport const fetchOfferHistoryForAssignment = validatedApiDispatcher({\n    name: \"fetchOfferHistoryForAssignment\",\n    description:\n        \"Fetch the history of all offers associated with an assignment\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const { id: assignmentId } = payload;\n        const data = (await apiGET(\n            `/${role}/assignments/${assignmentId}/active_offer/history`\n        )) as RawOffer[];\n        dispatch(\n            fetchOffersForAssignmentSuccess({\n                assignment_id: assignmentId,\n                offers: data,\n            })\n        );\n    },\n});\nexport const fetchActiveOfferForAssignment = validatedApiDispatcher({\n    name: \"fetchActiveOfferForAssignment\",\n    description: \"Fetch an offer associated with an assignment\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (payload: HasId) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = (await apiGET(\n            `/${role}/assignments/${payload.id}/active_offer`\n        )) as RawOffer;\n        dispatch(fetchOfferSuccess(data));\n        return data;\n    },\n});\n\nexport const setOfferForAssignmentAccepted = validatedApiDispatcher({\n    name: \"setOfferForAssignmentAccepted\",\n    description: \"Set an offer as accepted\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment: Assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/accept`\n        );\n        dispatch(setOfferAcceptedSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n\nexport const setOfferForAssignmentRejected = validatedApiDispatcher({\n    name: \"setOfferForAssignmentRejected\",\n    description: \"Set an offer as rejected\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment: Assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/reject`\n        );\n        dispatch(setOfferRejectedSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n\nexport const offerForAssignmentWithdraw = validatedApiDispatcher({\n    name: \"offerForAssignmentWithdraw\",\n    description: \"Withdraw an offer\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment: Assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/withdraw`\n        );\n        dispatch(offerWithdrawSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n\nexport const offerForAssignmentCreate = validatedApiDispatcher({\n    name: \"offerForAssignmentCreate\",\n    description: \"Create an offer\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment: Assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/create`\n        );\n        dispatch(offerCreateSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n\nexport const offerForAssignmentEmail = validatedApiDispatcher({\n    name: \"offerForAssignmentEmail\",\n    description: \"Email an offer\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment: Assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/email`\n        );\n        dispatch(offerEmailSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n\nexport const offerForAssignmentNag = validatedApiDispatcher({\n    name: \"offerForAssignmentNag\",\n    description: \"Send a nag email for an offer\",\n    onErrorDispatch: (e) => fetchError(e.toString()),\n    dispatcher: (assignment: Assignment) => async (dispatch, getState) => {\n        const role = activeRoleSelector(getState());\n        const data = await apiPOST(\n            `/${role}/assignments/${assignment.id}/active_offer/nag`\n        );\n        dispatch(offerNagSuccess(data));\n        // After we update an offer, we should refetch the assignment to make sure\n        // there isn't stale data\n        await dispatch(fetchAssignment(assignment));\n    },\n});\n","import { useDispatch } from \"react-redux\";\nimport { AnyAction } from \"redux\";\nimport { ThunkDispatch } from \"redux-thunk\";\nimport { RootState } from \"../rootReducer\";\n\n/**\n * A properly typed version of `useDispatch` for use with TypeScript.\n * The types of the `dispatch` function returned by `useDispatch` don't\n * recognize when the dispatched object is an asynchronous thunk.\n * This means that the linter will claim that the `await` keyword is unneeded,\n * even though it is. This properly typed version fixes that issue.\n */\nexport const useThunkDispatch = useDispatch as () => ThunkDispatch<\n    RootState,\n    void,\n    AnyAction\n>;\n","import React from \"react\";\nimport { shallowEqual } from \"react-redux\";\nimport { Session } from \"../api/defs/types\";\n\n/**\n * Adds the arguments passed in.\n *\n * @export\n * @param {} numbers\n * @returns {number}\n */\nexport function sum(...numbers: number[]) {\n    let ret = 0;\n    for (const num of numbers) {\n        ret += +num;\n    }\n    return ret;\n}\n\n/**\n * Compare the two input strings.\n * @param {string} str1\n * @param {string} str2\n * @returns\n */\nexport function compareString(str1: string, str2: string) {\n    if (str1 > str2) {\n        return 1;\n    } else if (str1 < str2) {\n        return -1;\n    }\n    return 0;\n}\n\n/**\n * Capitalizes the input string. The function only capitalizes the first word if there are multiple words in the input string.\n * If `word` isn't a string, it is coerced.\n * @param word a single word.\n * @returns\n */\nexport function capitalize(word: string | null | undefined): string {\n    if (!word) {\n        return \"\";\n    }\n    return word.charAt(0).toUpperCase() + word.slice(1);\n}\n\n/**\n * Trims the input string. If the `x` is not a string, it is\n * coerced\n *\n * @param {string} x\n * @returns\n */\nexport function strip(x: string | number | null | undefined): string {\n    if (x == null) {\n        return \"\";\n    }\n    return (\"\" + x).trim();\n}\n\n/**\n * Formats the input date string to be human readable\n * Input string is of the form 2019-01-01T00:00:00.000Z\n * Output string is of the form January 1, 2019\n * @param {string} dateString\n */\nexport function formatDate(dateString: string): string {\n    if (!dateString) {\n        return dateString;\n    }\n    // Normalize the date string so we can compensate for timezone issues.\n    // This string is now formatted YYYY-MM-DD\n    const processedDate = new Date(dateString).toJSON() || \"\";\n    const normalizedDateString = processedDate.slice(0, 10);\n    // Add timezone offset information so that Javascript will\n    // interpret the date in the current timezone\n    const date = new Date(`${normalizedDateString}T00:00:00.000`);\n    return `${date.toLocaleDateString(\"en-CA\", {\n        month: \"short\",\n        year: \"numeric\",\n        day: \"numeric\",\n    })}`;\n}\n\n/**\n * Formats the input date string to be human readable\n * Input string is of the form 2019-01-01T00:00:00.000Z\n * Output string is of the form \"2018-12-31, 7:00:00 p.m.\"\n * @param {string} dateString\n */\nexport function formatDateTime<T extends string | null | undefined>(\n    dateString: T\n): T {\n    if (!dateString || dateString == null) {\n        return dateString;\n    }\n    const date = new Date(dateString!);\n    return date.toLocaleString(\"en-CA\") as T;\n}\n\n/**\n * Format a url for downloading. In production, this is the\n * identity function. In development mode, this function replaces\n * port `8000` with `3000` so that non-json data can be downloaded from the\n * backend.\n *\n * @param {string} url\n */\nlet formatDownloadUrl = (url: string) => url;\n\nexport { formatDownloadUrl };\n\n/**\n * Returns all the elements that are in `a` but not `b`.\n *\n * @export\n * @template T\n * @param {T[]} a\n * @param {any[]} b\n * @returns {T[]}\n */\nexport function arrayDiff<T>(a: T[], b: any[]): T[] {\n    return a.filter((x) => !b.includes(x));\n}\n\n// Debounce hook from https://dev.to/gabe_ragland/debouncing-with-react-hooks-jci\n/**\n * Debounce a value. This hook will continue returning the initially passed in `value`\n * until `delay` milliseconds have passed. After the delay, the most recently-passed-in\n * value is returned.\n *\n * @export\n * @param {*} value\n * @param {number} delay\n * @returns\n */\nexport function useDebounce(value: any, delay: number) {\n    // State and setters for debounced value\n    const [debouncedValue, setDebouncedValue] = React.useState<any>(value);\n\n    React.useEffect(\n        () => {\n            if (shallowEqual(value, debouncedValue)) {\n                return;\n            }\n            // Set debouncedValue to value (passed in) after the specified delay\n            const handler = setTimeout(() => {\n                setDebouncedValue(value);\n            }, delay);\n\n            // Return a cleanup function that will be called every time ...\n            // ... useEffect is re-called. useEffect will only be re-called ...\n            // ... if value changes (see the inputs array below).\n            // This is how we prevent debouncedValue from changing if value is ...\n            // ... changed within the delay period. Timeout gets cleared and restarted.\n            // To put it in context, if the user is typing within our app's ...\n            // ... search box, we don't want the debouncedValue to update until ...\n            // ... they've stopped typing for more than 500ms.\n            return () => {\n                clearTimeout(handler);\n            };\n        },\n        // Only re-call effect if value changes\n        // We purposely don't pass in `debounceValue` so that we don't get\n        // stuck in a loop. However, eslint complains about not passing in\n        // `debounceValue`.\n        // eslint-disable-next-line\n        [value, delay]\n    );\n\n    return debouncedValue;\n}\n\n/**\n * Given a list of sessions, use a heuristic to pick the \"current\"\n * session. If the session dates of all sessions are too far from the current\n * date, `null` is returned.\n */\nexport function guessActiveSession(sessions: Session[]): Session | null {\n    // If there is a session whose start date is less than a month away,\n    // pick that session. This takes precedence over a session that we're \"in\"\n    // because if we're near the end of a session, we're probably interested in the\n    // upcoming TAs rather than the current TAs.\n    const oneMonth: number = +new Date(\"2020-02-01\") - +new Date(\"2020-01-01\");\n    const now = +new Date();\n    for (const session of sessions) {\n        const sessionStart = +new Date(session.start_date);\n        const diff = sessionStart - now;\n        if (diff < oneMonth && diff >= 0) {\n            return session;\n        }\n    }\n    // Next, we check if we're in a current session or have passed it by at most a month\n    for (const session of sessions) {\n        const sessionStart = +new Date(session.start_date);\n        const sessionEnd = +new Date(session.end_date);\n        if (now <= sessionEnd + oneMonth && now >= sessionStart) {\n            return session;\n        }\n    }\n\n    return null;\n}\n\n/**\n * Formats the input \"number\" string to 2 decimal places.\n * @param {string} moneyString\n * @returns {string}\n */\nexport function formatMoney(moneyString: string): string {\n    if (!isFinite(parseFloat(moneyString))) {\n        return moneyString;\n    }\n    return parseFloat(moneyString).toFixed(2);\n}\n\n/**\n * Round `x` to `places` number of decimal places.\n */\nexport function round(x: number, places: number = 0) {\n    return Math.round(x * Math.pow(10, places)) / Math.pow(10, places);\n}\n"],"sourceRoot":""}